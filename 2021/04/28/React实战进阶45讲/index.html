<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui"><meta name="renderer" content="webkit"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no,email=no,adress=no"><meta name="theme-color" content="#000000"><meta http-equiv="window-target" content="_top"><title>React实战进阶45讲 | 小桔子的部落格</title><meta name="description" content="01丨React出现的历史背景及特性介绍1.1 React解决UI细节问题  1个新概念：组件 用组件的方式去描述UI  4个必须API  单向数据流  完善的错误提示   1.2 React解决数据模型问题  传统MVC难以扩展和维护，为了解决这个问题，提出Flux架构，它是一种设计模式，核心思想是单向数据流：   流程描述： ​    当UI(React Views)上发生用户的操作(User"><meta property="og:type" content="article"><meta property="og:title" content="React实战进阶45讲"><meta property="og:url" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/index.html"><meta property="og:site_name" content="Hexo"><meta property="og:description" content="01丨React出现的历史背景及特性介绍1.1 React解决UI细节问题  1个新概念：组件 用组件的方式去描述UI  4个必须API  单向数据流  完善的错误提示   1.2 React解决数据模型问题  传统MVC难以扩展和维护，为了解决这个问题，提出Flux架构，它是一种设计模式，核心思想是单向数据流：   流程描述： ​    当UI(React Views)上发生用户的操作(User"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210413103945310.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/2021413105339932.jpg"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210413105744150.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210413110751036.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210413110846140.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210413111543077.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210413111554186.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210413113218099.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210413113630892.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/2021413135755403.jpg"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210413151254382.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210413154622554.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210413155512680.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210413161643768.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210413170620315.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210413170633566.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210413174242188.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210413175823468.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210413175837729.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210414101410531.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210414102442730.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210414111856086.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210414111921949.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210414140152691.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210414140516258.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210414143403954.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/2021414162225565.jpg"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210414162723651.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210414163534899.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210414163941419.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210414164709576.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210414165736848.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210414173639751.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210414174516751.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210414174908706.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210414175214151.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210414175755195.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210414175813516.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210415154537735.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210415161329451.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210415162337374.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210415163131756.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210415163444902.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210415165358069.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210415170251462.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210415173914631.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210415174256780.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210416111232942.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210416112956630.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210416113125001.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210416114034245.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210416152351298.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210416155003476.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210416155951844.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210416163902090.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210416165445770.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210416174043961.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210419161849967.png"><meta property="article:published_time" content="2021-04-28T07:26:18.000Z"><meta property="article:modified_time" content="2021-04-28T08:09:01.081Z"><meta property="article:author" content="John Doe"><meta property="article:tag" content="React"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/image-20210413103945310.png"><link rel="canonical" href="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/index.html"><link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml"><link rel="icon" href="/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="Hexo 5.4.0"></head><body class="main-center" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="slimContent"><div class="navbar-header"><div class="profile-block text-center"><a id="avatar" href="https://github.com/scarlett9354" target="_blank"><img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200"></a><h2 id="name" class="hidden-xs hidden-sm">桔&amp;桃</h2><h3 id="title" class="hidden-xs hidden-sm hidden-md"></h3><small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> 北京</small></div><div class="search" id="search-form-wrap"><form class="search-form sidebar-form"><div class="input-group"><input type="text" class="search-form-input form-control" placeholder="搜索"> <span class="input-group-btn"><button type="submit" class="search-form-submit btn btn-flat" onclick="return!1"><i class="icon icon-search"></i></button></span></div></form><div class="ins-search"><div class="ins-search-mask"></div><div class="ins-search-container"><div class="ins-input-wrapper"><input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech> <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div><div class="ins-section-wrapper"><div class="ins-section-container"></div></div></div></div></div><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button></div><nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation"><ul class="nav navbar-nav main-nav menu-highlight"><li class="menu-item menu-item-home"><a href="/."><i class="icon icon-home-fill"></i> <span class="menu-title">首页</span></a></li><li class="menu-item menu-item-archives"><a href="/archives"><i class="icon icon-archives-fill"></i> <span class="menu-title">归档</span></a></li><li class="menu-item menu-item-categories"><a href="/categories"><i class="icon icon-folder"></i> <span class="menu-title">分类</span></a></li><li class="menu-item menu-item-tags"><a href="/tags"><i class="icon icon-tags"></i> <span class="menu-title">标签</span></a></li><li class="menu-item menu-item-repository"><a href="/repository"><i class="icon icon-project"></i> <span class="menu-title">项目</span></a></li><li class="menu-item menu-item-books"><a href="/books"><i class="icon icon-book-fill"></i> <span class="menu-title">书单</span></a></li><li class="menu-item menu-item-links"><a href="/links"><i class="icon icon-friendship"></i> <span class="menu-title">友链</span></a></li><li class="menu-item menu-item-about"><a href="/about"><i class="icon icon-cup-fill"></i> <span class="menu-title">关于</span></a></li></ul><ul class="social-links"><li><a href="https://github.com/scarlett9354" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li></ul></nav></div></header><aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar"><div class="slimContent"><div class="widget"><h3 class="widget-title">公告</h3><div class="widget-body"><div id="board"><div class="content"><p>欢迎交流与分享经验!</p></div></div></div></div><div class="widget"><h3 class="widget-title">分类</h3><div class="widget-body"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/HTTP/">HTTP</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/React/">React</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/webpack/">webpack</a><span class="category-list-count">2</span></li></ul></div></div><div class="widget"><h3 class="widget-title">标签</h3><div class="widget-body"><ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/" rel="tag">React</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/" rel="tag">http</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/https/" rel="tag">https</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack/" rel="tag">webpack</a><span class="tag-list-count">2</span></li></ul></div></div><div class="widget"><h3 class="widget-title">标签云</h3><div class="widget-body tagcloud"><a href="/tags/React/" style="font-size:13px">React</a> <a href="/tags/http/" style="font-size:13px">http</a> <a href="/tags/https/" style="font-size:13px">https</a> <a href="/tags/webpack/" style="font-size:14px">webpack</a></div></div><div class="widget"><h3 class="widget-title">归档</h3><div class="widget-body"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">四月 2021</a><span class="archive-list-count">5</span></li></ul></div></div><div class="widget"><h3 class="widget-title">最新文章</h3><div class="widget-body"><ul class="recent-post-list list-unstyled no-thumbnail"><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/2021/04/29/TypeScript%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/" class="title">TypeScript开发实战</a></p><p class="item-date"><time datetime="2021-04-29T03:30:28.000Z" itemprop="datePublished">2021-04-29</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/webpack/">webpack</a></p><p class="item-title"><a href="/2021/04/28/%E4%BB%8E%E5%9F%BA%E7%A1%80%E5%88%B0%E5%AE%9E%E6%88%98-%E6%89%8B%E6%8A%8A%E6%89%8B%E5%B8%A6%E4%BD%A0%E6%8E%8C%E6%8F%A1%E6%96%B0%E7%89%88Webpack4/" class="title">从基础到实战-手把手带你掌握新版Webpack4</a></p><p class="item-date"><time datetime="2021-04-28T09:39:13.000Z" itemprop="datePublished">2021-04-28</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/webpack/">webpack</a></p><p class="item-title"><a href="/2021/04/28/%E7%8E%A9%E8%BD%ACwebpack/" class="title">玩转webpack</a></p><p class="item-date"><time datetime="2021-04-28T08:19:47.000Z" itemprop="datePublished">2021-04-28</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/HTTP/">HTTP</a></p><p class="item-title"><a href="/2021/04/28/%E9%80%8F%E8%A7%86HTTP%E5%8D%8F%E8%AE%AE/" class="title">透视HTTP协议</a></p><p class="item-date"><time datetime="2021-04-28T07:26:47.000Z" itemprop="datePublished">2021-04-28</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/React/">React</a></p><p class="item-title"><a href="/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/" class="title">React实战进阶45讲</a></p><p class="item-date"><time datetime="2021-04-28T07:26:18.000Z" itemprop="datePublished">2021-04-28</time></p></div></li></ul></div></div></div></aside><main class="main" role="main"><div class="content"><article id="post-React实战进阶45讲" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting"><div class="article-header"><h1 class="article-title" itemprop="name">React实战进阶45讲</h1><div class="article-meta"><span class="article-date"><i class="icon icon-calendar-check"></i> <a href="/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/" class="article-date"><time datetime="2021-04-28T07:26:18.000Z" itemprop="datePublished">2021-04-28</time> </a></span><span class="article-category"><i class="icon icon-folder"></i> <a class="article-category-link" href="/categories/React/">React</a> </span><span class="article-tag"><i class="icon icon-tags"></i> <a class="article-tag-link-link" href="/tags/React/" rel="tag">React</a> </span><span class="post-comment"><i class="icon icon-comment"></i> <a href="/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/#comments" class="article-comment-link">评论</a></span></div></div><div class="article-entry marked-body" itemprop="articleBody"><h1 id="01丨React出现的历史背景及特性介绍"><a href="#01丨React出现的历史背景及特性介绍" class="headerlink" title="01丨React出现的历史背景及特性介绍"></a>01丨React出现的历史背景及特性介绍</h1><p><strong>1.1 React解决UI细节问题</strong></p><ul><li><p>1个新概念：组件</p><p>用组件的方式去描述UI</p></li><li><p>4个必须API</p></li><li><p>单向数据流</p></li><li><p>完善的错误提示</p></li></ul><p><strong>1.2 React解决数据模型问题</strong></p><ul><li><p>传统MVC难以扩展和维护，为了解决这个问题，提出<strong>Flux架构</strong>，它是一种设计模式，核心思想是单向数据流：</p><img src="image-20210413103945310.png" alt="image-20210413103945310" style="zoom:50%"><p>流程描述：</p><p>​ 当UI(React Views)上发生用户的操作(User interactions)会产生一个Action，这个action会通过Dispatcher dispatch出去，然后由Store进行处理，store根据这个action来更新自己，因为我们的views是绑定在store上的，所以当store有任何变化时，它就会发生更新。</p><p>​ Flux架构完全是建立在React始终以状态为基础来展示UI的，所以不需要关系细节就可以把views connect到一个store上。</p></li><li><p>Flux架构的衍生项目：Redux、Mobx</p></li></ul><p><strong>1.3 小结</strong></p><ol><li>传统Web UI开发的问题</li><li>React：始终整体刷新页面</li><li>Flux：单向数据流</li></ol><h1 id="02丨以组件方式考虑UI的构建"><a href="#02丨以组件方式考虑UI的构建" class="headerlink" title="02丨以组件方式考虑UI的构建"></a>02丨以组件方式考虑UI的构建</h1><p><strong>2.1 将UI组织成组件树的形式</strong></p><img src="2021413105339932.jpg" alt="2021413105339932" style="zoom:45%"><p><strong>2.2 理解React组件</strong></p><img src="image-20210413105744150.png" alt="image-20210413105744150" style="zoom:50%"><blockquote><p>外部传进来的属性props + 内部维护的状态state = view</p></blockquote><ol><li>React组件一般不提供方法，而是某种状态机</li><li>React组件可以理解为一个纯函数</li><li>单向数据绑定</li></ol><p><strong>2.3 创建一个简单的组件：TabSelect</strong></p><ol><li><p>创建静态UI</p><p>一般就是由html去描述</p></li><li><p>考虑组件的状态组成</p><p>考虑状态是来自外部还是需要在内部去维护</p></li><li><p>考虑组件的交互方式</p><p>用户在内部进行了操作，如何暴露给外部使用</p><p>组件内部：</p><img src="image-20210413110751036.png" alt="image-20210413110751036" style="zoom:80%"><p>组件外部：</p><img src="image-20210413110846140.png" alt="image-20210413110846140" style="zoom:80%"></li></ol><p><strong>2.4 受控组件 vs 非受控组件</strong></p><ul><li><p>受控组件：</p><p>表单元素状态由使用者维护</p><img src="image-20210413111543077.png" alt="image-20210413111543077" style="zoom:70%"></li><li><p>非受控组件：</p><p>表单元素状态DOM自身维护</p><img src="image-20210413111554186.png" alt="image-20210413111554186" style="zoom:67%"></li></ul><p><strong>2.5 创建组件要遵循什么样的原则？</strong></p><ol><li><p>何时创建组件：单一职责原则</p><ul><li><p>每个组件只做一件事</p></li><li><p>如果组件变得复杂，那么应该拆分成小组件</p><p>这样做有两个好处：</p><ol><li>可以把复杂度拆分到不同的地方去</li><li>可以提高性能：如果组件很大，一点变化可能就要导致整个大组件刷新，拆成小组件，只会出现小组件的刷新</li></ol></li></ul></li><li><p>数据状态管理：DRY原则</p><p>简言之，不要去做重复的状态保存。</p><ul><li><p>能计算得到的状态就不要单独存储</p><p>比如：发请求，未收到响应时，数据为空，这时就知道处于loading状态，而没必要存储loading的state</p></li><li><p>组件尽量无状态，所需数据通过props获取</p></li></ul></li></ol><h1 id="03丨JSX-的本质-不是模板引擎，而是语法糖"><a href="#03丨JSX-的本质-不是模板引擎，而是语法糖" class="headerlink" title="03丨JSX 的本质  不是模板引擎，而是语法糖"></a>03丨JSX 的本质 不是模板引擎，而是语法糖</h1><p><strong>3.1 理解JSX</strong></p><ul><li><p>不是模板语言，只是一种语法糖</p></li><li><p>在JavaScript代码中直接写html标记</p></li><li><p>本质：动态创建组件的语法糖，而且是用的JavaScript的语法</p><p>例1：</p><img src="image-20210413113218099.png" alt="image-20210413113218099" style="zoom:60%"><p>createElement的参数：</p><ol><li>h1：标记的类型</li><li>null：传给它的属性</li><li>Hello, 和name：都是它的children</li></ol><p>​ 即，从第三个参数开始，都是这个元素的子元素。</p><p>例2：</p><img src="image-20210413113630892.png" alt="image-20210413113630892" style="zoom:67%"></li></ul><p><strong>3.2 在JSX中使用表达式</strong></p><ol><li><p>JSX本身也是表达式</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> element = <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, world!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li><li><p>在属性中使用表达式</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;MyComponent foo=&#123;<span class="number">1</span> + <span class="number">2</span> + <span class="number">3</span> + <span class="number">4</span>&#125; /&gt;</span><br></pre></td></tr></table></figure></li><li><p>延展属性</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> props = &#123;<span class="attr">firstName</span>: <span class="string">&#x27;Ben&#x27;</span>, <span class="attr">lastName</span>: <span class="string">&#x27;Hector&#x27;</span>&#125;</span><br><span class="line"><span class="keyword">const</span> greeting = <span class="xml"><span class="tag">&lt;<span class="name">Greeting</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span></span><br></pre></td></tr></table></figure></li><li><p>表达式作为子元素</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> element = <span class="xml"><span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;props.message&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>子元素是React组件的特殊属性，这个属性会传给children，作为子元素，这个返回值就需要是个可render的节点，如组件node、原生node或字符串。</p></li></ol><p><strong>3.3 JSX的优点</strong></p><ol><li><p>声明式创建界面的直观</p><p>比如有非常多的html标记，除了原生的，还有自己定义的，可以很方便地去描述UI</p></li><li><p>代码动态创建界面的灵活</p><p>什么时候创建节点，这个节点什么时候应该消失，属性什么时候发生变化</p></li><li><p>无需学习新的模板语言</p></li></ol><p><strong>3.4 JSX的约定：自定义组件必须以大写字母开头</strong></p><ul><li><p>React认为小写的tag是原生DOM节点，如div</p></li><li><p>大写字母开头为自定义组件</p></li><li><p>JSX标记可以直接使用属性语法，例如<code>&lt;menu.Item /&gt;</code></p><p>这种语法不需要遵循大写字母开头的约定</p></li></ul><h1 id="04丨React组件的生命周期及其使用场景"><a href="#04丨React组件的生命周期及其使用场景" class="headerlink" title="04丨React组件的生命周期及其使用场景"></a>04丨React组件的生命周期及其使用场景</h1><img src="2021413135755403.jpg" alt="2021413135755403" style="zoom:50%"><p>解读：</p><ul><li><p>三个阶段：Render阶段、Pre-commit阶段、Commit阶段。</p><p>commit是React把当前的状态映射到DOM时，需要实际地更新DOM节点，更新DOM节点就称之为commit。</p><p>在pre-commit阶段还没真正地更新DOM，但是在这个阶段可以读取DOM节点的内容。</p></li><li><p>三个类型：</p><ol><li><p>创建时</p><p><strong>4.1 constructor</strong></p><p>​ 标准的JS类的构造函数，一个组件在更新到界面上之前，首先需要创建出来，特点：</p><ul><li>用于初始化内部状态，很少使用</li><li>唯一可以直接修改state的地方 <code>this.state=xxx</code></li></ul><p><strong>4.2 getDerivedStateFromProps</strong></p><p>​ React16.3新引入的api，提供了一个最佳实践 - 如果从外部属性来初始化内部状态。在这个方法里返回的状态都可以merge到当前的状态上。</p><ul><li><p>使用场景：当state需要从props初始化时使用</p></li><li><p>尽量不要使用（不推荐使用）：维护两者状态一致性会增加复杂度</p></li><li><p>每次render都会调用</p><p>因为它是用来取代componentWillReceiveProps时使用的</p></li><li><p>典型场景：表单控件获取默认值</p></li></ul><p><strong>4.3 render</strong></p><p>​ 描述UI DOM结构的地方，是组件唯一必须定义的生命周期方法。</p><p><strong>4.4 componentDidMount</strong></p><ul><li><p>UI渲染完成后调用</p><p>这时可以安全地操作DOM节点，以及触发ajax请求去获取外部的资源</p></li><li><p>只执行一次</p></li><li><p>典型场景：获取外部资源</p></li></ul></li><li><p>更新时</p><p>当这个组件有一个新的属性props传进来或者内部调用setState方法修改了内部状态state或者调用forceUpdate强制组件刷新时发生。</p><p><strong>4.2 getDerivedStateFromProps</strong></p><p><strong>4.5 shouldComponentUpdate</strong></p><p>​ 它可以告诉组件是否真正需要render，这是一个可以用户介入的过程，比如当props发生变化时，我们可以判断界面的UI不需要变化，这时就可以告诉React组件不需要update，只需要在这个方法中返回false即可。当返回true时，React才继续下面的流程 - render。</p><ul><li><p>决定Virtual DOM是否要重绘</p></li><li><p>一般可以由PureComponent自动实现</p><p>它可以判断当前的props和之前的props、当前的state和之前的state是否有变化，如果没有变化，它会自动组织React重新更新</p></li><li><p>典型场景：性能优化</p></li></ul><p><strong>4.3 render</strong></p><p>​ 计算背后的虚拟DOM，这个DOM用来维持内部UI的状态，可以计算一些diff等等。</p><p><strong>4.6 getSnapshotBeforeUpdate</strong></p><p>​ React16.3新引入的api</p><ul><li><p>在页面render之前调用，state已更新（从外部props传进来）</p></li><li><p>典型场景：获取render之前的DOM状态</p><p>举例：</p><img src="image-20210413151254382.png" alt="image-20210413151254382"><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; PureComponent &#125; from &quot;react&quot;;</span><br><span class="line">import PropTypes from &quot;prop-types&quot;;</span><br><span class="line">import &quot;.&#x2F;SnapshotSample.css&quot;;</span><br><span class="line"></span><br><span class="line">export default class SnapshotSample extends PureComponent &#123;</span><br><span class="line">  state &#x3D; &#123;</span><br><span class="line">    messages: []</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  handleNewMessage() &#123;</span><br><span class="line">    this.setState((prev) &#x3D;&gt; (&#123;</span><br><span class="line">      messages: [&#96;msg $&#123;prev.messages.length&#125;&#96;, ...prev.messages]</span><br><span class="line">    &#125;));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    for (let i &#x3D; 0; i &lt; 20; i++) this.handleNewMessage();</span><br><span class="line">    this.interval &#x3D; window.setInterval(() &#x3D;&gt; &#123;</span><br><span class="line">      if (this.state.messages.length &gt; 200) &#123;</span><br><span class="line">        window.clearInterval(this.interval);</span><br><span class="line">        return;</span><br><span class="line">      &#125;</span><br><span class="line">      this.handleNewMessage();</span><br><span class="line">    &#125;, 1000);</span><br><span class="line">  &#125;</span><br><span class="line">  componentWillUnmount() &#123;</span><br><span class="line">    window.clearInterval(this.interval);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getSnapshotBeforeUpdate() &#123;</span><br><span class="line">    return this.rootNode.scrollHeight;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidUpdate(prevProps, prevState, prevScrollHeight) &#123;</span><br><span class="line">    const scrollTop &#x3D; this.rootNode.scrollTop;</span><br><span class="line">    if (scrollTop &lt; 5) return;</span><br><span class="line">    this.rootNode.scrollTop &#x3D;</span><br><span class="line">      scrollTop + (this.rootNode.scrollHeight - prevScrollHeight);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div className&#x3D;&quot;snapshot-sample&quot; ref&#x3D;&#123;(n) &#x3D;&gt; (this.rootNode &#x3D; n)&#125;&gt;</span><br><span class="line">        &#123;this.state.messages.map((msg) &#x3D;&gt; (</span><br><span class="line">          &lt;div&gt;&#123;msg&#125;&lt;&#x2F;div&gt;</span><br><span class="line">        ))&#125;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.snapshot-sample</span> &#123;</span><br><span class="line">  <span class="attribute">overflow</span>: auto;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">widows</span>: <span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#eee</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p><strong>4.7 componentDidUpdate</strong></p><ul><li><p>每次UI更新时被调用</p><p>我们已知React组件在外部props或内部state变化时都会重新渲染，它始终会整体刷新，所以UI的更新非常频繁，这个方法可以捕获每次更新</p></li><li><p>典型场景：页面需要根据props变化重新获取数据</p><p>比如说，当前文章是通过id参数决定显示什么内容，可以在这个方法里，根据不同的id获取到的文章内容，再更新到UI上。</p></li></ul></li><li><p>卸载时</p><p><strong>4.8 componentWillUnmount</strong></p><ul><li>组件移除时被调用（从界面上消失时销毁自己）</li><li>典型场景：释放资源</li></ul></li></ol></li></ul><p><strong>4.9 小结</strong></p><ol><li>理解React组件的生命周期方法</li><li>理解生命周期的使用场景</li></ol><h1 id="05丨理解-Virtual-DOM-及-key-属性的作用"><a href="#05丨理解-Virtual-DOM-及-key-属性的作用" class="headerlink" title="05丨理解 Virtual DOM 及 key 属性的作用"></a>05丨理解 Virtual DOM 及 key 属性的作用</h1><p><strong>5.1 理解 Virtual DOM</strong></p><ul><li><p>它是JSX运行的基础</p><p>React组件在内部维护了一套虚拟DOM的状态，这套DOM状态最终会映射到真实的DOM节点上，当虚拟DOM的状态发生变化时，内部需要计算虚拟DOM之间的区别来产生一个diff，最终在真实的DOM节点上并不是真实地刷新所有的DOM，而是只把diff的部分用一种高效的方式更新到UI上，从而能够保证性能</p></li><li><p>虚拟DOM是如何工作的？ - 原理</p><p>广度优先分层比较</p><img src="image-20210413154622554.png" alt="image-20210413154622554" style="zoom:50%"><p>拿到前后两个DOM树，一层一层地比较，上图两个状态的区别：</p><p>A和B两个节点顺序发生了变化，第三层D节点原来在B下面，移动到了下层节点，A节点有圆形的组件变成了方形的，表示它的组件类型发生了变化。针对这些不同的变化，React diff算法有不同的处理方式：</p><ol><li><p>第一层：根节点开始比较</p><p>参考上图</p><p>发现两个节点完全一样，不做任何修改。</p></li><li><p>第二层：属性变化及顺序</p><p>参考上图</p><p>如果想知道A和B发生了顺序变化，需要给出唯一的标识，算法做的事情是交换两个节点的位置。</p></li><li><p>第三层：节点类型发生变化</p><img src="image-20210413155512680.png" alt="image-20210413155512680" style="zoom:50%"><p>React做的事情是直接把F节点删掉，创建一个新的节点G，并append到A上，不会去管F节点是否被其他地方用到。</p></li><li><p>节点跨层移动</p><p>参考最上面的图</p><p>D从B节点下面，移动到了下下层节点。React的diff算法会把D节点及它下面的子元素全部删除掉，再创建一个全新的D节点加到当前的DOM树上。</p><p>当节点跨层移动时，react的这种做法看上去性能有点低，但这种应用场景很少出现。</p></li></ol></li><li><p>虚拟DOM的diff算法得以实现，基于两个假设：</p><ol><li><p>组件的DOM结构是相对稳定的（很少发生跨层移动的场景）</p></li><li><p>类型相同的兄弟节点可以被唯一标识</p><p>这就是key的作用，不止用于消除warning，还能提高性能</p></li></ol></li></ul><p><strong>5.2 小结</strong></p><ol><li>算法复杂度为O(n) - 线性的复杂度，性能高</li><li>虚拟DOM如何计算diff</li><li>key属性的作用</li></ol><h1 id="06丨组件设计模式-高阶组件和函数作为子组件"><a href="#06丨组件设计模式-高阶组件和函数作为子组件" class="headerlink" title="06丨组件设计模式  高阶组件和函数作为子组件"></a>06丨组件设计模式 高阶组件和函数作为子组件</h1><p><strong>6.1 高阶组件（HOC）</strong></p><ul><li><p>它是对已有组件的封装，形成新的组件，新组件会包含一些自己的应用逻辑，这些逻辑会产生一些新的状态，这个状态会传给已有的组件，因此高阶组件一般不会有自己的UI展现，而是只负责为它封装的组件提供额外的功能和数据。如图中绿色的组件：</p><img src="image-20210413161643768.png" alt="image-20210413161643768" style="zoom:50%"></li><li><p>高阶组件接受组件作为参数，返回新的组件。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> EnhancedComponent = higherOrderComponent(WrappedComponent)</span><br></pre></td></tr></table></figure><p>以定时器为例：</p><p>高阶组件withTimer.js：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line"></span><br><span class="line">export default function withTimer(WrappedComponent) &#123;</span><br><span class="line">    return class extends React.Component &#123;</span><br><span class="line">        state &#x3D; &#123; time: new Date() &#125;;</span><br><span class="line">        componentDidMount() &#123;</span><br><span class="line">            this.timerID &#x3D; setInterval(() &#x3D;&gt; this.tick(), 1000);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        componentWillUnmount() &#123;</span><br><span class="line">            clearInterval(this.timerID);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        tick() &#123;</span><br><span class="line">            this.setState(&#123;</span><br><span class="line">                time: new Date()</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        render() &#123;</span><br><span class="line">            return &lt;WrappedComponent time&#x3D;&#123;this.state.time&#125; &#123;...this.props&#125; &#x2F;&gt;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在ChatApp.js中的应用：</p><img src="image-20210413170620315.png" alt="image-20210413170620315" style="zoom:80%"><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line">import withTimer from &quot;..&#x2F;c06&#x2F;withTimer&quot;;</span><br><span class="line"></span><br><span class="line">export class ChatApp extends React.Component &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;h2&gt;&#123;this.props.time.toLocaleString()&#125;&lt;&#x2F;h2&gt;</span><br><span class="line">            &lt;&#x2F;div&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default withTimer(ChatApp);</span><br></pre></td></tr></table></figure><p>在CommentBox.js中的应用：</p><img src="image-20210413170633566.png" alt="image-20210413170633566"><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line">import withTimer from &quot;..&#x2F;c06&#x2F;withTimer&quot;;</span><br><span class="line"></span><br><span class="line">export class CommentBox extends React.Component &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div&gt;&#123;this.props.time.getTime()&#125;&lt;&#x2F;div&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default withTimer(CommentBox);</span><br></pre></td></tr></table></figure></li></ul><p><strong>6.2 函数作为子组件</strong></p><ul><li><p>children函数</p></li><li><p>特点：render的内容由引用它的父组件决定，而不是子组件不停地增加功能来适配外部的使用场景。</p><img src="image-20210413174242188.png" alt="image-20210413174242188" style="zoom:80%"></li><li><p>举例：</p><p>子组件AdvancedTabSelector：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; PureComponent &#125; from &quot;react&quot;;</span><br><span class="line">import PropTypes from &quot;prop-types&quot;;</span><br><span class="line"></span><br><span class="line">export default class AdvancedTabSelector extends PureComponent &#123;</span><br><span class="line">  static propTypes &#x3D; &#123;</span><br><span class="line">    value: PropTypes.object,</span><br><span class="line">    options: PropTypes.array,</span><br><span class="line">    onChange: PropTypes.func,</span><br><span class="line">    children: PropTypes.func</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  static defaultProps &#x3D; &#123;</span><br><span class="line">    value: null,</span><br><span class="line">    options: [],</span><br><span class="line">    onChange: () &#x3D;&gt; &#123;&#125;,</span><br><span class="line">    children: () &#x3D;&gt; &#123;&#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    const &#123; options, value, onChange &#125; &#x3D; this.props;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div className&#x3D;&quot;tab-selector&quot;&gt;</span><br><span class="line">        &lt;ul&gt;</span><br><span class="line">          &#123;options.map(opt &#x3D;&gt; (</span><br><span class="line">            &lt;li</span><br><span class="line">              key&#x3D;&#123;opt.value&#125;</span><br><span class="line">              className&#x3D;&#123;&#96;tab-item $&#123;</span><br><span class="line">                opt.value &#x3D;&#x3D;&#x3D; this.props.value ? &quot;selected&quot; : &quot;&quot;</span><br><span class="line">              &#125;&#96;&#125;</span><br><span class="line">              onClick&#x3D;&#123;() &#x3D;&gt; this.props.onChange(opt.value)&#125;</span><br><span class="line">            &gt;</span><br><span class="line">              &#123;opt.name&#125;</span><br><span class="line">            &lt;&#x2F;li&gt;</span><br><span class="line">          ))&#125;</span><br><span class="line">        &lt;&#x2F;ul&gt;</span><br><span class="line">        &#123;this.props.value &amp;&amp; this.props.children(this.props.value)&#125;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>父组件AdvancedTabSelectorSample（使用者）:</p><p>使用者1：</p><img src="image-20210413175823468.png" alt="image-20210413175823468" style="zoom:80%"><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">const colors &#x3D; [</span><br><span class="line">  &#123; name: &quot;Red&quot;, value: &quot;red&quot; &#125;,</span><br><span class="line">  &#123; name: &quot;Blue&quot;, value: &quot;blue&quot; &#125;,</span><br><span class="line">  &#123; name: &quot;Orange&quot;, value: &quot;orange&quot; &#125;</span><br><span class="line">];</span><br><span class="line">export class AdvancedTabSelectorSample extends PureComponent &#123;</span><br><span class="line">    state &#x3D; &#123;</span><br><span class="line">        color: null</span><br><span class="line">    &#125;;</span><br><span class="line">    render() &#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div&gt;            </span><br><span class="line">                &lt;h3&gt;Select color: &lt;&#x2F;h3&gt;</span><br><span class="line">                &lt;AdvancedTabSelector</span><br><span class="line">                    options&#x3D;&#123;colors&#125;</span><br><span class="line">                    value&#x3D;&#123;this.state.color&#125;</span><br><span class="line">                    onChange&#x3D;&#123;c &#x3D;&gt; this.setState(&#123; color: c &#125;)&#125;</span><br><span class="line">                    &gt;</span><br><span class="line">                    &#123;color &#x3D;&gt; (</span><br><span class="line">                        &lt;span</span><br><span class="line">                            style&#x3D;&#123;&#123;</span><br><span class="line">                                display: &quot;inline-block&quot;,</span><br><span class="line">                                    backgroundColor: color,</span><br><span class="line">                                        width: &quot;40px&quot;,</span><br><span class="line">                                            height: &quot;40px&quot;</span><br><span class="line">                            &#125;&#125;</span><br><span class="line">                            &#x2F;&gt;</span><br><span class="line">                    )&#125;</span><br><span class="line">                &lt;&#x2F;AdvancedTabSelector&gt;</span><br><span class="line">            &lt;&#x2F;div&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>使用者2：</p><img src="image-20210413175837729.png" alt="image-20210413175837729" style="zoom:80%"><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">const animals &#x3D; [</span><br><span class="line">  &#123; name: &quot;Tiger&quot;, value: &quot;tiger&quot; &#125;,</span><br><span class="line">  &#123; name: &quot;Elephant&quot;, value: &quot;elephant&quot; &#125;,</span><br><span class="line">  &#123; name: &quot;Cow&quot;, value: &quot;cow&quot; &#125;</span><br><span class="line">];</span><br><span class="line">export class AdvancedTabSelectorSample extends PureComponent &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div&gt;        </span><br><span class="line">                &lt;h3&gt;Select animal: &lt;&#x2F;h3&gt;</span><br><span class="line">                &lt;AdvancedTabSelector</span><br><span class="line">                    options&#x3D;&#123;animals&#125;</span><br><span class="line">                    value&#x3D;&#123;this.state.animal&#125;</span><br><span class="line">                    onChange&#x3D;&#123;c &#x3D;&gt; this.setState(&#123; animal: c &#125;)&#125;</span><br><span class="line">                    &gt;</span><br><span class="line">                    &#123;animal &#x3D;&gt; (</span><br><span class="line">                        &lt;img width&#x3D;&quot;100px&quot; src&#x3D;&#123;require(&#96;..&#x2F;..&#x2F;images&#x2F;$&#123;animal&#125;.png&#96;)&#125; &#x2F;&gt;</span><br><span class="line">                    )&#125;</span><br><span class="line">                &lt;&#x2F;AdvancedTabSelector&gt;</span><br><span class="line">            &lt;&#x2F;div&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="07丨理解新的-Context-API-及其使用场景"><a href="#07丨理解新的-Context-API-及其使用场景" class="headerlink" title="07丨理解新的 Context API 及其使用场景"></a>07丨理解新的 Context API 及其使用场景</h1><p><strong>7.1 理解Context API的使用场景</strong></p><ul><li><p>它是React16.3新特性</p></li><li><p>解决的是组件之间通信的问题：</p><p>比如有些全局的状态需要很多个组件使用，但如果所有属性都一层层传递下来，会非常麻烦。之前目前redux和react-router已经非常重度依赖Context API，可见它的作用非常大。</p></li><li><p>下图是典型的Context API的使用场景：</p><img src="image-20210414101410531.png" alt="image-20210414101410531" style="zoom:67%"><p>解读：</p><ul><li>左边是个组件树，这个组件树的很多个节点需要共享一个全局的上下文数据，根节点需要提供所有的上下文数据，下面无论哪个节点都可以通过Context API去访问这个全局的数据，而不管它在哪一层，都不需要上层节点给它传props，都可以自己去访问。</li><li>图上的节点有两种类型：根节点 - provide，下面使用context API的绿色节点 - consume。</li></ul></li><li><p>具体代码：</p><img src="image-20210414102442730.png" alt="image-20210414102442730" style="zoom:80%"><p>解读：</p><ul><li>首先定义了一个context，然后定义了一个provider，如果去给上下文设定一个值，下面是consume，来使用这个上下文。</li><li>创建上下文的语法：<code>React.createContext(参数)</code>，它接收一个参数，即这个上下文的值，可以是任意类型的数据，如object、数组、常量或字符串。</li><li>得到这个context对象，它有个Provider属性，这个Provider是个组件，可以接收一个参数value，是个属性，我们传给它的属性是什么，下面所有的子节点consume拿到的数据就是什么，当value发生change时，下面所有的子组件都会同步更新。</li><li>ThemedButton是个consume，这个button可以从上下文拿到当前的theme，自己决定如何展现这个theme。需要注意一点，consume一定在provider下面，层级上一定属于provider某一层的子组件。</li><li>上段代码的整体解读是如果我们的应用程序需要定义一个theme，它的theme是dark还是light，可以通过在根节点上设置这个值，然后下面的节点需要theme时都可以通过consume拿到。</li></ul></li></ul><p>**7.2 Context API的使用办法（举例）</p><ul><li><p>场景：点击按钮切换当前页面的显示语言</p><img src="image-20210414111856086.png" alt="image-20210414111856086" style="zoom:80%"> <img src="image-20210414111921949.png" alt="image-20210414111921949" style="zoom:80%"></li><li><p>context API是把上下文的数据存在一个外部的状态中，这个外部状态不需要通过props传进来，而且可以通过consume直接拿到其中的数据。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line">const enStrings &#x3D; &#123;</span><br><span class="line">    submit: &quot;Submit&quot;,</span><br><span class="line">    cancel: &quot;Cancel&quot;</span><br><span class="line">&#125;;</span><br><span class="line">const cnStrings &#x3D; &#123;</span><br><span class="line">    submit: &quot;提交&quot;,</span><br><span class="line">    cancel: &quot;取消&quot;</span><br><span class="line">&#125;;</span><br><span class="line">&#x2F;&#x2F; 先定义一个context，它可能有两种值 - 英文字符串enString和中文字符串cnString，先把默认值设置为英文的</span><br><span class="line">const LocaleContext &#x3D; React.createContext(enStrings);</span><br><span class="line">&#x2F;&#x2F; 再定义一个组件 - LocaleProvider，这个组件内部给切换语言增加了一个button</span><br><span class="line">class LocaleProvider extends React.Component &#123;</span><br><span class="line">    state &#x3D; &#123; locale: cnStrings &#125;;</span><br><span class="line">	&#x2F;&#x2F; 点击button切换当前语言，当前语言是存在组件内部的一个状态locale</span><br><span class="line">    toggleLocale &#x3D; () &#x3D;&gt; &#123;</span><br><span class="line">        const locale &#x3D; this.state.locale &#x3D;&#x3D;&#x3D; enStrings ? cnStrings : enStrings;</span><br><span class="line">        &#x2F;&#x2F; 当state中locale发生变化后，Provider的value也相应变化，下面的所有子组件都会使用到更新后的value</span><br><span class="line">        this.setState(&#123; locale &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line">    render() &#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;LocaleContext.Provider value&#x3D;&#123;this.state.locale&#125;&gt;</span><br><span class="line">                &lt;button onClick&#x3D;&#123;this.toggleLocale&#125;&gt;切换语言&lt;&#x2F;button&gt;</span><br><span class="line">                &#123;this.props.children&#125;</span><br><span class="line">            &lt;&#x2F;LocaleContext.Provider&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如何使用上面定义的Provider组件？</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 取消和提交两个按钮，数据来源是上面定义的context，给它包个consume外围组件，负责通知下面的组件语言是否发生变化，变化了就需要重新render</span><br><span class="line">class LocaledButtons extends React.Component &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;LocaleContext.Consumer&gt;</span><br><span class="line">                &#x2F;&#x2F; 用到了“函数作为子组件”的设计模式，并不关心上下文的数据如何被下面的子元素去消费，至于作为属性还是子元素，怎样用都可以</span><br><span class="line">                &#123;(locale) &#x3D;&gt; (</span><br><span class="line">                    &lt;div&gt;</span><br><span class="line">                        &lt;button&gt;&#123;locale.cancel&#125;&lt;&#x2F;button&gt;</span><br><span class="line">                        &amp;nbsp;&lt;button&gt;&#123;locale.submit&#125;&lt;&#x2F;button&gt;</span><br><span class="line">                    &lt;&#x2F;div&gt;</span><br><span class="line">                )&#125;</span><br><span class="line">            &lt;&#x2F;LocaleContext.Consumer&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>实际使用时：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">export default () &#x3D;&gt; (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &#x2F;&#x2F; 是上面定义的组件，包含了切换语言这个button；下面包含了LocaledButtons，这里放的是需要切换上下文的UI组件</span><br><span class="line">        &lt;LocaleProvider&gt;</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;br &#x2F;&gt;</span><br><span class="line">                &lt;LocaledButtons &#x2F;&gt;</span><br><span class="line">            &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;&#x2F;LocaleProvider&gt;</span><br><span class="line">        &#x2F;&#x2F; 注意：我们用到的上下文的子组件必须包含在provider层级下面，如果放在它之外，这个buttons组件的数据来源只是它的默认值（点击按钮不会切换）</span><br><span class="line">        &#123;&#x2F;* &lt;LocaledButtons &#x2F;&gt; *&#x2F;&#125;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>为什么不直接把数据定义到外部的对象中，直接从外部取不就可以了吗？</p><p>答：如果放到外部的对象中，需要主动监听它的变化，因为外部数据并不属于组件内部的状态，当它发生变化时需要主动监听它，并调用forceUpdate去强制刷新。但如果通过context API，当数据发生变化，react会主动监听到这个变化，并通知下面的所有组件自动刷新。</p></li></ul><h1 id="08丨使用脚手架工具创建-React-项目"><a href="#08丨使用脚手架工具创建-React-项目" class="headerlink" title="08丨使用脚手架工具创建 React 项目"></a>08丨使用脚手架工具创建 React 项目</h1><p><strong>8.1 为什么需要脚手架工具？</strong></p><ul><li><p>创建React Application去开发一个真实的项目，通常要引入多个技术栈：</p><ol><li>需要用React做UI的开发</li><li>需要用Redux做状态的管理</li><li>需要用React/Router做路由的管理</li><li>需要用Babel将最新的JavaScript特性翻译成旧的JavaScript语法</li><li>需要用webpack进行打包</li><li>需要用Eslint做语法检查</li></ol><p>看似只有6个技术栈，其实每个技术栈后面都有自己的生态圈，体现在npm的packages上，有非常多小package，所以创建一个新的application时，意味着要引入并了解几十个package，并会配置。</p></li><li><p>创建一个新的application，通常要先建一个文件夹，再建个package.json，然后把所有的依赖放进去，并设定它们需要的版本，再创建webpack的配置文件，需要创建所有的文件夹结构，这个过程其实是个可重用的过程，创建一次后，再创建第二个app，只需要改一些参数即可，这就需要脚手架工具帮助我们做这样的事情。</p></li><li><p>脚手架工具会预先定义好一个典型的项目，需要用到哪些工具、哪些类库、哪些配置，或者根据参数做些配置的调整，并生成项目。</p></li></ul><p><strong>8.2 三种工具：Create React App、Codesandbox、Rekit</strong></p><ol><li><p>Create React App</p><ul><li><p>fackbook推出create-react-app这个命令行工具，使我们能快速开始react开发。它整合了Babel、Webpack Config(用来做打包)、Testing(采用的jest)、Eslint。</p><img src="image-20210414140152691.png" alt="image-20210414140152691"></li><li><p>它只是入门级的命名行工具，因为它采取的最简策略，它的package基本上都是项目必须要用的package，适合用来学习react或者开发简单的react app。</p></li></ul></li><li><p>Rekit</p><p>在Create React App基础上，额外整合里更多的最佳实践，如：</p><ul><li>Redux</li><li>React Router</li><li>Less/Scss 做样式文件的编译</li><li>Feature Oriented Architecture 一种开发大型项目架构的实践，它可以把大项目的复杂度拆分成一个个小的feature，每个小feature都尽量保持独立，互相之间松耦合，便于开发出可扩展、可维护的web应用。</li><li>IDE 帮助更好地组件源代码，以及帮助做代码生成的工作。</li></ul><img src="image-20210414140516258.png" alt="image-20210414140516258" style="zoom:80%"></li><li><p>Online: Codesandbox.io</p><ul><li><p>在线的开发平台，不需要本地搭任何环境，在它的在线IDE里就能创建项目、编写代码。它支持react、vue和angular项目的创建。</p><blockquote><p>这个IDE比较厉害的一点是，它的webpack打包是运行在浏览器端的（webpack通常运行在node环境下），安装依赖也都是在前端完成的，大大提高打包的速度。</p></blockquote></li><li><p>使用步骤：</p><ol><li>打开<a target="_blank" rel="noopener" href="https://codesandbox.io/">官网</a></li><li>点击OPEN REACT(或Create Sandbox)即可创建。</li></ol></li></ul></li></ol><h1 id="09丨打包和部署"><a href="#09丨打包和部署" class="headerlink" title="09丨打包和部署"></a>09丨打包和部署</h1><p><strong>9.1 为什么需要打包？</strong></p><ol><li><p>编译ES6语法特性，编译JSX</p><p>因为这些语言、语法并不能被浏览器直接执行，而且需要考虑到兼容性问题，所以需要一些编译的工具把这些语法进行转换</p></li><li><p>整合资源，例如图片、外部的样式文件(Less/Sass)、svg、xml等</p></li><li><p>优化代码的体积</p><p>比如对变量名进行缩短、去除注释、去除空格、去除不必要的变量</p></li></ol><p><strong>9.2 使用Webpack进行打包</strong></p><ul><li><p>它可以把项目中的所有资源进行整合，比如JavaScript、png、sass，对于每种资源，webpack都可以用插件的方式去载入对应的loader，这个loader能决定自己支持什么样的语法，loader的输出对应的就是可执行的JavaScript语言，可兼容多个平台、多个版本浏览器。</p><img src="image-20210414143403954.png" alt="image-20210414143403954" style="zoom:67%"><p>目前的脚手架工具都配置了较全面的打包配置，我们只需要做少量修改即可。</p></li><li><p>打包的注意事项：</p><ol><li><p>设置nodejs环境为production</p><p>可以在scripts/build.js中设置环境变量<code>process.env.BABEL_ENV=&#39;production&#39;</code>和<code>process.env.NODE_ENV=&#39;production&#39;</code></p></li><li><p>禁用开发时的专用代码，比如logger</p><p>根据环境变量决定哪些代码在哪个环境运行，比如redux的配置中，在store.js中指定了一个中间件redux-logger，这个中间件用来在控制台输出所有action的信息，显然这个只需要在开发时使用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> middlewares = [</span><br><span class="line">    thunk, router</span><br><span class="line">]</span><br><span class="line"><span class="keyword">if</span>(process.env.NODE_ENV === <span class="string">&#x27;development&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; createLogger &#125; = <span class="built_in">require</span>(<span class="string">&#x27;redux-logger&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> logger = createLogger(&#123;<span class="attr">collapsed</span>: <span class="literal">true</span>&#125;)</span><br><span class="line">    middlewares.push(logger)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>打包时，webpack会检测该条件，为false不会打包到最终结果中。</p></li><li><p>设置应用的根路径</p><p>在package.json中有个homepage属性，会告诉webpack，应用程序会部署在哪个路径下，对于github而言，如果部署到github pages，就是这样的路径：<code>&quot;homepage&quot;: &quot;https://supnate.github.io/gt-demo&quot;</code>；如果要部署到cdn，这里就是个cdn的路径，所以最终打包出的结果就能从这个路径开始去寻找其他的资源。</p></li></ol></li><li><p>具体打包和部署</p><p>执行<code>$ npm run build</code>打包出bundle.js文件，所有的打包结果都会出现在build(我习惯用dist)目录下，只需要把这个js文件及其他资源部署到server上即可。</p></li></ul><h1 id="10丨Redux-1-前端为何需要状态管理库"><a href="#10丨Redux-1-前端为何需要状态管理库" class="headerlink" title="10丨Redux(1)  前端为何需要状态管理库"></a>10丨Redux(1) 前端为何需要状态管理库</h1><p><strong>10.1 Redux: JS状态管理框架</strong></p><ul><li><p>React的组件是把state转换成DOM的结构，这是在组件内部发生的。</p></li><li><p>Redux是把这个状态移到了组件之外，把全局所有状态都放在一个全局的store中，Redux最核心的概念是，它全局只有一个唯一的store，这个store负责提供整个应用程序所有的状态，所有组件的状态都可以放在外部的store中，当store有任何变化，这个组件也相应更新，页面中不同的部分可能来自store中不同的节点。Redux store中的结构也是个tree的结构，跟组件的tree结构是映射的关系。</p><img src="2021414162225565.jpg" alt="2021414162225565" style="zoom:33%"></li><li><p>Redux核心的出发点是让组件间的通信变得更加容易：</p><img src="image-20210414162723651.png" alt="image-20210414162723651" style="zoom:45%"><ul><li>从左图可以看到，假如没有一个全局的状态管理，组件间的通信会非常麻烦：一个父组件要把状态传递到子组件必须通过props一层一层传递下去，当一个子组件的状态发生变化时，想让父组件知道，它就必须暴露一个事件出去才能通信，也就是说它的组件通信的逻辑非常依赖组件的层次结构。</li><li>如果平级的两个节点想要通信，只能通过父节点中转的方式进行，所以Redux提供了一个解决方案：把store放在所有组件之外，所有的组件都和这个store进行通信，组件之间互相通信就会变得少一点，当store发生变化，组件就能拿到store数据，当组件内部有个user action要触发store变化，就直接去更新store，这其实是个单向数据流过程。</li></ul></li></ul><p><strong>10.2 Redux特性</strong></p><ol><li><p>Single Source of Truth</p><ul><li><p>传统MVC架构下，一个页面有很多view和model，view和model之间是互相依赖、互相绑定的关系，view内部可能有自己的状态，在model中放的业务逻辑的数据，一个model可能被多个view使用，一个view可能也会使用多个model，关系错综复杂，一旦发现哪里出现bug，想要追踪状态在哪里发生错误就非常困难。</p><img src="image-20210414163534899.png" alt="image-20210414163534899" style="zoom:60%"></li><li><p>Redux提供的这个SST，把所有状态都放在一个唯一的store中，它是状态的唯一来源，所有的view都依赖这个store，view内部也尽量没有自己的状态，当store中数据变化，view会得到更新，如果view上有个用户的操作，它会通过事件去通知store进行变化，这样使整个应用程序更加容易理解和追踪，当发生问题时，只需检查当前的状态是否正确即可。</p><img src="image-20210414163941419.png" alt="image-20210414163941419" style="zoom:50%"></li></ul></li><li><p>可预测性</p><p>​ 意思是Redux的状态非常稳定，它要产生一个新状态，一定是由一个action引起的，即<code>state+action=new state</code>，表示状态state若发生了变化，一定是由某个action触发的，会产生一个新的state，而不是在原来的state上做修改，这种特性也称之为immutability，即不可变数据，它也是Redux运行的一个基础。</p></li><li><p>纯函数更新store</p><ul><li><p>要更新一个Redux的store，必须通过一个action触发，然后通过一个reducer函数去产生一个新的store。</p></li><li><p>纯函数是指它的输出结果完全取决于输入参数，函数的内部不依赖任何外部参数和资源，这样整个函数就是非常容易预测和测试。</p><img src="image-20210414164709576.png" alt="image-20210414164709576" style="zoom:67%"></li></ul></li></ol><h1 id="11丨Redux-2-深入理解-Store-Action-Reducer"><a href="#11丨Redux-2-深入理解-Store-Action-Reducer" class="headerlink" title="11丨Redux(2)  深入理解 Store, Action, Reducer"></a>11丨Redux(2) 深入理解 Store, Action, Reducer</h1><p><strong>11.1 理解store</strong></p><ul><li><p>代码层面，产生一个store只需要调用createStore函数，它接收一个reducer参数，reducer也就是一个纯函数：</p><p><code>const store = createStore(reducer)</code></p></li><li><p>store有三个方法：</p><ol><li>getState() 可以得到当前的数据</li><li>dispatch(action) 比如在UI上用户点击一个button，就会产生一个action，store可以把它dispatch出去给reducer</li><li>subscribe(listener) 用来监听store的变化，当store有任何变化时，都会调用它的callback，即listener</li></ol></li><li><p>store的结构，如下图所示：</p><img src="image-20210414165736848.png" alt="image-20210414165736848" style="zoom:67%"><p>store包含三部分：</p><ol><li>State 是真正的数据（它是个纯JavaScript对象）</li><li>Dispatcher 是用来dispatch一个action的方法</li><li>Reducer 用来真正处理所有的action，也是真正地去更新store</li></ol></li></ul><p><strong>11.2 理解action</strong></p><p>​ 它描述了一个行为的数据结构，比如有个todoList应用，想要增加一条todoItem，用一个action去描述的数据结构如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    type: ADD_TODO,</span><br><span class="line">    text: <span class="string">&#x27;Build my first Redux app&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>​ 它指定一个数据类型即action的类型为ADD_TODO，通常是个常量的字符串，text用来描述要做的事情，所以这个action就描述了ADD_TODO的行为，它如何去触发的store的更新呢？通过reducer进行的。</p><p><strong>11.3 理解reducer</strong></p><ul><li><p>它是个函数，接收两个参数：state - 之前的状态或者初始状态initialState、action。</p></li><li><p>需要注意一点，所有的reducer会接收到所有的action，也就是说一个action通过store dispatch出去，所有系统中定义的reducer都能接收到。</p></li><li><p>如果判断自己能否执行？通过action.type判断，符合这种类型就继续更新store(即返回一个新的store，包含了旧store的部分和要更新的部分)。下图使得更新后的store上多了一条新的数据，使所有绑定在store上的组件都得以更新。</p><img src="image-20210414173639751.png" alt="image-20210414173639751" style="zoom:80%"></li></ul><p><strong>11.4 整体看Redux</strong></p><p>​ 底部UI部分有两个button，点击deposit存10元钱，形成一个Action，这个action被Dispatcher dispatch出去到Reducer，reducer处理这个action，从而形成一个新的State，意味着更新了store，而store发生变化之后会通知UI，UI上显示的值就会发生变化。点击withdraw取10元钱的逻辑同理。</p><img src="image-20210414174516751.png" alt="image-20210414174516751" style="zoom:67%"> <img src="image-20210414174908706.png" alt="image-20210414174908706" style="zoom:67%"><p><strong>介绍两个工具函数：</strong></p><p><strong>11.5 理解combineReducers</strong></p><ul><li><p>如果系统中有多个reducer，可以通过这个工具函数combineReducers组合到一起使用：</p><img src="image-20210414175214151.png" alt="image-20210414175214151" style="zoom:75%"><p>combineReducers接收多个reducers作为参数，最终形成一个封装过的函数，这个封装后的函数也是一个reducer，它会把action分别散发到不同的子reducer中。</p></li></ul><p><strong>11.6 理解bindActionCreators</strong></p><ul><li><p>有两种写法：</p><img src="image-20210414175755195.png" alt="image-20210414175755195" style="zoom:80%"><p>可以将写法2中的dispatch进行封装成：</p><img src="image-20210414175813516.png" alt="image-20210414175813516" style="zoom:80%"><p>其实不需要我们自己写，直接使用redux的工具函数bindActionCreators即可。</p></li><li><p>bindActionCreators具体为：</p><img src="image-20210415154537735.png" alt="image-20210415154537735" style="zoom:90%"></li></ul><p><strong>11.7 Redux(它是独立于UI框架之外的状态管理框架)整个流程代码演示</strong></p><ul><li><p>使用redux首先要createStore，但是createStore接收一个参数是reducer函数，所以首先要定义一个reducer</p></li><li><p>reducer要接收一个参数state - 当前的状态，因为第一次执行时没有初始状态，所以要定义一个initialState，如果没有state传进来就用初始状态；第二个参数是action，代码中它有三种类型，不同type下，每次reducer执行都会返回一个新的对象，而不是直接修改已有的state，因为直接修改它，redux无法监听到这种变化。定义reducer后，就可以createStore了，它可以dispatch action了。</p></li><li><p>action函数（也叫actionCreator）返回了action对象</p></li><li><p>用store将action dispatch出去（代码中的subscribe监听了store的变化）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line">import &#123; createStore &#125; from &quot;redux&quot;;</span><br><span class="line"></span><br><span class="line">function run() &#123;</span><br><span class="line">    &#x2F;&#x2F; Store initial state</span><br><span class="line">    const initialState &#x3D; &#123; count: 0 &#125;;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; reducer</span><br><span class="line">    const counter &#x3D; (state &#x3D; initialState, action) &#x3D;&gt; &#123;</span><br><span class="line">        switch (action.type) &#123;</span><br><span class="line">            case &quot;PLUS_ONE&quot;:</span><br><span class="line">                return &#123; count: state.count + 1 &#125;;</span><br><span class="line">            case &quot;MINUS_ONE&quot;:</span><br><span class="line">                return &#123; count: state.count - 1 &#125;;</span><br><span class="line">            case &quot;CUSTOM_COUNT&quot;:</span><br><span class="line">                return &#123;</span><br><span class="line">                    count: state.count + action.payload.count</span><br><span class="line">                &#125;;</span><br><span class="line">            default:</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">        return state;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    const todos &#x3D; (state &#x3D; &#123;&#125;) &#x3D;&gt; state;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; Create store</span><br><span class="line">    const store &#x3D; createStore(counter);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; Action creator</span><br><span class="line">    function plusOne() &#123;</span><br><span class="line">        &#x2F;&#x2F; action</span><br><span class="line">        return &#123; type: &quot;PLUS_ONE&quot; &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function minusOne() &#123;</span><br><span class="line">        return &#123; type: &quot;MINUS_ONE&quot; &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function customCount(count) &#123;</span><br><span class="line">        return &#123; type: &quot;CUSTOM_COUNT&quot;, payload: &#123; count &#125; &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    store.subscribe(() &#x3D;&gt; console.log(store.getState()));</span><br><span class="line">    store.dispatch(plusOne());</span><br><span class="line">    store.dispatch(minusOne());</span><br><span class="line">    store.dispatch(customCount(5));</span><br><span class="line">&#125;</span><br><span class="line">export default () &#x3D;&gt; (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;button onClick&#x3D;&#123;run&#125;&gt;Run&lt;&#x2F;button&gt;</span><br><span class="line">        &lt;p&gt;* 请打开控制台查看运行结果&lt;&#x2F;p&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>控制台打出的结果如下：</p><img src="image-20210415161329451.png" alt="image-20210415161329451"></li><li><p>使用bindActionCreators后，上面部分代码可改为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createStore, bindActionCreators &#125; from &quot;redux&quot;;</span><br><span class="line"></span><br><span class="line">function run() &#123;</span><br><span class="line">    plusOne &#x3D; bindActionCreators(plusOne, store.dispatch)</span><br><span class="line">	&#x2F;&#x2F; store.dispatch(plusOne());</span><br><span class="line">    plusOne()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果同上。</p></li><li><p>使用combineReducers，它的作用是将多个reducer组合成一个新的reducer，上面部分代码可改为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createStore, combineReducers, bindActionCreators &#125; from &quot;redux&quot;;</span><br><span class="line"></span><br><span class="line">function run() &#123;</span><br><span class="line">    &#x2F;&#x2F; reducer</span><br><span class="line">    const todos &#x3D; (state &#x3D; &#123;&#125;) &#x3D;&gt; state</span><br><span class="line">    const store &#x3D; createStore(combineReducers(&#123;</span><br><span class="line">        todos,</span><br><span class="line">        counter</span><br><span class="line">    &#125;))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果变成：</p><img src="image-20210415162337374.png" alt="image-20210415162337374"></li></ul><h1 id="12丨Redux-3-在React中使用Redux"><a href="#12丨Redux-3-在React中使用Redux" class="headerlink" title="12丨Redux(3)  在React中使用Redux"></a>12丨Redux(3) 在React中使用Redux</h1><p><strong>12.1 connect</strong></p><ul><li><p>组件需要获取store中的数据，组件上的UI操作需要更新store中的数据，是通过connect连接起来的，redux提供了一个package，即react-redux，里面有个connect方法。</p></li><li><p>基本语法：</p><img src="image-20210415163131756.png" alt="image-20210415163131756" style="zoom:90%"></li><li><p>工作原理：高阶组件</p><p>上图中<code>connect(mapStateToProps, mapDispatchToProps)(SidePanel)</code>是通过高阶组件的方式connect已有的组件。</p><img src="image-20210415163444902.png" alt="image-20210415163444902" style="zoom:67%"><p>左边是组件树的状态，connect后会在这个数据逻辑里访问store和action；右边的更新逻辑是redux自身的逻辑：Actions分发出去到Reducers，然后更新Store，store会把数据传到高阶组件，高价组件会把数据传到需要用到store数据的组件树中。</p></li></ul><p><strong>12.2 具体在React中使用Redux</strong></p><ul><li><p>思路分析：</p><ul><li><p>定义后，需要思考我们需要关注的是store上的哪些数据，通过mapStateToProps()方法定义，参数是store的根节点（我们通过store.getState()得到的就是它）。</p><blockquote><p>此处需要注意，如果我们把整个store绑定到这个组件中，那么store中任何节点的变化都会触发这个组件的更新，而只绑定到count上，只有当count发生变化时，这个组件才会被更新，所以在mapStateToProps中我们必须把它能访问的节点限制到最小范围，这样才能保证组件的高性能。</p></blockquote></li><li><p>mapDispatchToProps()方法使组件能够访问redux的action，从而更新store。</p></li><li><p>使用时，我们需要在根节点上定义一个provider，它的值是store，这样它下面的所有节点都能访问到store</p></li></ul></li><li><p>代码如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line">import &#123; bindActionCreators, createStore &#125; from &quot;redux&quot;;</span><br><span class="line">import &#123; Provider, connect &#125; from &quot;react-redux&quot;;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Store initial state</span><br><span class="line">const initialState &#x3D; &#123; count: 0 &#125;;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; reducer</span><br><span class="line">const counter &#x3D; (state &#x3D; initialState, action) &#x3D;&gt; &#123;</span><br><span class="line">    switch (action.type) &#123;</span><br><span class="line">        case &quot;PLUS_ONE&quot;:</span><br><span class="line">            return &#123; count: state.count + 1 &#125;;</span><br><span class="line">        case &quot;MINUS_ONE&quot;:</span><br><span class="line">            return &#123; count: state.count - 1 &#125;;</span><br><span class="line">        case &quot;CUSTOM_COUNT&quot;:</span><br><span class="line">            return &#123; count: state.count + action.payload.count &#125;;</span><br><span class="line">        default:</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">    return state;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Create store</span><br><span class="line">const store &#x3D; createStore(counter);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Action creator</span><br><span class="line">function plusOne() &#123;</span><br><span class="line">    &#x2F;&#x2F; action</span><br><span class="line">    return &#123; type: &quot;PLUS_ONE&quot; &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function minusOne() &#123;</span><br><span class="line">    return &#123; type: &quot;MINUS_ONE&quot; &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export class Counter extends React.Component &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        const &#123; count, plusOne, minusOne &#125; &#x3D; this.props;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className&#x3D;&quot;counter&quot;&gt;</span><br><span class="line">                &lt;button onClick&#x3D;&#123;minusOne&#125;&gt;-&lt;&#x2F;button&gt;</span><br><span class="line">                &lt;span style&#x3D;&#123;&#123; display: &quot;inline-block&quot;, margin: &quot;0 10px&quot; &#125;&#125;&gt;</span><br><span class="line">                    &#123;count&#125;</span><br><span class="line">                &lt;&#x2F;span&gt;</span><br><span class="line">                &lt;button onClick&#x3D;&#123;plusOne&#125;&gt;+&lt;&#x2F;button&gt;</span><br><span class="line">            &lt;&#x2F;div&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function mapStateToProps(state) &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">        count: state.count</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function mapDispatchToProps(dispatch) &#123;</span><br><span class="line">    return bindActionCreators(&#123; plusOne, minusOne &#125;, dispatch);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const ConnectedCounter &#x3D; connect(mapStateToProps, mapDispatchToProps)(Counter);</span><br><span class="line"></span><br><span class="line">export default class CounterSample extends React.Component &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;Provider store&#x3D;&#123;store&#125;&gt;</span><br><span class="line">                &lt;ConnectedCounter &#x2F;&gt;</span><br><span class="line">            &lt;&#x2F;Provider&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>效果如下：</p><img src="image-20210415165358069.png" alt="image-20210415165358069" style="zoom:80%"></li></ul><h1 id="13丨Redux-4-理解异步-Action，Redux-中间件"><a href="#13丨Redux-4-理解异步-Action，Redux-中间件" class="headerlink" title="13丨Redux(4)  理解异步 Action，Redux 中间件"></a>13丨Redux(4) 理解异步 Action，Redux 中间件</h1><p><strong>13.1 Redux异步请求</strong></p><ul><li><p>在View上点击button，触发了一个Action</p></li><li><p>这个action可能不是一个标准的JavaScript对象，它可能描述了如何发送请求、如何处理它的结果</p></li><li><p>然后到Dispatcher，在dispatcher之前多了一个Middlewares中间件，它的作用是可以截获某种特殊类型的action，比如对ajax请求这样的action，可以有个叫做react-thunk这样的中间件进行处理，它接收到之后不是把它dispatch到reducer，而是去访问一个API，当api响应结果成功时，就发一个成功的action出去，如果失败就发个失败的action出去。（这种中间件的思路不是redux自带的，只是一种设计模式）</p></li><li><p>所以一个ajax请求的action到中间件后，会进行预处理，然后才把结果的action dispatch给reducer来更新store。</p><img src="image-20210415170251462.png" alt="image-20210415170251462" style="zoom:60%"></li><li><p>总结：一个异步action不是一个特殊类型的action，而是多个同步action的组合使用。</p></li></ul><p><strong>13.2 Redux中间件（Middleware）</strong></p><ul><li><p>它有两个作用：</p><ol><li><p>截获action</p><p>它判断是否需要截获这个action的机制是，这个action是不是一个Promise，是不是一个函数，如果是就会执行它，因为这个函数内部真正地会发ajax请求。</p></li><li><p>发出action</p></li></ol></li></ul><p><strong>13.3 demo：如何通过redux异步action发出异步请求？</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; EXAMPLES_FETCH_REDDIT_LIST_BEGIN, EXAMPLES_FETCH_REDDIT_LIST_SUCCESS, EXAMPLES_FETCH_REDDIT_LIST_FAILURE, EXAMPLES_FETCH_REDDIT_LIST_DISMISS_ERROR &#125; <span class="keyword">from</span> <span class="string">&#x27;./constants&#x27;</span></span><br><span class="line"><span class="comment">// 这个异步action产生了三种同步action</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">fetchRedditList</span>(<span class="params">args = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">dispatch</span> =&gt;</span> &#123;</span><br><span class="line">        dispatch(&#123;</span><br><span class="line">            type: EXAMPLES_FETCH_REDDIT_LIST_BEGIN</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> doRequest = axios.get(<span class="string">&#x27;http://www.reddit.com/r/reactjs.json&#x27;</span>)</span><br><span class="line">            doRequest.then(</span><br><span class="line">                res =&gt; &#123;</span><br><span class="line">                    dispatch(&#123;</span><br><span class="line">                        type: EXAMPLES_FETCH_REDDIT_LIST_SUCCESS,</span><br><span class="line">                        data: res.data</span><br><span class="line">                    &#125;)</span><br><span class="line">                    resolve(res)</span><br><span class="line">                &#125;,</span><br><span class="line">                err =&gt; &#123;</span><br><span class="line">                    dispatch(&#123;</span><br><span class="line">                        type: EXAMPLES_FETCH_REDDIT_LIST_FAILURE,</span><br><span class="line">                        data: &#123; <span class="attr">error</span>: err &#125;</span><br><span class="line">                    &#125;)</span><br><span class="line">                    reject(err)</span><br><span class="line">                &#125;</span><br><span class="line">            )</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> promise</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">state, action</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span>(action.type) &#123;</span><br><span class="line">        <span class="keyword">case</span> EXAMPLES_FETCH_REDDIT_LIST_BEGIN:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                fetchRedditListPending: <span class="literal">true</span>,</span><br><span class="line">                fetchRedditListError: <span class="literal">null</span></span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">case</span> EXAMPLES_FETCH_REDDIT_LIST_SUCCESS:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                redditList: action.data.data.children,</span><br><span class="line">                fetchRedditListPending: <span class="literal">false</span>,</span><br><span class="line">                fetchRedditListError: <span class="literal">null</span></span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">case</span> EXAMPLES_FETCH_REDDIT_LIST_FAILURE:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                fetchRedditListPending: <span class="literal">false</span>,</span><br><span class="line">                fetchRedditListError: action.data.error</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">case</span> EXAMPLES_FETCH_REDDIT_LIST_DISMISS_ERROR:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                fetchRedditListError: <span class="literal">null</span></span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> state</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="14丨Redux-5-如何组织Action和Reducer"><a href="#14丨Redux-5-如何组织Action和Reducer" class="headerlink" title="14丨Redux(5)  如何组织Action和Reducer"></a>14丨Redux(5) 如何组织Action和Reducer</h1><p><strong>14.1 “标准”形式Redux Action的问题</strong></p><ol><li>所有Action放一个文件，会无限扩展</li><li>Action、Reducer分开，实现业务逻辑时需要来回切换</li><li>系统中有哪些Action不够直观</li></ol><p><strong>14.2 推荐新的方式：单个action和reducer放在同一个文件中</strong></p><img src="image-20210415173914631.png" alt="image-20210415173914631" style="zoom:80%"><p>好处：</p><ol><li>易于开发：不用在action和reducer文件间来回切换</li><li>易于维护：每个action文件都很小，容易理解</li><li>易于测试：每个业务逻辑只需对应一个测试文件</li><li>易于理解：文件名就是action名字，文件列表就是action列表</li></ol><p><strong>14.3 demo</strong></p><ul><li><p>以todomvc为例</p><img src="image-20210415174256780.png" alt="image-20210415174256780" style="zoom:80%"></li><li><p>新建Actions问价夹，里面包含两个不同的action：</p><p>addTodo.js:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; TODO_ADD_TODO &#125; <span class="keyword">from</span> <span class="string">&#x27;./constants&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">addTodo</span>(<span class="params">text</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        type: TODO_ADD_TODO,</span><br><span class="line">        text</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">state, action</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span>(action.type) &#123;</span><br><span class="line">        <span class="keyword">case</span> TODO_ADD_TODO:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                todos: [</span><br><span class="line">                    ...state.todos,</span><br><span class="line">                    &#123;</span><br><span class="line">                        id: state.todos.reduce(<span class="function">(<span class="params">maxId, todo</span>) =&gt;</span> <span class="built_in">Math</span>.max(todo.id, maxId), -<span class="number">1</span>) + <span class="number">1</span>,</span><br><span class="line">                        completed: <span class="literal">false</span>,</span><br><span class="line">                        text: action.text</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            retrun state</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>clearCompleted.js:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; TODO_CLEAR_COMPLETED &#125; <span class="keyword">from</span> <span class="string">&#x27;./constants&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">clearCompleted</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        type: TODO_CLEAR_COMPLETED</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">state, action</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span>(action.type) &#123;</span><br><span class="line">        <span class="keyword">case</span> TODO_CLEAR_COMPLETED:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                todos: state.todos.filter(<span class="function"><span class="params">todo</span> =&gt;</span> todo.completed === <span class="literal">false</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> state</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>如何load这些部分呢？新建Misc/redux文件夹，里面包含:</p><p>actions.js把所有的action导进来再导出去：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> &#123; addTodo &#125; <span class="keyword">from</span> <span class="string">&#x27;./addTodo&#x27;</span></span><br><span class="line"><span class="keyword">export</span> &#123; completeTodo &#125; <span class="keyword">from</span> <span class="string">&#x27;./completeTodo&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line">reducer.js从不同的action文件中把所有的都导进来再导出去：</span><br><span class="line">  </span><br><span class="line">  &#96;&#96;&#96;js</span><br><span class="line">  import initialState from &#39;.&#x2F;initialState&#39;</span><br><span class="line">  import &#123; reducer as addTodoReducer &#125; from &#39;.&#x2F;addTodo&#39;</span><br><span class="line">  import &#123; reducer as completeTodoReducer &#125; from &#39;.&#x2F;completeTodo&#39;</span><br><span class="line">  const reducers &#x3D; &#123;</span><br><span class="line">      addTodoReducer,</span><br><span class="line">      completeTodoReducer</span><br><span class="line">  &#125;</span><br><span class="line">  export default function reducer(state &#x3D; initialState, action) &#123;</span><br><span class="line">      let newState</span><br><span class="line">      switch(action.type) &#123;</span><br><span class="line">          default:</span><br><span class="line">              newState &#x3D; state</span><br><span class="line">              break</span><br><span class="line">      &#125;</span><br><span class="line">      return reducers.reduce((s, r) &#x3D;&gt; r(s, action), newState)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li></ul><h1 id="15丨Redux-6-理解不可变数据（Immutability）"><a href="#15丨Redux-6-理解不可变数据（Immutability）" class="headerlink" title="15丨Redux(6)  理解不可变数据（Immutability）"></a>15丨Redux(6) 理解不可变数据（Immutability）</h1><p><strong>15.1 不可变数据</strong></p><p>​ 它是redux的一个运行基础，它的含义是不可以直接修改它的值，而是要通过复制它的值并且通过产生一个新对象的方式来得到一个新数据，它包含了修改的部分。</p><img src="image-20210416111232942.png" alt="image-20210416111232942" style="zoom:70%"><p>​ 如图，假设左边是个状态树，如果要更新黄色节点上的某个状态的值，首先要产生一个全新对象(如右图)，在这个路径上(绿色部分)所有对象都处于一个被修改的状态，但是其他节点是不发生变化的。不可变数据不能直接修改的，非要修改就必须将它进行一份复制，无论是浅复制还是深复制，然后去包含将要修改的部分。</p><p><strong>15.2 为何需要不可变数据</strong></p><ul><li><p>原因：</p><ol><li><p>性能优化</p><p>当一个store需要变化时，我们需要通知所有组件更新，store的所有变化都是由action触发，触发在原来旧的state上，形成一个新的state，这个新的state已不是原来那个state，它们分别是两个完全不同的对象。当旧state和新state不是同一个对象时，我们就知道这个store发生了变化，不需要去比较它其中的值是否变化，只需要比较两个引用的状态是否一样，这可以达到性能优化的目的。</p><p>redux中的store都是不可变数据，每个节点都是不可变数据，当一个组件绑定在某个节点上，只需判断前一个状态和后一个的引用是否相等，就能知道当前的store有没有变化，从而决定是否要更新组件。不需要做深层次遍历每个值是否相等，只要通过引用比较就可以达到这个目的。</p></li><li><p>易于调试和跟踪</p><p>当store发生变化时，任何时刻都可以记录之前和之后的状态，并且能够计算得到它们diff的值，这样可以在调试时看到前面和后面的状态。</p></li><li><p>易于推测</p><p>在任何时刻都可以推测出store是由什么引起的变化，store一定是由action触发，action之前和之后的状态分别是什么，通过这个值的比较可以很容易地判断当前的action是否被正确地处理。</p></li></ol></li></ul><p><strong>15.3 如何操作不可变数据</strong></p><ol><li><p>原生写法：<code>&#123;...&#125;</code>(浅复制)，<code>Object.assign</code> 性能最高</p><p>场景：todoList中要增加一条todoItem</p><img src="image-20210416112956630.png" alt="image-20210416112956630" style="zoom:80%"></li><li><p>immutability-helper 主要用于层次比较深的节点的更新</p><img src="image-20210416113125001.png" alt="image-20210416113125001" style="zoom:80%"></li><li><p>immer 性能差，不推荐</p></li></ol><h1 id="16丨React-Router（1）：路由不只是页面切换，更是代码组织方式"><a href="#16丨React-Router（1）：路由不只是页面切换，更是代码组织方式" class="headerlink" title="16丨React Router（1）：路由不只是页面切换，更是代码组织方式"></a>16丨React Router（1）：路由不只是页面切换，更是代码组织方式</h1><p><strong>16.1 为什么需要路由？</strong></p><ol><li><p>单页应用需要进行页面切换（这时候浏览器不刷新）</p></li><li><p>通过URL可以定位到页面</p></li><li><p>更有语义的组织资源</p><p>因为每个页面的业务功能其实是高内聚松耦合的，通过URL可以将它们做个很好的隔离，不仅是业务上的功能，包括做lazyLoad或者其它的资源组织，路由都可以帮助到。</p><blockquote><p>React Router和React、Redux合称为React全家桶。</p></blockquote></li></ol><p><strong>16.2 路由实现的基本架构</strong></p><ul><li><p>路由定义</p><p>通过react标记或配置文件来定义路由</p></li><li><p>Router</p><p>定义好的路由通过React Router的解析，根据URL的地址返回不同的组件</p></li><li><p>页面布局</p><p>定义一个组件容器，通常是页面布局的一部分，由React Router控制里面展示什么，当URL变化时，其实只是组件容器中的内容发生了变化，左边的导航栏或顶部的header实际上不变。</p><blockquote><p>原理：React Router是在一个组件容器中根据URL判断当前应该显示什么样的组件，去实现一个路由的功能。</p></blockquote><img src="image-20210416114034245.png" alt="image-20210416114034245" style="zoom:67%"></li></ul><p><strong>16.3 React Router的实现</strong></p><ul><li><p>有个Router标记告诉React Router这下面可能会有其他Route的定义，需要由它去解析。</p></li><li><p>page-container就是由React Router控制的一个容器，里面通过Route配置路由的定义，它会指定一个path和component，意味着当前URL是这个path时用这个component去展示。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line">import &#123; HashRouter as Router, Route, Link &#125; from &quot;react-router-dom&quot;;</span><br><span class="line"></span><br><span class="line">const Home &#x3D; () &#x3D;&gt; &lt;h1&gt;Home&lt;&#x2F;h1&gt;;</span><br><span class="line">const Hello &#x3D; () &#x3D;&gt; &lt;h1&gt;Hello&lt;&#x2F;h1&gt;;</span><br><span class="line">const About &#x3D; () &#x3D;&gt; &lt;h1&gt;About Us&lt;&#x2F;h1&gt;;</span><br><span class="line"></span><br><span class="line">export default class RouterSample extends React.PureComponent &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;Router&gt;</span><br><span class="line">                &lt;div&gt;</span><br><span class="line">                    &lt;ul id&#x3D;&quot;menu&quot;&gt;</span><br><span class="line">                        &lt;li&gt;</span><br><span class="line">                            &lt;Link to&#x3D;&quot;&#x2F;home&quot;&gt;Home&lt;&#x2F;Link&gt;</span><br><span class="line">                        &lt;&#x2F;li&gt;</span><br><span class="line">                        &lt;li&gt;</span><br><span class="line">                            &lt;Link to&#x3D;&quot;&#x2F;hello&quot;&gt;Hello&lt;&#x2F;Link&gt;</span><br><span class="line">                        &lt;&#x2F;li&gt;</span><br><span class="line">                        &lt;li&gt;</span><br><span class="line">                            &lt;Link to&#x3D;&quot;&#x2F;about&quot;&gt;About&lt;&#x2F;Link&gt;</span><br><span class="line">                        &lt;&#x2F;li&gt;</span><br><span class="line">                    &lt;&#x2F;ul&gt;</span><br><span class="line"></span><br><span class="line">                    &lt;div id&#x3D;&quot;page-container&quot;&gt;</span><br><span class="line">                        &lt;Route path&#x3D;&quot;&#x2F;home&quot; component&#x3D;&#123;Home&#125; &#x2F;&gt;</span><br><span class="line">                        &lt;Route path&#x3D;&quot;&#x2F;hello&quot; component&#x3D;&#123;Hello&#125; &#x2F;&gt;</span><br><span class="line">                        &lt;Route path&#x3D;&quot;&#x2F;about&quot; component&#x3D;&#123;About&#125; &#x2F;&gt;</span><br><span class="line">                    &lt;&#x2F;div&gt;</span><br><span class="line">                &lt;&#x2F;div&gt;</span><br><span class="line">            &lt;&#x2F;Router&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p><strong>16.4 React Router的特性</strong></p><p>​ 和后端路由对比，React Router的特性有：</p><ol><li><p>声明式路由定义</p><p>这个Route像使用React的一个标记一样，是作为一个tag去定义的。</p></li><li><p>动态路由</p><p>路由是在页面render时被实时解析的。</p></li></ol><p><strong>16.5 三种路由实现方式</strong></p><ol><li><p>URL路径</p><p>大部分情况采用本方式，但低版本浏览器可能不支持，导致切换路由不刷新，就要采取hash路由。</p></li><li><p>hash路由</p><p>不是通过/，而是通过#，支持低版本浏览器。</p></li><li><p>内存路由</p><p>意思是路由并不会反映到URL上，即点击切换路由，URL并没有发生变化，但页面内容变了，这是因为路由的状态完全存在内存中。</p><p>通常在做服务器端渲染时使用，前端也可以用，比如在上例中补充：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import &#123; MemoryRouter &#125; from &#39;react&#39;</span><br><span class="line">export default class RouterSample extends React.PureComponent &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        return (</span><br><span class="line">        	&lt;MemoryRouter&gt;...&lt;&#x2F;MemoryRouter&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><p><strong>16.6 基于路由配置进行资源组织</strong></p><p>​ 主要有三个目的：</p><ol><li><p>实现业务逻辑的松耦合</p><p>把页面相关的部分都组织在一起，无论是业务上的逻辑、代码还是懒加载lazyLoad，都可以基于路由实现。</p></li><li><p>易于扩展、重构和维护</p><p>没有把所有的路由都放到业务逻辑中实现，而是把它抽象出来，通过React Router来实现路由的配置，这样再增加新页面时就会非常清楚，去增加路由的配置即可。</p><p>因为业务的逻辑单元是一个个小的页面，而不单是个整体，所以容易重构和维护。</p></li><li><p>路由层面实现lazyLoad</p><p>如果我们在统一的地方定义路由，去加载不同组件时，都可以在那个点实现一个lazyLoad，在展示第一个页面时效率会比较高，速度也比较快。</p></li></ol><p><strong>16.7 React Router的核心API</strong></p><ul><li><p><code>&lt;Link&gt;</code> 普通链接，不会触发浏览器刷新</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Link &#125; from &#39;react-router-dom&#39;</span><br><span class="line">&lt;Link to&#x3D;&quot;&#x2F;about&quot;&gt;About&lt;&#x2F;Link&gt;</span><br></pre></td></tr></table></figure><p>它展现出的效果就和a标签在html中的效果是一样的。</p></li><li><p><code>&lt;NavLink&gt;</code> 类似Link，但是会添加当前选中状态</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;NavLink to&#x3D;&quot;&#x2F;faq&quot; activeClassName&#x3D;&quot;selected&quot;&gt;FAQs&lt;&#x2F;NavLink&gt;</span><br></pre></td></tr></table></figure></li><li><p><code>&lt;Prompt&gt;</code> 满足条件时提示用户是否离开当前页面</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Prompt &#125; from &#39;react-router&#39;</span><br><span class="line">&lt;Prompt when&#x3D;&#123;formIsHalfFilledOut&#125; message&#x3D;&quot;Are you sure you want to leave?&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure><p>做用户页面切换时的一个确认的操作，比如点击一个未填完的表单中的某个链接，可以用它询问提示。</p><p>when属性表示什么时候需要提示，message表示提示的信息。</p></li><li><p><code>&lt;Redirect&gt;</code> 重定向当前页面，例如登录判断</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Route, Redirect &#125; from &#39;react-router&#39;</span><br><span class="line">&lt;Route exact path&#x3D;&quot;&#x2F;&quot; render&#x3D;&#123;() &#x3D;&gt; &#123;</span><br><span class="line">    loggedIn ? (</span><br><span class="line">        &lt;Redirect to&#x3D;&quot;&#x2F;dashboard&quot; &#x2F;&gt;</span><br><span class="line">    ) : (</span><br><span class="line">        &lt;PublicHomePage &#x2F;&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;&#125; &#x2F;&gt;</span><br></pre></td></tr></table></figure></li><li><p><code>&lt;Route&gt;</code> 路由配置的核心标记，路径匹配时显示对应组件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import &#123; BrowserRouter as Router, Route &#125; from &#39;react-router-dom&#39;</span><br><span class="line">&lt;Router&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">    	&lt;Route exact path&#x3D;&quot;&#x2F;&quot; component&#x3D;&#123;Home&#125; &#x2F;&gt;</span><br><span class="line">    	&lt;Route path&#x3D;&quot;&#x2F;news&quot; component&#x3D;&#123;NewsFeed&#125; &#x2F;&gt;</span><br><span class="line">	&lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;Router&gt;</span><br></pre></td></tr></table></figure><p>exact属性表示是否精确匹配path。</p><p><route>单独使用时并不是排他的，比如定义了两个Route，它的path都可以匹配当前的路径，两个组件都会同时显示。</route></p></li><li><p><code>&lt;Switch&gt;</code> 只显示第一个匹配的路由</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Switch, Route &#125; from &#39;react-router&#39;</span><br><span class="line">&lt;Switch&gt;</span><br><span class="line">	&lt;Route exact path&#x3D;&quot;&#x2F;&quot; component&#x3D;&#123;Home&#125; &#x2F;&gt;</span><br><span class="line">	&lt;Route path&#x3D;&quot;&#x2F;about&quot; component&#x3D;&#123;About&#125; &#x2F;&gt;</span><br><span class="line">    &lt;Route path&#x3D;&quot;&#x2F;:user&quot; component&#x3D;&#123;User&#125; &#x2F;&gt;</span><br><span class="line">    &lt;Route component&#x3D;&#123;NoMatch&#125; &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;Switch&gt;</span><br></pre></td></tr></table></figure><p><switch>主要用来改变上述的多匹配的行为，如果把Route放到Switch中，只有第一条匹配的Route被显示，下面的就不会再render对应的组件了。</switch></p></li></ul><h1 id="17丨React-Router（2）：参数定义，嵌套路由的使用场景"><a href="#17丨React-Router（2）：参数定义，嵌套路由的使用场景" class="headerlink" title="17丨React Router（2）：参数定义，嵌套路由的使用场景"></a>17丨React Router（2）：参数定义，嵌套路由的使用场景</h1><p><strong>17.1 通过URL传递参数</strong></p><ul><li><p>如何通过URL传递参数：<code>&lt;Route path=&quot;/topic/:id&quot; ... /&gt;</code></p><p>将参数id作为URL路径的一部分比作为查询字符串的方式对搜索引擎更加友好，看上去也更加有语义。</p></li><li><p>如何获取参数：<code>this.props.match.params</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line">import &#123;</span><br><span class="line">    BrowserRouter as Router,</span><br><span class="line">    Route,</span><br><span class="line">    Link</span><br><span class="line">&#125; from &quot;react-router-dom&quot;;</span><br><span class="line">&#x2F;&#x2F; 会传递match这样的props给你的组件</span><br><span class="line">const Topic &#x3D; (&#123; match &#125;) &#x3D;&gt; (</span><br><span class="line">    &lt;h1&gt;Topic &#123;match.params.id&#125;&lt;&#x2F;h1&gt;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">export default class RouterParams extends React.PureComponent &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;Router&gt;</span><br><span class="line">                &lt;div&gt;</span><br><span class="line">                    &lt;ul id&#x3D;&quot;menu&quot;&gt;</span><br><span class="line">                        &lt;li&gt;&lt;Link to&#x3D;&quot;&#x2F;topic&#x2F;1&quot;&gt;Topic 1&lt;&#x2F;Link&gt;&lt;&#x2F;li&gt;</span><br><span class="line">                        &lt;li&gt;&lt;Link to&#x3D;&quot;&#x2F;topic&#x2F;2&quot;&gt;Topic 2&lt;&#x2F;Link&gt;&lt;&#x2F;li&gt;</span><br><span class="line">                        &lt;li&gt;&lt;Link to&#x3D;&quot;&#x2F;topic&#x2F;3&quot;&gt;Topic 3&lt;&#x2F;Link&gt;&lt;&#x2F;li&gt;</span><br><span class="line">                    &lt;&#x2F;ul&gt;</span><br><span class="line"></span><br><span class="line">                    &lt;div id&#x3D;&quot;page-container&quot;&gt;</span><br><span class="line">                        &lt;Route path&#x3D;&quot;&#x2F;topic&#x2F;:id&quot; component&#x3D;&#123;Topic&#125; &#x2F;&gt;</span><br><span class="line">                    &lt;&#x2F;div&gt;</span><br><span class="line">                &lt;&#x2F;div&gt;</span><br><span class="line">            &lt;&#x2F;Router&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><a target="_blank" rel="noopener" href="https://github.com/pillarjs/path-to-regexp">https://github.com/pillarjs/path-to-regexp</a></p></li><li><p>何时需要URL参数：页面状态尽量通过URL参数定义</p></li></ul><p><strong>17.2 嵌套路由</strong></p><ol><li><p>每个React组件都可以是路由容器</p></li><li><p>React Router的声明式语法可以方便定义嵌套路由</p></li><li><p>demo如下：</p><img src="image-20210416152351298.png" alt="image-20210416152351298" style="zoom:67%"><p>点击红框链接，红框内容及URL红线部分相应变化；点击绿框链接，绿框内容及URL绿色部分相应变化。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line">import &#123; BrowserRouter as Router, Route, Link &#125; from &quot;react-router-dom&quot;;</span><br><span class="line"></span><br><span class="line">const Category &#x3D; (&#123; match &#125;) &#x3D;&gt; (</span><br><span class="line">    &lt;h1&gt;Sub Category &#123;match.params.subId&#125;&lt;&#x2F;h1&gt;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">const SubCategory &#x3D; (&#123; match &#125;) &#x3D;&gt; (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;h1&gt;Category &#123;match.params.id&#125;&lt;&#x2F;h1&gt;</span><br><span class="line"></span><br><span class="line">        &lt;ul id&#x3D;&quot;menu&quot;&gt;</span><br><span class="line">            &lt;li&gt;</span><br><span class="line">                &lt;Link to&#x3D;&#123;&#96;&#x2F;category&#x2F;$&#123;match.params.id&#125;&#x2F;sub&#x2F;1&#96;&#125;&gt;</span><br><span class="line">                    Sub Category 1</span><br><span class="line">                &lt;&#x2F;Link&gt;</span><br><span class="line">            &lt;&#x2F;li&gt;</span><br><span class="line">            &lt;li&gt;</span><br><span class="line">                &lt;Link to&#x3D;&#123;&#96;&#x2F;category&#x2F;$&#123;match.params.id&#125;&#x2F;sub&#x2F;2&#96;&#125;&gt;</span><br><span class="line">                    Sub Category 2</span><br><span class="line">                &lt;&#x2F;Link&gt;</span><br><span class="line">            &lt;&#x2F;li&gt;</span><br><span class="line">            &lt;li&gt;</span><br><span class="line">                &lt;Link to&#x3D;&#123;&#96;&#x2F;category&#x2F;$&#123;match.params.id&#125;&#x2F;sub&#x2F;3&#96;&#125;&gt;</span><br><span class="line">                    Sub Category 3</span><br><span class="line">                &lt;&#x2F;Link&gt;</span><br><span class="line">            &lt;&#x2F;li&gt;</span><br><span class="line">        &lt;&#x2F;ul&gt;</span><br><span class="line">        &lt;div id&#x3D;&quot;page-container-2&quot;&gt;</span><br><span class="line">            &lt;Route path&#x3D;&quot;&#x2F;category&#x2F;:id&#x2F;sub&#x2F;:subId&quot; component&#x3D;&#123;Category&#125; &#x2F;&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">export default class NestedRoute extends React.PureComponent &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;Router&gt;</span><br><span class="line">                &lt;div&gt;</span><br><span class="line">                    &lt;ul id&#x3D;&quot;menu&quot;&gt;</span><br><span class="line">                        &lt;li&gt;&lt;Link to&#x3D;&quot;&#x2F;category&#x2F;1&quot;&gt;Category 1&lt;&#x2F;Link&gt;&lt;&#x2F;li&gt;</span><br><span class="line">                        &lt;li&gt;&lt;Link to&#x3D;&quot;&#x2F;category&#x2F;2&quot;&gt;Category 2&lt;&#x2F;Link&gt;&lt;&#x2F;li&gt;</span><br><span class="line">                        &lt;li&gt;&lt;Link to&#x3D;&quot;&#x2F;category&#x2F;3&quot;&gt;Category 3&lt;&#x2F;Link&gt;&lt;&#x2F;li&gt;</span><br><span class="line">                    &lt;&#x2F;ul&gt;</span><br><span class="line"></span><br><span class="line">                    &lt;div id&#x3D;&quot;page-container&quot;&gt;</span><br><span class="line">                        &lt;Route path&#x3D;&quot;&#x2F;category&#x2F;:id&quot; component&#x3D;&#123;SubCategory&#125; &#x2F;&gt;</span><br><span class="line">                    &lt;&#x2F;div&gt;</span><br><span class="line">                &lt;&#x2F;div&gt;</span><br><span class="line">            &lt;&#x2F;Router&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h1 id="18丨UI组件库对比和介绍"><a href="#18丨UI组件库对比和介绍" class="headerlink" title="18丨UI组件库对比和介绍"></a>18丨UI组件库对比和介绍</h1><p><strong>18.1 UI组件库的对比</strong></p><ul><li><p>Ant.Design (对比后更推荐它)</p><p>蚂蚁金服前端团队开发的，服务于企业级产品的设计体系。</p></li><li><p>Material UI</p><p>Google提供的，它没有具体的应用场景，设计风格更为时尚、花哨</p></li><li><p>Semantic UI</p><p>非常具有历史性，在jq时代就产生了，倾向于将UI作为一种language描述，如果从来没用过建议别用。</p></li></ul><p><strong>18.2 选择UI库的考虑因素</strong></p><ol><li><p>组件库是否完善和齐全</p><p>尽量能有对应组件直接拿来用，而不是还要自己去实现</p></li><li><p>样式风格是否符合业务需求</p><p>企业级应用对UI的要求是简洁明了，数据能够展现的比较密集、合理，Ant.Design可能更加符合；</p><p>移动端面向最终消费者的应用要求UI更加好看，每个button和字体要求比较大，可能Material UI更加符合。</p></li><li><p>API设计是否便捷和灵活</p><p>关系到我们用这个组件库开发效率是否高、是否方便</p></li><li><p>技术支持是否完善</p><p>主要体现在两方面：技术文档是否非常齐全、在github上提些问题能否快速解答</p></li><li><p>开发是否活跃</p><p>这个库是否有个稳定的团队进行快速地迭代和维护，保证遇到bug或需要一些功能时得到修复和满足</p></li></ol><h1 id="19丨使用Next（使用它创建React同构应用）"><a href="#19丨使用Next（使用它创建React同构应用）" class="headerlink" title="19丨使用Next（使用它创建React同构应用）"></a>19丨使用Next（使用它创建React同构应用）</h1><p><strong>19.1 什么是同构应用？</strong></p><ul><li><p>一个web应用分为浏览器端和服务器端，对于同构应用来说，它分为初次发送请求和后面的后续请求，对于第一次请求来说，会由服务器端完成页面的渲染（页面的内容是完全使用服务器端render出来的，包括所有的html和css），然后返回到浏览器端，浏览器就会直接显示页面的内容以及UI，浏览器不需要执行任何JavaScript操作就可以直接把UI渲染出来，所以第一次打开页面的速度非常快。后续浏览器端的表现就像个单页应用，不再需要浏览器的刷新，所有的UI操作都是由前端来完成，包括前端的路由等等。</p><img src="image-20210416155003476.png" alt="image-20210416155003476" style="zoom:50%"></li><li><p>因为React具有服务器端渲染能力，所以它实现同构应用是非常自然和简单的。</p></li></ul><p><strong>19.2 如何使用next.js开发服务器端渲染的React应用</strong></p><ul><li><p>nextjs的页面</p><img src="image-20210416155951844.png" alt="image-20210416155951844" style="zoom:80%"><p>nextjs在开发时是遵循一定的约定的：</p><ol><li>页面都必须放到pages目录下，这个目录下的所有js文件都是一个React组件，对应页面路由的导航。当访问这个页面下的路径时，就会把对应的组件渲染出来。</li><li>static目录下放所有的静态文件</li><li>page具有一个特殊的静态方法<code>getInitialProps()</code>，在这个方法中可以获取一些初始数据，比如从URL中拿参数，作为组件的属性去使用</li></ol></li><li><p>demo，<a target="_blank" rel="noopener" href="https://nextjs.org/docs">官方教程</a>：</p><ol><li><p>step1 安装：<code>$ npm install -S next react react-dom</code></p></li><li><p>step2 指定npm中的script：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;dev&quot;</span>: <span class="string">&quot;next dev&quot;</span>,</span><br><span class="line">  <span class="string">&quot;build&quot;</span>: <span class="string">&quot;next build&quot;</span>,</span><br><span class="line">  <span class="string">&quot;start&quot;</span>: <span class="string">&quot;next start&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行<code>$ npm run dev</code>就能启动开发环境，默认通过3000端口访问。</p></li></ol></li></ul><p><strong>19.3 在页面中使用其它React组件</strong></p><ol><li><p>在nextjs中页面也是标准的node模块，可使用其它React组件</p></li><li><p>页面会针对性打包，仅包含其引入的组件</p><p>这样每个页面不会加载额外的资源，性能会比较好。</p></li></ol><p><strong>19.4 使用Link实现同构路由</strong></p><ol><li><p>使用“next/link”定义链接</p></li><li><p>点击链接时页面不会刷新</p></li><li><p>使用prefetch预加载目标资源</p><p>一般只有点过去才会加载链接后面的组件内容，这个属性可以使nextjs在打包时就获取链接对应的组件并预加载所有的js内容，这样可以提高页面切换的速度，但是prefetch并不会加载服务器端api的数据，如果组件中要加载api数据，需要等待一段时间才显示。</p></li><li><p>使用replace属性替换URL</p><img src="image-20210416163902090.png" alt="image-20210416163902090" style="zoom:80%"></li></ol><p><strong>19.5 动态加载页面（即lazyLoad）</strong></p><p>​ dynamic这个函数告诉nextjs，这个import的组件hello2需要lazyLoad的，它会产生一个新的组件DynamicComponentWithCustomLoading，它是加载实际组件的容器，我们render的实际上是这个封装后的组件，这个组件一旦render就会动态加载其中包含的内容。</p><img src="image-20210416165445770.png" alt="image-20210416165445770" style="zoom:72%"><h1 id="20丨使用Jest，Enzyme等工具进行单元测试"><a href="#20丨使用Jest，Enzyme等工具进行单元测试" class="headerlink" title="20丨使用Jest，Enzyme等工具进行单元测试"></a>20丨使用Jest，Enzyme等工具进行单元测试</h1><p><strong>20.1 React让前端单元测试变得更加容易</strong></p><p>原因有三：</p><ol><li>React应用很少需要访问浏览器API</li><li>虚拟DOM可以在Nodejs环境运行和测试</li><li>Redux隔离了状态管理，纯数据层单元测试</li></ol><p><strong>20.2 单元测试涉及的工具</strong></p><ol><li><p>Jest: facebook开源的JS单元测试框架</p><p>它的特性是零配置，直接开始单元测试，而且对react做了很好的支持</p><img src="image-20210416174043961.png" alt="image-20210416174043961" style="zoom:80%"></li><li><p>JS DOM: 浏览器环境的NodeJs模拟</p></li><li><p>Enzyme: React组件渲染和测试</p></li><li><p>nock: 模拟HTTP请求</p></li><li><p>sinon: 函数模拟和调用跟踪</p></li><li><p>istanbul: 单元测试覆盖率</p></li></ol><h1 id="21丨常用开发调试工具：ESLint，Prettier，React-DevTool，Redux-DevTool"><a href="#21丨常用开发调试工具：ESLint，Prettier，React-DevTool，Redux-DevTool" class="headerlink" title="21丨常用开发调试工具：ESLint，Prettier，React DevTool，Redux DevTool"></a>21丨常用开发调试工具：ESLint，Prettier，React DevTool，Redux DevTool</h1><p><strong>21.1 Eslint</strong></p><ul><li>用于做语法风格的检查</li><li>使用.eslintrc进行规则的配置或放在package.json中，一般选择前者</li><li>使用airbnb的JavaScript代码风格，见github</li></ul><p><strong>21.2 Prettier - 强烈推荐</strong></p><ul><li>facebook出的用于格式化代码（会自动帮助修改）</li><li>保证更容易写出风格一致的代码</li><li>使用.prettierrc定义规则</li></ul><p><strong>21.3 React DevTool</strong></p><ul><li>用来调试React的chrome插件</li><li>可以以React组件树的形式观察页面结构</li><li>勾选Highlight Updates，操作时，页面中都会标识出哪些组件发生了渲染</li></ul><p><strong>21.4 Redux DevTool</strong></p><ul><li><p>用来调试Redux的chorme插件</p></li><li><p>可以观察到当前store的完整状态，操作时能看到这个action及其引起了什么变化(Diff)</p></li><li><p>有个非常牛的功能叫做time machine或time fly，时间线，点击action可以直接跳到(点击Jump)该action引起变化时的状态</p><img src="image-20210419161849967.png" alt="image-20210419161849967"></li><li><p>还可以自动生成测试的代码，比如想测试某个action是否正确，点击Test就可以看到它的代码逻辑，并把它直接cv到单元测试文件中稍作修改就能使用</p></li></ul><h1 id="22丨前端项目的理想架构：可维护，可扩展，可测试，易开发，易构建"><a href="#22丨前端项目的理想架构：可维护，可扩展，可测试，易开发，易构建" class="headerlink" title="22丨前端项目的理想架构：可维护，可扩展，可测试，易开发，易构建"></a>22丨前端项目的理想架构：可维护，可扩展，可测试，易开发，易构建</h1><p><strong>22.1 易于开发</strong></p><p>​ 判断一个技术栈是否易于开发，需要考虑以下几点：</p><ol><li>开发工具是否完善</li><li>生态圈是否繁荣</li><li>社区是否活跃</li></ol><p><strong>22.2 易于扩展</strong></p><ol><li>增加新功能是否容易</li><li>新功能是否会显著增加系统复杂度</li></ol><p><strong>22.3 易于维护</strong></p><ol><li>代码是否容易理解</li><li>文档是否健全</li></ol><p><strong>22.4 易于测试</strong></p><ol><li><p>功能的分层是否清晰</p></li><li><p>副作用少</p></li><li><p>尽量使用纯函数</p><p>React组件基本上可以理解为一个纯函数，它的输出完全取决于它的输入</p></li></ol><p><strong>22.5 易于构建</strong></p><ol><li>使用通用技术和架构</li><li>构建工具的选择</li></ol><h1 id="23丨拆分复杂度（1）：按领域模型（feature）组织代码，降低耦合度"><a href="#23丨拆分复杂度（1）：按领域模型（feature）组织代码，降低耦合度" class="headerlink" title="23丨拆分复杂度（1）：按领域模型（feature）组织代码，降低耦合度"></a>23丨拆分复杂度（1）：按领域模型（feature）组织代码，降低耦合度</h1><p><strong>23.1 将业务逻辑拆分成高内聚松耦合的模块</strong></p></div><div class="article-footer"><blockquote class="mt-2x"><ul class="post-copyright list-unstyled"><li class="post-copyright-link hidden-xs"><strong>本文链接：</strong> <a href="https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/" title="React实战进阶45讲" target="_blank" rel="external">https://scarlett9354.github.io/2021/04/28/React%E5%AE%9E%E6%88%98%E8%BF%9B%E9%98%B645%E8%AE%B2/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！</li></ul></blockquote><div class="panel panel-default panel-badger"><div class="panel-body"><figure class="media"><div class="media-left"><a href="https://github.com/scarlett9354" target="_blank" class="img-burn thumb-sm visible-lg"><img src="/images/avatar.jpg" class="img-rounded w-full" alt=""></a></div><div class="media-body"><h3 class="media-heading"><a href="https://github.com/scarlett9354" target="_blank"><span class="text-dark">桔&amp;桃</span><small class="ml-1x"></small></a></h3><div>个人简介。</div></div></figure></div></div></div></article><section id="comments"><div id="vcomments"></div></section></div><nav class="bar bar-footer clearfix" data-stick-bottom><div class="bar-inner"><ul class="pager pull-left"><li class="prev"><a href="/2021/04/28/%E9%80%8F%E8%A7%86HTTP%E5%8D%8F%E8%AE%AE/" title="透视HTTP协议"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a></li></ul><button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>赏</span></button><div class="bar-right"><div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div></div></div></nav><div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog"><div class="modal-dialog" role="document"><div class="modal-content donate"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><div class="modal-body"><div class="donate-box"><div class="donate-head"><p>感谢您的支持，我会继续努力的!</p></div><div class="tab-content"><div role="tabpanel" class="tab-pane fade active in" id="alipay"><div class="donate-payimg"><img src="/images/donate/alipayimg.jpg" alt="扫码支持" title="扫一扫"></div><p class="text-muted mv">扫码打赏，你说多少就多少</p><p class="text-grey">打开支付宝扫一扫，即可进行扫码打赏哦</p></div><div role="tabpanel" class="tab-pane fade" id="wechatpay"><div class="donate-payimg"><img src="/images/donate/wechatpayimg.jpg" alt="扫码支持" title="扫一扫"></div><p class="text-muted mv">扫码打赏，你说多少就多少</p><p class="text-grey">打开微信扫一扫，即可进行扫码打赏哦</p></div></div><div class="donate-footer"><ul class="nav nav-tabs nav-justified" role="tablist"><li role="presentation" class="active"><a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> 支付宝</a></li><li role="presentation"><a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> 微信支付</a></li></ul></div></div></div></div></div></div></main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter"><ul class="social-links"><li><a href="https://github.com/scarlett9354" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li></ul><div class="copyright"><div class="publishby">Theme by <a href="https://github.com/scarlett9354" target="_blank">cofess </a>base on <a href="https://github.com/scarlett9354" target="_blank">pure</a>.</div></div></footer><script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script><script>window.jQuery||document.write('<script src="js/jquery.min.js"><\/script>')</script><script src="/js/plugin.min.js"></script><script src="/js/application.js"></script><script>window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"文章",PAGES:"页面",CATEGORIES:"分类",TAGS:"标签",UNTITLED:"(未命名)"},ROOT_URL:"/",CONTENT_URL:"/content.json"}</script><script src="/js/insight.js"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/npm/valine"></script><script type="text/javascript">var GUEST=["nick","mail","link"],meta=(meta="nick,mail,link").split(",").filter(function(e){return-1<GUEST.indexOf(e)});new Valine({el:"#vcomments",verify:!1,notify:!1,appId:"",appKey:"",placeholder:"Just go go",avatar:"mm",meta:meta,pageSize:"10",visitor:!1})</script></body></html>