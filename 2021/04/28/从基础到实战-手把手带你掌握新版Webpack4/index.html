<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui"><meta name="renderer" content="webkit"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no,email=no,adress=no"><meta name="theme-color" content="#000000"><meta http-equiv="window-target" content="_top"><title>从基础到实战-手把手带你掌握新版Webpack4 | 月亮的部落格</title><meta name="description" content="第1章 前言 第2章 初识webpack 2-1 webpack究竟是什么 2-1-1 采用面对过程的方式写页面 2-1-2 采用面对对象的方式写页面 2-1-3 安装webpack 2-1-4 其他引入和导出方式 2-1-5 课后作业   2-2 webpack的正确安装方式 2-2-1 先安装node js 2-2-2 项目初始化 2-2-3 安装webpack   2-3 webpack的"><meta property="og:type" content="article"><meta property="og:title" content="从基础到实战-手把手带你掌握新版Webpack4"><meta property="og:url" content="https://scarlett9354.github.io/2021/04/28/%E4%BB%8E%E5%9F%BA%E7%A1%80%E5%88%B0%E5%AE%9E%E6%88%98-%E6%89%8B%E6%8A%8A%E6%89%8B%E5%B8%A6%E4%BD%A0%E6%8E%8C%E6%8F%A1%E6%96%B0%E7%89%88Webpack4/index.html"><meta property="og:site_name" content="Hexo"><meta property="og:description" content="第1章 前言 第2章 初识webpack 2-1 webpack究竟是什么 2-1-1 采用面对过程的方式写页面 2-1-2 采用面对对象的方式写页面 2-1-3 安装webpack 2-1-4 其他引入和导出方式 2-1-5 课后作业   2-2 webpack的正确安装方式 2-2-1 先安装node js 2-2-2 项目初始化 2-2-3 安装webpack   2-3 webpack的"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/%E4%BB%8E%E5%9F%BA%E7%A1%80%E5%88%B0%E5%AE%9E%E6%88%98-%E6%89%8B%E6%8A%8A%E6%89%8B%E5%B8%A6%E4%BD%A0%E6%8E%8C%E6%8F%A1%E6%96%B0%E7%89%88Webpack4/01.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/%E4%BB%8E%E5%9F%BA%E7%A1%80%E5%88%B0%E5%AE%9E%E6%88%98-%E6%89%8B%E6%8A%8A%E6%89%8B%E5%B8%A6%E4%BD%A0%E6%8E%8C%E6%8F%A1%E6%96%B0%E7%89%88Webpack4/02.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/%E4%BB%8E%E5%9F%BA%E7%A1%80%E5%88%B0%E5%AE%9E%E6%88%98-%E6%89%8B%E6%8A%8A%E6%89%8B%E5%B8%A6%E4%BD%A0%E6%8E%8C%E6%8F%A1%E6%96%B0%E7%89%88Webpack4/03.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/%E4%BB%8E%E5%9F%BA%E7%A1%80%E5%88%B0%E5%AE%9E%E6%88%98-%E6%89%8B%E6%8A%8A%E6%89%8B%E5%B8%A6%E4%BD%A0%E6%8E%8C%E6%8F%A1%E6%96%B0%E7%89%88Webpack4/04.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/%E4%BB%8E%E5%9F%BA%E7%A1%80%E5%88%B0%E5%AE%9E%E6%88%98-%E6%89%8B%E6%8A%8A%E6%89%8B%E5%B8%A6%E4%BD%A0%E6%8E%8C%E6%8F%A1%E6%96%B0%E7%89%88Webpack4/05.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/%E4%BB%8E%E5%9F%BA%E7%A1%80%E5%88%B0%E5%AE%9E%E6%88%98-%E6%89%8B%E6%8A%8A%E6%89%8B%E5%B8%A6%E4%BD%A0%E6%8E%8C%E6%8F%A1%E6%96%B0%E7%89%88Webpack4/06.png"><meta property="og:image" content="data:image/png;base64,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"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/%E4%BB%8E%E5%9F%BA%E7%A1%80%E5%88%B0%E5%AE%9E%E6%88%98-%E6%89%8B%E6%8A%8A%E6%89%8B%E5%B8%A6%E4%BD%A0%E6%8E%8C%E6%8F%A1%E6%96%B0%E7%89%88Webpack4/07.png"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/%E4%BB%8E%E5%9F%BA%E7%A1%80%E5%88%B0%E5%AE%9E%E6%88%98-%E6%89%8B%E6%8A%8A%E6%89%8B%E5%B8%A6%E4%BD%A0%E6%8E%8C%E6%8F%A1%E6%96%B0%E7%89%88Webpack4/08.jpg"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/%E4%BB%8E%E5%9F%BA%E7%A1%80%E5%88%B0%E5%AE%9E%E6%88%98-%E6%89%8B%E6%8A%8A%E6%89%8B%E5%B8%A6%E4%BD%A0%E6%8E%8C%E6%8F%A1%E6%96%B0%E7%89%88Webpack4/09.jpg"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/%E4%BB%8E%E5%9F%BA%E7%A1%80%E5%88%B0%E5%AE%9E%E6%88%98-%E6%89%8B%E6%8A%8A%E6%89%8B%E5%B8%A6%E4%BD%A0%E6%8E%8C%E6%8F%A1%E6%96%B0%E7%89%88Webpack4/10.jpg"><meta property="og:image" content="https://scarlett9354.github.io/2021/04/28/%E4%BB%8E%E5%9F%BA%E7%A1%80%E5%88%B0%E5%AE%9E%E6%88%98-%E6%89%8B%E6%8A%8A%E6%89%8B%E5%B8%A6%E4%BD%A0%E6%8E%8C%E6%8F%A1%E6%96%B0%E7%89%88Webpack4/11.jpg"><meta property="article:published_time" content="2021-04-28T09:39:13.000Z"><meta property="article:modified_time" content="2021-05-06T09:56:40.537Z"><meta property="article:author" content="John Doe"><meta property="article:tag" content="webpack"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://scarlett9354.github.io/2021/04/28/%E4%BB%8E%E5%9F%BA%E7%A1%80%E5%88%B0%E5%AE%9E%E6%88%98-%E6%89%8B%E6%8A%8A%E6%89%8B%E5%B8%A6%E4%BD%A0%E6%8E%8C%E6%8F%A1%E6%96%B0%E7%89%88Webpack4/01.png"><link rel="canonical" href="https://scarlett9354.github.io/2021/04/28/%E4%BB%8E%E5%9F%BA%E7%A1%80%E5%88%B0%E5%AE%9E%E6%88%98-%E6%89%8B%E6%8A%8A%E6%89%8B%E5%B8%A6%E4%BD%A0%E6%8E%8C%E6%8F%A1%E6%96%B0%E7%89%88Webpack4/index.html"><link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml"><link rel="icon" href="/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="Hexo 5.4.0"></head><body class="main-center" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="slimContent"><div class="navbar-header"><div class="profile-block text-center"><a id="avatar" href="https://github.com/scarlett9354" target="_blank"><img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200"></a><h2 id="name" class="hidden-xs hidden-sm">月亮和水蜜桃</h2><h3 id="title" class="hidden-xs hidden-sm hidden-md"></h3><small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> 北京</small></div><div class="search" id="search-form-wrap"><form class="search-form sidebar-form"><div class="input-group"><input type="text" class="search-form-input form-control" placeholder="搜索"> <span class="input-group-btn"><button type="submit" class="search-form-submit btn btn-flat" onclick="return!1"><i class="icon icon-search"></i></button></span></div></form><div class="ins-search"><div class="ins-search-mask"></div><div class="ins-search-container"><div class="ins-input-wrapper"><input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech> <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div><div class="ins-section-wrapper"><div class="ins-section-container"></div></div></div></div></div><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button></div><nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation"><ul class="nav navbar-nav main-nav menu-highlight"><li class="menu-item menu-item-home"><a href="/."><i class="icon icon-home-fill"></i> <span class="menu-title">首页</span></a></li><li class="menu-item menu-item-archives"><a href="/archives"><i class="icon icon-archives-fill"></i> <span class="menu-title">归档</span></a></li><li class="menu-item menu-item-categories"><a href="/categories"><i class="icon icon-folder"></i> <span class="menu-title">分类</span></a></li><li class="menu-item menu-item-tags"><a href="/tags"><i class="icon icon-tags"></i> <span class="menu-title">标签</span></a></li><li class="menu-item menu-item-repository"><a href="/repository"><i class="icon icon-project"></i> <span class="menu-title">项目</span></a></li><li class="menu-item menu-item-books"><a href="/books"><i class="icon icon-book-fill"></i> <span class="menu-title">书单</span></a></li><li class="menu-item menu-item-links"><a href="/links"><i class="icon icon-friendship"></i> <span class="menu-title">友链</span></a></li><li class="menu-item menu-item-about"><a href="/about"><i class="icon icon-cup-fill"></i> <span class="menu-title">关于</span></a></li></ul><ul class="social-links"><li><a href="https://github.com/scarlett9354" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li></ul></nav></div></header><aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar"><div class="slimContent"><div class="widget"><h3 class="widget-title">公告</h3><div class="widget-body"><div id="board"><div class="content"><p>欢迎交流与分享经验!</p></div></div></div></div><div class="widget"><h3 class="widget-title">分类</h3><div class="widget-body"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/ES6-7/">ES6-7</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/HTTP/">HTTP</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Node-js/">Node.js</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/React/">React</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/TypeScript/">TypeScript</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Vue/">Vue</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/webpack/">webpack</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E4%BD%9C%E7%9B%B8%E5%85%B3/">工作相关</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/">性能优化</a><span class="category-list-count">1</span></li></ul></div></div><div class="widget"><h3 class="widget-title">标签</h3><div class="widget-body"><ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ES6/" rel="tag">ES6</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ES7/" rel="tag">ES7</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Node-js/" rel="tag">Node.js</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/" rel="tag">React</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React16-4/" rel="tag">React16.4</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TypeScript/" rel="tag">TypeScript</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/" rel="tag">http</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/https/" rel="tag">https</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue-router/" rel="tag">vue-router</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vuex/" rel="tag">vuex</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack/" rel="tag">webpack</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" rel="tag">性能优化</a><span class="tag-list-count">1</span></li></ul></div></div><div class="widget"><h3 class="widget-title">标签云</h3><div class="widget-body tagcloud"><a href="/tags/ES6/" style="font-size:13px">ES6</a> <a href="/tags/ES7/" style="font-size:13px">ES7</a> <a href="/tags/Node-js/" style="font-size:13px">Node.js</a> <a href="/tags/React/" style="font-size:14px">React</a> <a href="/tags/React16-4/" style="font-size:13px">React16.4</a> <a href="/tags/TypeScript/" style="font-size:13px">TypeScript</a> <a href="/tags/http/" style="font-size:13px">http</a> <a href="/tags/https/" style="font-size:13px">https</a> <a href="/tags/vue/" style="font-size:14px">vue</a> <a href="/tags/vue-router/" style="font-size:13px">vue-router</a> <a href="/tags/vuex/" style="font-size:13px">vuex</a> <a href="/tags/webpack/" style="font-size:14px">webpack</a> <a href="/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" style="font-size:13px">性能优化</a></div></div><div class="widget"><h3 class="widget-title">归档</h3><div class="widget-body"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">六月 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">五月 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">四月 2021</a><span class="archive-list-count">7</span></li></ul></div></div><div class="widget"><h3 class="widget-title">最新文章</h3><div class="widget-body"><ul class="recent-post-list list-unstyled no-thumbnail"><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/%E5%B7%A5%E4%BD%9C%E7%9B%B8%E5%85%B3/">工作相关</a></p><p class="item-title"><a href="/2021/06/25/%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95/" class="title">工作记录</a></p><p class="item-date"><time datetime="2021-06-25T07:05:07.000Z" itemprop="datePublished">2021-06-25</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/ES6-7/">ES6-7</a></p><p class="item-title"><a href="/2021/06/25/ES6%E7%B2%BE%E8%AE%B2/" class="title">ES6精讲</a></p><p class="item-date"><time datetime="2021-06-25T07:00:00.000Z" itemprop="datePublished">2021-06-25</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/%E5%B7%A5%E4%BD%9C%E7%9B%B8%E5%85%B3/">工作相关</a></p><p class="item-title"><a href="/2021/06/18/async-await%E8%AF%A6%E8%A7%A3-%E5%BD%BB%E5%BA%95%E6%91%86%E8%84%B1%E5%9B%9E%E8%B0%83%E5%9C%B0%E7%8B%B1/" class="title">async_await详解-彻底摆脱回调地狱</a></p><p class="item-date"><time datetime="2021-06-18T07:58:40.000Z" itemprop="datePublished">2021-06-18</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/%E5%B7%A5%E4%BD%9C%E7%9B%B8%E5%85%B3/">工作相关</a></p><p class="item-title"><a href="/2021/05/14/Vue%E4%B8%AD%E9%A1%B5%E9%9D%A2%E5%89%8D%E8%BF%9B%E5%88%B7%E6%96%B0%E5%9B%9E%E9%80%80%E4%B8%8D%E5%88%B7%E6%96%B0%E7%9A%84%E5%AE%9E%E7%8E%B0/" class="title">Vue中页面前进刷新回退不刷新的实现</a></p><p class="item-date"><time datetime="2021-05-14T07:31:53.000Z" itemprop="datePublished">2021-05-14</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/React/">React</a></p><p class="item-title"><a href="/2021/05/11/React16.4%20%E5%BC%80%E5%8F%91%E7%AE%80%E4%B9%A6%E9%A1%B9%E7%9B%AE%20%E4%BB%8E%E9%9B%B6%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E6%88%98/" class="title">React16.4 开发简书项目 从零基础入门到实战</a></p><p class="item-date"><time datetime="2021-05-11T09:25:48.000Z" itemprop="datePublished">2021-05-11</time></p></div></li></ul></div></div></div></aside><main class="main" role="main"><div class="content"><article id="post-从基础到实战-手把手带你掌握新版Webpack4" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting"><div class="article-header"><h1 class="article-title" itemprop="name">从基础到实战-手把手带你掌握新版Webpack4</h1><div class="article-meta"><span class="article-date"><i class="icon icon-calendar-check"></i> <a href="/2021/04/28/%E4%BB%8E%E5%9F%BA%E7%A1%80%E5%88%B0%E5%AE%9E%E6%88%98-%E6%89%8B%E6%8A%8A%E6%89%8B%E5%B8%A6%E4%BD%A0%E6%8E%8C%E6%8F%A1%E6%96%B0%E7%89%88Webpack4/" class="article-date"><time datetime="2021-04-28T09:39:13.000Z" itemprop="datePublished">2021-04-28</time> </a></span><span class="article-category"><i class="icon icon-folder"></i> <a class="article-category-link" href="/categories/webpack/">webpack</a> </span><span class="article-tag"><i class="icon icon-tags"></i> <a class="article-tag-link-link" href="/tags/webpack/" rel="tag">webpack</a> </span><span class="post-comment"><i class="icon icon-comment"></i> <a href="/2021/04/28/%E4%BB%8E%E5%9F%BA%E7%A1%80%E5%88%B0%E5%AE%9E%E6%88%98-%E6%89%8B%E6%8A%8A%E6%89%8B%E5%B8%A6%E4%BD%A0%E6%8E%8C%E6%8F%A1%E6%96%B0%E7%89%88Webpack4/#comments" class="article-comment-link">评论</a></span></div></div><div class="article-entry marked-body" itemprop="articleBody"><ul><li><a href="#%E7%AC%AC1%E7%AB%A0-%E5%89%8D%E8%A8%80">第1章 前言</a></li><li><a href="#%E7%AC%AC2%E7%AB%A0-%E5%88%9D%E8%AF%86webpack">第2章 初识webpack</a><ul><li><a href="#2-1-webpack%E7%A9%B6%E7%AB%9F%E6%98%AF%E4%BB%80%E4%B9%88">2-1 webpack究竟是什么</a><ul><li><a href="#2-1-1-%E9%87%87%E7%94%A8%E9%9D%A2%E5%AF%B9%E8%BF%87%E7%A8%8B%E7%9A%84%E6%96%B9%E5%BC%8F%E5%86%99%E9%A1%B5%E9%9D%A2">2-1-1 采用面对过程的方式写页面</a></li><li><a href="#2-1-2-%E9%87%87%E7%94%A8%E9%9D%A2%E5%AF%B9%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%96%B9%E5%BC%8F%E5%86%99%E9%A1%B5%E9%9D%A2">2-1-2 采用面对对象的方式写页面</a></li><li><a href="#2-1-3-%E5%AE%89%E8%A3%85webpack">2-1-3 安装webpack</a></li><li><a href="#2-1-4-%E5%85%B6%E4%BB%96%E5%BC%95%E5%85%A5%E5%92%8C%E5%AF%BC%E5%87%BA%E6%96%B9%E5%BC%8F">2-1-4 其他引入和导出方式</a></li><li><a href="#2-1-5-%E8%AF%BE%E5%90%8E%E4%BD%9C%E4%B8%9A">2-1-5 课后作业</a></li></ul></li><li><a href="#2-2-webpack%E7%9A%84%E6%AD%A3%E7%A1%AE%E5%AE%89%E8%A3%85%E6%96%B9%E5%BC%8F">2-2 webpack的正确安装方式</a><ul><li><a href="#2-2-1-%E5%85%88%E5%AE%89%E8%A3%85node-js">2-2-1 先安装node js</a></li><li><a href="#2-2-2-%E9%A1%B9%E7%9B%AE%E5%88%9D%E5%A7%8B%E5%8C%96">2-2-2 项目初始化</a></li><li><a href="#2-2-3-%E5%AE%89%E8%A3%85webpack">2-2-3 安装webpack</a></li></ul></li><li><a href="#2-3-webpack%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">2-3 webpack的配置文件</a><ul><li><a href="#2-3-1-%E9%85%8D%E7%BD%AE">2-3-1 配置</a></li><li><a href="#2-3-2-%E6%95%B4%E7%90%86%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84">2-3-2 整理项目结构</a></li><li><a href="#2-3-3-%E5%A6%82%E4%BD%95%E7%94%A8npm-scripts%E7%AE%80%E5%8C%96%E6%89%93%E5%8C%85%E4%BB%A3%E7%A0%81">2-3-3 如何用npm scripts简化打包代码</a></li><li><a href="#2-3-4-%E8%AF%BE%E5%90%8E%E4%BD%9C%E4%B8%9A">2-3-4 课后作业</a></li></ul></li><li><a href="#2-4-%E6%B5%85%E6%9E%90webpack%E6%89%93%E5%8C%85%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9">2-4 浅析webpack打包的知识点</a><ul><li><a href="#2-4-1-%E8%A7%A3%E8%AF%BB%E6%89%93%E5%8C%85%E8%BE%93%E5%87%BA%E4%BF%A1%E6%81%AF">2-4-1 解读打包输出信息</a></li></ul></li></ul></li><li><a href="#%E7%AC%AC3%E7%AB%A0-webpack%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5">第3章 webpack核心概念</a><ul><li><a href="#3-1-loader%E6%98%AF%E4%BB%80%E4%B9%88">3-1 loader是什么</a><ul><li><a href="#3-1-1-%E6%89%93%E5%8C%85%E5%9B%BE%E7%89%87%E7%AD%89%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90">3-1-1 打包图片等静态资源</a></li><li><a href="#3-1-2-loader%E6%98%AF%E4%BB%80%E4%B9%88">3-1-2 loader是什么</a></li></ul></li><li><a href="#3-2-%E4%BD%BF%E7%94%A8loader%E6%89%93%E5%8C%85%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90-%E5%9B%BE%E7%89%87%E7%AF%87">3-2 使用loader打包静态资源 (图片篇)</a><ul><li><a href="#3-2-1-%E5%85%B3%E4%BA%8E%E6%89%93%E5%8C%85%E5%90%8E%E7%9A%84%E5%9B%BE%E7%89%87%E5%90%8D%E7%A7%B0">3-2-1 关于打包后的图片名称</a></li><li><a href="#3-2-2-%E6%89%93%E5%8C%85%E5%A4%9A%E7%A7%8D%E6%A0%BC%E5%BC%8F%E7%9A%84%E5%9B%BE%E7%89%87">3-2-2 打包多种格式的图片</a></li><li><a href="#3-2-3-%E6%89%93%E5%8C%85%E5%88%B0%E5%93%AA%E4%B8%AA%E6%96%87%E4%BB%B6%E5%A4%B9">3-2-3 打包到哪个文件夹</a></li><li><a href="#3-2-4-url-loader">3-2-4 url-loader</a></li><li><a href="#3-2-5-%E8%AF%BE%E5%90%8E%E4%BD%9C%E4%B8%9A">3-2-5 课后作业</a></li></ul></li><li><a href="#3-3-%E4%BD%BF%E7%94%A8loader%E6%89%93%E5%8C%85%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90-%E6%A0%B7%E5%BC%8F%E7%AF%87-%E4%B8%8A">3-3 使用loader打包静态资源 (样式篇-上)</a><ul><li><a href="#3-3-1-%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C">3-3-1 准备工作</a></li><li><a href="#3-3-2-%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%AE%89%E8%A3%85">3-3-2 配置与安装</a></li><li><a href="#3-3-3-%E4%B8%A4%E4%B8%AAloader%E7%9A%84%E4%BD%9C%E7%94%A8">3-3-3 两个loader的作用</a></li><li><a href="#3-3-4-scss%E7%9A%84%E6%89%93%E5%8C%85%E5%92%8C%E4%BD%BF%E7%94%A8">3-3-4 scss的打包和使用</a></li><li><a href="#3-3-5-%E8%87%AA%E5%8A%A8%E6%B7%BB%E5%8A%A0css3%E5%8E%82%E5%95%86%E5%89%8D%E7%BC%80-%E8%87%AA%E5%B7%B1%E7%9A%84demo%E4%B8%AD%E6%B2%A1%E6%88%90%E5%8A%9F">3-3-5 自动添加css3厂商前缀 (自己的demo中没成功)</a></li></ul></li><li><a href="#3-4-%E4%BD%BF%E7%94%A8loader%E6%89%93%E5%8C%85%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90-%E6%A0%B7%E5%BC%8F%E7%AF%87-%E4%B8%8B">3-4 使用loader打包静态资源 (样式篇-下)</a><ul><li><a href="#3-4-1-css-loader%E7%9A%84%E9%85%8D%E7%BD%AE%E9%A1%B9">3-4-1 css-loader的配置项</a></li><li><a href="#3-4-2-css%E6%89%93%E5%8C%85%E7%9A%84%E6%A8%A1%E5%9D%97%E5%8C%96">3-4-2 css打包的模块化</a></li><li><a href="#3-4-3-%E4%BD%BF%E7%94%A8webpack%E6%89%93%E5%8C%85%E7%AC%AC%E4%B8%89%E6%96%B9%E5%AD%97%E4%BD%93%E6%96%87%E4%BB%B6">3-4-3 使用webpack打包第三方字体文件</a></li><li><a href="#3-4-4-%E8%AF%BE%E5%90%8E%E4%BD%9C%E4%B8%9A">3-4-4 课后作业</a></li></ul></li><li><a href="#3-5-%E4%BD%BF%E7%94%A8plugins%E8%AE%A9%E6%89%93%E5%8C%85%E6%9B%B4%E4%BE%BF%E6%8D%B7">3-5 使用plugins让打包更便捷</a><ul><li><a href="#3-5-1-html-webpack-plugin">3-5-1 html-webpack-plugin</a></li><li><a href="#3-5-2-clean-webpack-plugin">3-5-2 clean-webpack-plugin</a></li><li><a href="#3-5-3-%E6%80%BB%E7%BB%93plugin%E7%9A%84%E4%BD%9C%E7%94%A8">3-5-3 总结plugin的作用</a></li></ul></li><li><a href="#3-6-entry%E4%B8%8Eoutput%E7%9A%84%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE">3-6 entry与output的基础配置</a><ul><li><a href="#3-6-1-%E5%AE%9E%E7%8E%B0%E6%96%B0%E9%9C%80%E6%B1%82-%E6%8A%8Asrc%E4%B8%8B%E7%9A%84index-js%E6%89%93%E5%8C%85%E4%B8%A4%E6%AC%A1%E7%94%9F%E6%88%90%E4%B8%8D%E5%90%8C%E7%9A%84js">3-6-1 实现新需求-把src下的index js打包两次生成不同的js</a></li><li><a href="#3-6-2-%E5%AE%9E%E7%8E%B0%E6%96%B0%E9%9C%80%E6%B1%82-%E5%90%8E%E5%8F%B0%E7%94%A8index-html%E4%BD%9C%E4%B8%BA%E5%85%A5%E5%8F%A3-%E5%85%B6%E4%BB%96%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%A6%82js%E6%94%BE%E5%88%B0cdn%E4%B8%8A">3-6-2 实现新需求-后台用index html作为入口 其他静态资源如js放到cdn上</a></li><li><a href="#3-6-3-%E8%AF%BE%E5%90%8E%E4%BD%9C%E4%B8%9A">3-6-3 课后作业</a></li></ul></li><li><a href="#3-7-sourcemap%E7%9A%84%E9%85%8D%E7%BD%AE">3-7 sourcemap的配置</a><ul><li><a href="#3-7-1-%E5%85%B3%E9%97%ADsourcemap">3-7-1 关闭sourcemap</a></li><li><a href="#3-7-2-sourcemap%E7%9A%84%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF">3-7-2 sourcemap的适用场景</a></li></ul></li><li><a href="#3-8-%E4%BD%BF%E7%94%A8webpack-dev-server%E6%8F%90%E5%8D%87%E5%BC%80%E5%8F%91%E6%95%88%E7%8E%87">3-8 使用webpack-dev-server提升开发效率</a><ul><li><a href="#3-8-1-%E5%AE%9E%E7%8E%B0%E5%BC%80%E5%8F%91%E9%9C%80%E6%B1%82-%E8%BE%B9%E6%94%B9%E4%B8%9C%E8%A5%BF%E8%BE%B9%E8%87%AA%E5%8A%A8%E6%89%93%E5%8C%85-%E4%B8%8D%E5%86%8D%E6%89%8B%E5%8A%A8%E6%89%93%E5%8C%85%E4%BA%86">3-8-1 实现开发需求-边改东西边自动打包 不再手动打包了</a></li><li><a href="#3-8-2-%E5%8F%82%E8%80%83%E4%BB%A5%E4%B8%8B%E6%96%87%E6%A1%A3">3-8-2 参考以下文档</a></li><li><a href="#3-8-3-%E8%AF%BE%E5%90%8E%E4%BD%9C%E4%B8%9A">3-8-3 课后作业</a></li></ul></li><li><a href="#3-9-hot-module-replacement-hmr-%E7%83%AD%E6%A8%A1%E5%9D%97%E6%9B%B4%E6%96%B0-1">3-9 hot module replacement (hmr) 热模块更新 (1)</a><ul><li><a href="#3-9-1-%E9%92%88%E5%AF%B9css%E6%96%87%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8">3-9-1 针对css文件的使用</a></li><li><a href="#3-9-2-%E9%92%88%E5%AF%B9js%E6%96%87%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8">3-9-2 针对js文件的使用</a></li></ul></li><li><a href="#3-10-hot-module-replacement-hmr-%E7%83%AD%E6%A8%A1%E5%9D%97%E6%9B%B4%E6%96%B0-2">3-10 hot module replacement (hmr) 热模块更新 (2)</a><ul><li><a href="#3-10-1-%E9%92%88%E5%AF%B9js%E6%96%87%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8">3-10-1 针对js文件的使用</a></li><li><a href="#3-10-2-%E8%AF%BE%E5%90%8E%E4%BD%9C%E4%B8%9A">3-10-2 课后作业</a></li></ul></li><li><a href="#3-11-%E4%BD%BF%E7%94%A8babel%E5%A4%84%E7%90%86es6%E8%AF%AD%E6%B3%95-1">3-11 使用babel处理es6语法 (1)</a><ul><li><a href="#3-11-1-%E5%9C%A8webpack%E4%B8%AD%E4%BD%BF%E7%94%A8babel">3-11-1 在webpack中使用babel</a></li></ul></li><li><a href="#3-12-%E4%BD%BF%E7%94%A8babel%E5%A4%84%E7%90%86es6%E8%AF%AD%E6%B3%95-2">3-12 使用babel处理es6语法 (2)</a><ul><li><a href="#3-12-1-%E9%85%8D%E7%BD%AE%E9%A1%B9targets">3-12-1 配置项targets</a></li><li><a href="#3-12-2-babel-plugin-transform-runtime">3-12-2 babel plugin-transform-runtime</a></li></ul></li><li><a href="#3-13-webpack%E5%AE%9E%E7%8E%B0%E5%AF%B9react%E6%A1%86%E6%9E%B6%E4%BB%A3%E7%A0%81%E7%9A%84%E6%89%93%E5%8C%85">3-13 webpack实现对react框架代码的打包</a><ul><li><a href="#3-13-1-%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C">3-13-1 准备工作</a></li><li><a href="#3-13-2-%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8">3-13-2 安装与使用</a></li></ul></li></ul></li><li><a href="#%E7%AC%AC4%E7%AB%A0-webpack%E8%BF%9B%E9%98%B6-%E9%AB%98%E7%BA%A7%E6%A6%82%E5%BF%B5">第4章 webpack进阶 (高级概念)</a><ul><li><a href="#4-1-tree-shaking%E6%A6%82%E5%BF%B5%E8%AF%A6%E8%A7%A3">4-1 tree shaking概念详解</a><ul><li><a href="#4-1-1-tree-shaking%E6%98%AF%E4%BB%80%E4%B9%88">4-1-1 tree shaking是什么</a></li><li><a href="#4-1-2-%E4%BD%BF%E7%94%A8tree-shaking">4-1-2 使用tree shaking</a></li></ul></li><li><a href="#4-2-development%E5%92%8Cproduction%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%8C%BA%E5%88%86%E6%89%93%E5%8C%85">4-2 development和production模式的区分打包</a><ul><li><a href="#4-2-1-development%E6%A8%A1%E5%BC%8F">4-2-1 development模式</a></li><li><a href="#4-2-2-production%E6%A8%A1%E5%BC%8F">4-2-2 production模式</a></li><li><a href="#4-2-3-%E4%B8%A4%E7%A7%8D%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%B7%AE%E5%BC%82">4-2-3 两种模式的差异</a></li><li><a href="#4-2-4-%E4%B8%A4%E7%A7%8D%E6%A8%A1%E5%BC%8F%E4%B8%8B%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">4-2-4 两种模式下的配置文件</a></li><li><a href="#4-2-5-%E8%A7%A3%E5%86%B3%E5%A4%9A%E4%B8%AA%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E9%87%8D%E5%A4%8D%E9%97%AE%E9%A2%98">4-2-5 解决多个配置文件的重复问题</a></li><li><a href="#4-2-6-%E6%95%B4%E7%90%86%E4%BB%A5%E4%B8%8A%E5%87%A0%E4%B8%AA%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">4-2-6 整理以上几个配置文件</a></li></ul></li><li><a href="#4-3-webpack%E5%92%8Ccode-splitting">4-3 webpack和code splitting</a><ul><li><a href="#4-3-1-%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C">4-3-1 准备工作</a></li><li><a href="#4-3-2-code-splitting%E4%BB%A3%E7%A0%81%E5%88%86%E5%89%B2">4-3-2 code splitting代码分割</a></li><li><a href="#4-3-3-%E6%80%BB%E7%BB%93">4-3-3 总结</a></li></ul></li><li><a href="#4-5-split-chunks-plugin%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3-1">4-5 split-chunks-plugin配置参数详解 (1)</a><ul><li><a href="#4-5-1-magic-comment%E9%AD%94%E6%B3%95%E6%B3%A8%E9%87%8A">4-5-1 magic-comment魔法注释</a></li><li><a href="#4-5-2-%E8%AF%A6%E8%A7%A3split-chunks-plugin%E7%9A%84%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0">4-5-2 详解split-chunks-plugin的配置参数</a></li></ul></li><li><a href="#4-7-lazy-loading%E6%87%92%E5%8A%A0%E8%BD%BD%E5%92%8Cchunk%E6%98%AF%E4%BB%80%E4%B9%88">4-7 lazy loading懒加载和chunk是什么</a><ul><li><a href="#4-7-1-%E6%87%92%E5%8A%A0%E8%BD%BD">4-7-1 懒加载</a></li><li><a href="#4-7-2-chunk%E7%9A%84%E6%A6%82%E5%BF%B5">4-7-2 chunk的概念</a></li></ul></li><li><a href="#4-8-%E6%89%93%E5%8C%85%E5%88%86%E6%9E%90-preloading%E5%92%8Cprefetching">4-8 打包分析-preloading和prefetching</a><ul><li><a href="#4-8-1-%E6%89%93%E5%8C%85%E5%88%86%E6%9E%90">4-8-1 打包分析</a></li><li><a href="#4-8-2-prefetching%E5%92%8Cpreloading">4-8-2 prefetching和preloading</a></li></ul></li><li><a href="#4-9-css%E6%96%87%E4%BB%B6%E7%9A%84%E4%BB%A3%E7%A0%81%E5%88%86%E5%89%B2">4-9 css文件的代码分割</a><ul><li><a href="#4-9-1-css-in-js">4-9-1 css in js</a></li><li><a href="#4-9-2-%E5%80%9F%E5%8A%A9mini-css-extract-plugin%E5%B0%86css%E6%89%93%E5%8C%85%E5%88%B0dist%E4%B8%8B-%E8%80%8C%E4%B8%8D%E6%98%AF%E6%94%BE%E5%88%B0js%E4%B8%AD">4-9-2 借助mini-css-extract-plugin将css打包到dist下 而不是放到js中</a></li><li><a href="#4-9-3-%E5%8E%8B%E7%BC%A9css%E4%BB%A3%E7%A0%81">4-9-3 压缩css代码</a></li><li><a href="#4-9-4-%E5%B0%86%E6%89%80%E6%9C%89%E5%85%A5%E5%8F%A3%E7%9A%84css%E6%96%87%E4%BB%B6%E6%89%93%E5%8C%85%E5%88%86%E5%89%B2%E6%88%90%E4%B8%80%E4%B8%AAcss%E6%96%87%E4%BB%B6">4-9-4 将所有入口的css文件打包分割成一个css文件</a></li><li><a href="#4-9-5-%E6%A0%B9%E6%8D%AE%E5%85%A5%E5%8F%A3%E4%B8%8D%E5%90%8C%E5%B0%86css%E6%96%87%E4%BB%B6%E6%89%93%E5%8C%85%E5%88%B0%E4%B8%8D%E5%90%8C%E7%9A%84css%E6%96%87%E4%BB%B6%E4%B8%AD">4-9-5 根据入口不同将css文件打包到不同的css文件中</a></li></ul></li><li><a href="#4-10-webpack%E4%B8%8E%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98-caching">4-10 webpack与浏览器缓存 (caching)</a><ul><li><a href="#4-10-1-%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98">4-10-1 浏览器缓存</a></li><li><a href="#4-10-2-contenthash">4-10-2 contentHash</a></li></ul></li><li><a href="#4-11-shimming-%E5%9E%AB%E7%89%87-%E7%9A%84%E4%BD%9C%E7%94%A8">4-11 shimming (垫片) 的作用</a><ul><li><a href="#4-11-1-%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AEjquery">4-11-1 全局配置jquery</a></li><li><a href="#4-11-2-imports-loader">4-11-2 imports-loader</a></li><li><a href="#4-11-3-%E8%AF%BE%E5%90%8E%E9%98%85%E8%AF%BB">4-11-3 课后阅读</a></li></ul></li><li><a href="#4-12-%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95">4-12 环境变量的使用方法</a><ul><li><a href="#4-12-1-%E8%B0%83%E6%95%B4%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">4-12-1 调整配置文件</a></li></ul></li></ul></li><li><a href="#%E7%AC%AC5%E7%AB%A0-webpack%E5%AE%9E%E6%88%98%E9%85%8D%E7%BD%AE%E6%A1%88%E4%BE%8B">第5章 webpack实战配置案例</a><ul><li><a href="#5-1-library%E7%9A%84%E6%89%93%E5%8C%85">5-1 library的打包</a><ul><li><a href="#5-1-1-%E5%AE%9E%E7%8E%B0%E6%89%93%E5%8C%85%E4%B8%80%E4%B8%AA%E5%87%BD%E6%95%B0%E5%BA%93%E7%9A%84%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C">5-1-1 实现打包一个函数库的准备工作</a></li><li><a href="#5-1-2-%E7%9C%9F%E6%AD%A3%E5%AE%9E%E7%8E%B0%E6%89%93%E5%8C%85%E4%B8%80%E4%B8%AA%E5%87%BD%E6%95%B0%E5%BA%93">5-1-2 真正实现打包一个函数库</a></li><li><a href="#5-1-3-%E6%89%93%E5%8C%85%E5%BA%93%E6%97%B6%E5%BC%95%E5%85%A5%E5%85%B6%E4%BB%96%E5%BA%93">5-1-3 打包库时引入其他库</a></li></ul></li></ul></li><li><a href="#%E7%AC%AC6%E7%AB%A0-webpack%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E5%8F%8A%E8%84%9A%E6%89%8B%E6%9E%B6%E5%B7%A5%E5%85%B7%E5%88%86%E6%9E%90">第6章 webpack底层原理及脚手架工具分析</a></li></ul><h1 id="第1章-前言"><a href="#第1章-前言" class="headerlink" title="第1章 前言"></a>第1章 前言</h1><ul><li>webpack4与之前版本比较的优势：<ol><li>速度更快，大型项目节约90%的构建时间</li><li>内置了更多默认配置，变更了许多API</li></ol></li><li>主要涵盖以下内容：<br>Loader、HMR、Create React App、Caching、Plugin、SourceMap、Vue Cli 3.0、Shimming、WebpackDevServer、TreeShaking、CodeSplitting、Babel、React、Library、Eslint、PWA、Vue、Mode、性能优化、多页应用、原理、PreLoading、PreFetching、环境变量、TypeScript</li></ul><h1 id="第2章-初识webpack"><a href="#第2章-初识webpack" class="headerlink" title="第2章 初识webpack"></a>第2章 初识webpack</h1><h2 id="2-1-webpack究竟是什么"><a href="#2-1-webpack究竟是什么" class="headerlink" title="2-1 webpack究竟是什么"></a>2-1 webpack究竟是什么</h2><h3 id="2-1-1-采用面对过程的方式写页面"><a href="#2-1-1-采用面对过程的方式写页面" class="headerlink" title="2-1-1 采用面对过程的方式写页面"></a>2-1-1 采用面对过程的方式写页面</h3><ul><li><p>index.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>这是一个原始页面<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./index.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>index.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> dom = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> header = <span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">header.innerText = <span class="string">&#x27;header&#x27;</span></span><br><span class="line">dom.append(header)</span><br><span class="line"><span class="keyword">var</span> sidebar = <span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">sidebar.innerText = <span class="string">&#x27;sidebar&#x27;</span></span><br><span class="line">dom.append(sidebar)</span><br><span class="line"><span class="keyword">var</span> content = <span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">content.innerText = <span class="string">&#x27;content&#x27;</span></span><br><span class="line">dom.append(content)</span><br></pre></td></tr></table></figure><blockquote><p>所有的代码都堆在index.js文件中，代码长而冗余</p></blockquote></li></ul><h3 id="2-1-2-采用面对对象的方式写页面"><a href="#2-1-2-采用面对对象的方式写页面" class="headerlink" title="2-1-2 采用面对对象的方式写页面"></a>2-1-2 采用面对对象的方式写页面</h3><ul><li><p>index.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>这是一个原始页面<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./header.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./content.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./sidebar.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./index.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>header.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Header</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> header = <span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">    header.innerText = <span class="string">&#x27;header&#x27;</span></span><br><span class="line">    dom.append(header)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>sidebar.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Sidebar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> sidebar = <span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">    sidebar.innerText = <span class="string">&#x27;sidebar&#x27;</span></span><br><span class="line">    dom.append(sidebar)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>content.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Content</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> content = <span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">    content.innerText = <span class="string">&#x27;content&#x27;</span></span><br><span class="line">    dom.append(content)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>index.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> dom = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>)</span><br><span class="line"><span class="keyword">new</span> Header()</span><br><span class="line"><span class="keyword">new</span> Sidebar()</span><br><span class="line"><span class="keyword">new</span> Content()</span><br></pre></td></tr></table></figure><blockquote><p>这样在一个页面引入多个js，就会带来新的问题：<br>（1）多出三个http请求，页面加载速度会变慢<br>（2）在index.js中只能看出创建header、sidebar和content，无法看出这三个对象的位置<br>（3）很难查错，比如其中的sidebar.js在index.js后引入，就会出现报错，但是很难排查出报错原因<br>针对以上三个问题，采用import…from…方法</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Header <span class="keyword">from</span> <span class="string">&#x27;./header&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Sidebar <span class="keyword">from</span> <span class="string">&#x27;./sidebar&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Content <span class="keyword">from</span> <span class="string">&#x27;./content&#x27;</span></span><br><span class="line"><span class="keyword">new</span> Header()</span><br><span class="line"><span class="keyword">new</span> Sidebar()</span><br><span class="line"><span class="keyword">new</span> Content()</span><br></pre></td></tr></table></figure></li></ul><h3 id="2-1-3-安装webpack"><a href="#2-1-3-安装webpack" class="headerlink" title="2-1-3 安装webpack"></a>2-1-3 安装webpack</h3><ul><li><p>在项目目录下运行<code>$ npm init</code> 命令，一路回车</p></li><li><p>运行<code>$ npm install webpack-cli --save-dev</code>，通常情况下，这个命令会将webpack一起安装了，如果不放心，重新安装下webpack也行<code>$ npm install webpack --save</code></p></li><li><p>用webpack来翻译index.js<code>$ npx webpack index.js</code>，这时候会生成一个dist目录，下面有个main.js便是翻译好的js文件，因此在index.html中修改引入：<code>&lt;script src=&quot;./dist/main.js&quot;&gt;&lt;/script&gt;</code></p></li><li><p>此时运行页面会报一个错：<u>Uncaught TypeError: o.a is not a constructor</u>，这是因为要import的模块未export导出，修正后的header.js如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Header</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> dom = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>)</span><br><span class="line">    <span class="keyword">var</span> header = <span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">    header.innerText = <span class="string">&#x27;header&#x27;</span></span><br><span class="line">    dom.append(header)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Header</span><br></pre></td></tr></table></figure></li></ul><h3 id="2-1-4-其他引入和导出方式"><a href="#2-1-4-其他引入和导出方式" class="headerlink" title="2-1-4 其他引入和导出方式"></a>2-1-4 其他引入和导出方式</h3><ul><li><p>CommonJs - Node里最常用的模块引入规范</p><p><strong>header.js：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = Header</span><br></pre></td></tr></table></figure><p><strong>index.js：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Header = <span class="built_in">require</span>(<span class="string">&#x27;./header.js&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> Sidebar = <span class="built_in">require</span>(<span class="string">&#x27;./sidebar.js&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> Content = <span class="built_in">require</span>(<span class="string">&#x27;./content.js&#x27;</span>)</span><br><span class="line"><span class="keyword">new</span> Header()</span><br><span class="line"><span class="keyword">new</span> Sidebar()</span><br><span class="line"><span class="keyword">new</span> Content()</span><br></pre></td></tr></table></figure></li><li><p>CMD</p></li><li><p>AMD</p><blockquote><p>综上，Webpack是个模块打包工具！</p></blockquote></li></ul><h3 id="2-1-5-课后作业"><a href="#2-1-5-课后作业" class="headerlink" title="2-1-5 课后作业"></a>2-1-5 课后作业</h3><ul><li>阅读<a target="_blank" rel="noopener" href="https://webpack.js.org/concepts/modules/">webpack模块化</a>，<a target="_blank" rel="noopener" href="https://www.webpackjs.com/concepts/modules/">中文文档</a></li><li>阅读<a target="_blank" rel="noopener" href="https://webpack.js.org/api/">api中MODULES</a>，<a target="_blank" rel="noopener" href="https://www.webpackjs.com/api/">中文文档</a></li></ul><h2 id="2-2-webpack的正确安装方式"><a href="#2-2-webpack的正确安装方式" class="headerlink" title="2-2 webpack的正确安装方式"></a>2-2 webpack的正确安装方式</h2><h3 id="2-2-1-先安装node-js"><a href="#2-2-1-先安装node-js" class="headerlink" title="2-2-1 先安装node js"></a>2-2-1 先安装node js</h3><ul><li>尽量安装新版本的稳定版，因为能很大程度上提高webpack的打包速度，此外也要保持webpack版本尽量新，高版本webpack会利用node新版本中一些特性提高打包速度</li><li>去<a target="_blank" rel="noopener" href="https://nodejs.org/en">NodeJs官网</a>直接下载安装</li><li>在控制台运行<code>$ node -v</code>查看版本号，再运行<code>$ npm -v</code>，能输出对应的版本号，说明node安装的没有任何问题</li></ul><h3 id="2-2-2-项目初始化"><a href="#2-2-2-项目初始化" class="headerlink" title="2-2-2 项目初始化"></a>2-2-2 项目初始化</h3><ul><li>创建项目文件夹<code>$ mkdir webpack-demo</code></li><li>进入项目文件夹 <code>$ cd webpack-demo</code></li><li>以node规范的形式创建一个项目或node的包文件 <code>$ npm init</code>，然后一路回车，或者直接运行<code>$ npm init -y</code> 就会直接自动生成一个默认的配置项</li><li>以上操作最终生成package.json文件，它描述了项目的一些信息：<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;webpack-demo&quot;</span>,</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;main&quot;</span>: <span class="string">&quot;index.js&quot;</span>,</span><br><span class="line">    <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;test&quot;</span>: <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;author&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;license&quot;</span>: <span class="string">&quot;ISC&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>对其做如下调整：<br>（1）添加<code>&quot;private&quot;: true</code> 是指这个项目是个私有项目，不会被发布到npm仓库中去<br>（2）去掉<code>&quot;main&quot;: &quot;index.js&quot;</code>，因为项目不会被外部引用，就没有必要向外暴露一个js文件<br>（3）<code>script</code> 标签中的东西也可以先去掉<br>（4）<code>author</code> 写上自己的名字<br>（5）如果想开源，就把<code>license</code> 改为MIT</p></blockquote></li></ul><h3 id="2-2-3-安装webpack"><a href="#2-2-3-安装webpack" class="headerlink" title="2-2-3 安装webpack"></a>2-2-3 安装webpack</h3><ul><li>（不推荐）<del>全局安装 <code>$ npm install webpack webpack-cli -g</code>，安装完成后运行<code>$ webpack -v</code> 和<code>webpack-cli -v</code> 查看版本</del></li><li><del>卸载全局安装的webpack<code>npm uninstall webpack webpack-cli -g</code></del></li><li>直接在项目webpack-demo里安装<code>npm install webpack webpack-cli -D</code> 等同于<code>npm install webpack webpack-cli --save-dev</code>，目录下多了node_modules包。<br>此时运行<code>$ webpack -v</code> 不成功，因为node会尝试去全局找，所以找不到，但是我们能用node提供的npx运行webpack <code>npx webpack -v</code>，因为npx会在当前目录的node_modules寻找。</li><li>对比以上两种方式，后者的优点在于：<br>比如此时又创建了一个项目叫做webpack-demo2，运行<code>$ npm info webpack</code> 先查看它所有的版本号，假如选个老版本安装<code>$ npm install webpack@4.16.5 webpack-cli -D</code>，这样就实现了在不同项目中安装不同版本的webpack。</li><li>webpack-cli的作用是使我们可以在命令行里正确运行webpack命令。</li><li>如果想把项目上传到git仓库，可以删掉node_modules，别人down下来代码后直接运行<code>$ npm install</code> 即可。</li></ul><h2 id="2-3-webpack的配置文件"><a href="#2-3-webpack的配置文件" class="headerlink" title="2-3 webpack的配置文件"></a>2-3 webpack的配置文件</h2><h3 id="2-3-1-配置"><a href="#2-3-1-配置" class="headerlink" title="2-3-1 配置"></a>2-3-1 配置</h3><ul><li><p>新建文件webpack.config.js：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123; &#125;</span><br></pre></td></tr></table></figure></li><li><p>配置入口entry，它的意思是从哪个文件开始打包</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">&#x27;./index.js&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>配置output，意思是放到哪里：<br>（1）里面的filename是指给打包好的文件取的名字<br>（2）里面的path是指打包好的文件放到哪个文件夹下，具体使用时要先引入node的核心模块path，然后调用模块的resolve方法，把__dirname这个变量（指当前的配置文件所在的当前目录路径）和bundle做个结合，这样生成的路径就是bundle这个文件夹的绝对路径了。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">&#x27;./index.js&#x27;</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: <span class="string">&#x27;bundle.js&#x27;</span>,</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">&#x27;bundle&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>（3）其实它还有个配置项叫chunkFilename，是打包并进行代码分割后对引入的需要分割的模块的命名（具体要学完codeSplitting才能理解）：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">output: &#123;</span><br><span class="line">    filename: <span class="string">&#x27;[name].js&#x27;</span>,</span><br><span class="line">    chunkFilename: <span class="string">&#x27;[name].chunk.js&#x27;</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">&#x27;bundle&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>以上配置完成后，直接运行<code>npx webpack</code> 就能在主目录下生成bundle文件夹和文件。</p></li><li><p>假如我们新建的这个文件不叫webpack.config.js，而叫别的如webconfig.js，怎么才能正确打包呢？<br>直接运行<code>$ npx webpack --config webconfig.js</code></p></li></ul><h3 id="2-3-2-整理项目结构"><a href="#2-3-2-整理项目结构" class="headerlink" title="2-3-2 整理项目结构"></a>2-3-2 整理项目结构</h3><p>​ 以lession为例：</p><ul><li><p>先删掉bundle文件夹</p></li><li><p>由于index.js是不能直接放到浏览器中运行的，它是我们的源代码，所以一般放在src目录里，其他现有的js也一样</p></li><li><p>修改配置文件webpack.config.js中相应的路径，然后再npx webpack打包：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: <span class="string">&#x27;bundle.js&#x27;</span>,</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">&#x27;dist&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注：如果不写path，webpack也会自动打包到dist目录</p></blockquote></li></ul><h3 id="2-3-3-如何用npm-scripts简化打包代码"><a href="#2-3-3-如何用npm-scripts简化打包代码" class="headerlink" title="2-3-3 如何用npm scripts简化打包代码"></a>2-3-3 如何用npm scripts简化打包代码</h3><p>在package.json中的scripts下添加bundle命令，以下代码意思是当执行bundle命令时会自动执行webpack命令，这样就不需要运行npx webpack命令了，直接运行<code>$ npm run bundle</code> 即可</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    ......</span><br><span class="line">    <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;bundle&quot;</span>: <span class="string">&quot;webpack&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>综上，整理成的简单项目目录如下：<br><img src="01.png" alt="01" style="zoom:80%"></p><h3 id="2-3-4-课后作业"><a href="#2-3-4-课后作业" class="headerlink" title="2-3-4 课后作业"></a>2-3-4 课后作业</h3><ul><li>阅读文档<a target="_blank" rel="noopener" href="https://webpack.js.org/guides/getting-started/">Getting Started</a>，<a target="_blank" rel="noopener" href="https://www.webpackjs.com/guides/getting-started/">中文文档</a>，巩固今天所讲的知识点</li></ul><h2 id="2-4-浅析webpack打包的知识点"><a href="#2-4-浅析webpack打包的知识点" class="headerlink" title="2-4 浅析webpack打包的知识点"></a>2-4 浅析webpack打包的知识点</h2><h3 id="2-4-1-解读打包输出信息"><a href="#2-4-1-解读打包输出信息" class="headerlink" title="2-4-1 解读打包输出信息"></a>2-4-1 解读打包输出信息</h3><ul><li><p>Hash: 61ec62c5c1d570273ace，代表本次打包的唯一一个哈希值</p></li><li><p>Version: webpack 4.35.3，代表本次打包使用的webpack4.35.3版本</p></li><li><p>Time: 112ms，代表当前这个包整体打包耗时是112ms</p></li><li><p>以下分别代表：</p><img src="02.png" alt="02" style="zoom:80%"><ul><li>Asset打包出一个bundle.js文件；</li><li>Size指这个文件的大小是1.36KB；</li><li>Chunks：复杂打包时会打包出很多文件，每个文件都有一个自己的id值，chunks里不仅放着自己文件bundle.js的id值，还会放其他打包出来的文件的id；</li><li>Chunk Names则是指每个打包出来的js文件对应的名字，这里名字之所以叫main，是因为配置文件中的entry实际上：<br><code>entry: &#39;./src/index.js&#39;,</code> 等同于 <code>entry: &#123; main: &#39;./src/index.js&#39; &#125;</code></li></ul></li><li><p>Entrypoint main = bundle.js代表入口文件</p></li><li><p>然后以此打包以下文件：</p><img src="03.png" alt="03" style="zoom:80%"></li><li><p>以下警告是因为我们在webpack配置时，没有指定打包的环境/模式mode：</p><img src="04.png" alt="04" style="zoom:80%"><p>在不写的情况下，默认模式为’production’，代码会被压缩；如果把mode改为’development’，打包后代码不会被压缩。</p><p><strong>webpack.config.js：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    mode: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h1 id="第3章-webpack核心概念"><a href="#第3章-webpack核心概念" class="headerlink" title="第3章 webpack核心概念"></a>第3章 webpack核心概念</h1><h2 id="3-1-loader是什么"><a href="#3-1-loader是什么" class="headerlink" title="3-1 loader是什么"></a>3-1 loader是什么</h2><h3 id="3-1-1-打包图片等静态资源"><a href="#3-1-1-打包图片等静态资源" class="headerlink" title="3-1-1 打包图片等静态资源"></a>3-1-1 打包图片等静态资源</h3><ul><li><p>直接打包会报错，需要去配置文件webpack.config.js中添加module-&gt;rules：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    ......</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [&#123;</span><br><span class="line">            test: <span class="regexp">/\.jpg$/</span>, <span class="comment">// 写法基本固定</span></span><br><span class="line">            use: &#123;</span><br><span class="line">                loader: <span class="string">&#x27;file-loader&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;]</span><br><span class="line">    &#125;,</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里打包jpg，用到file-loader工具，所以需要安装<code>$ npm install file-loader -D</code></p><blockquote><p>以上可以解读为：遇到模块module时，看它符合哪个规则rules，然后求助于use对应的loader进行打包。</p></blockquote></li><li><p>file-loader在底层帮我们做了几件事情：<br>（1）会把引入的图片打包移动到dist目录下，该图片会得到一个相对dist的名称<br>（2）然后该名称/地址会作为一个返回值返回引入该模块的变量之中</p></li><li><p>理论上，file-loader可以处理任何形式的静态资源</p></li><li><p>同理，打包.vue文件时，只需要在rules数组里添加一项即可：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    test: <span class="regexp">/\.vue$/</span>,</span><br><span class="line">    use: &#123;</span><br><span class="line">        loader: <span class="string">&#x27;vue-loader&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="3-1-2-loader是什么"><a href="#3-1-2-loader是什么" class="headerlink" title="3-1-2 loader是什么"></a>3-1-2 loader是什么</h3><ul><li>其实loader就是一个打包的方案，因为webpack不能识别非js结尾的文件，但是loader知道对于某个特定文件webpack应该如何进行打包</li><li>改写index.js：<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Avatar <span class="keyword">from</span> <span class="string">&#x27;./timg.jpg&#x27;</span></span><br><span class="line"><span class="keyword">var</span> img = <span class="keyword">new</span> Image()</span><br><span class="line">img.src = Avatar</span><br><span class="line"><span class="keyword">var</span> root = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>)</span><br><span class="line">root.append(img)</span><br></pre></td></tr></table></figure></li></ul><h2 id="3-2-使用loader打包静态资源-图片篇"><a href="#3-2-使用loader打包静态资源-图片篇" class="headerlink" title="3-2 使用loader打包静态资源 (图片篇)"></a>3-2 使用loader打包静态资源 (图片篇)</h2><h3 id="3-2-1-关于打包后的图片名称"><a href="#3-2-1-关于打包后的图片名称" class="headerlink" title="3-2-1 关于打包后的图片名称"></a>3-2-1 关于打包后的图片名称</h3><p>需要使用placeholders占位符语法，在module-&gt;rules-&gt;use下添加options：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">use: &#123;</span><br><span class="line">    loader: <span class="string">&#x27;file-loader&#x27;</span>,</span><br><span class="line">    options: &#123;</span><br><span class="line">        name: <span class="string">&#x27;[name]_[hash].[ext]&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>详见<a target="_blank" rel="noopener" href="https://webpack.js.org/loaders/file-loader/#placeholders">占位符</a>：</p><ul><li>[ext] 表示文件后缀</li><li>[hash] 表示打包出的文件的哈希值</li></ul></blockquote><h3 id="3-2-2-打包多种格式的图片"><a href="#3-2-2-打包多种格式的图片" class="headerlink" title="3-2-2 打包多种格式的图片"></a>3-2-2 打包多种格式的图片</h3><p>在module-&gt;rules-&gt;test的正则中补充：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test: <span class="regexp">/\.(jpg|png|gif)$/</span>,</span><br></pre></td></tr></table></figure><h3 id="3-2-3-打包到哪个文件夹"><a href="#3-2-3-打包到哪个文件夹" class="headerlink" title="3-2-3 打包到哪个文件夹"></a>3-2-3 打包到哪个文件夹</h3><p>假如想打包到dist下的images文件夹中，在module-&gt;rules-&gt;use-&gt;options下添加outputPath。</p><h3 id="3-2-4-url-loader"><a href="#3-2-4-url-loader" class="headerlink" title="3-2-4 url-loader"></a>3-2-4 url-loader</h3><ul><li><p>它能实现file-loader所能实现的所有功能：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [&#123;</span><br><span class="line">        test: <span class="regexp">/\.(jpg|png|gif)$/</span>, </span><br><span class="line">        use: &#123;</span><br><span class="line">            loader: <span class="string">&#x27;url-loader&#x27;</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">                name: <span class="string">&#x27;[name]_[hash].[ext]&#x27;</span>,</span><br><span class="line">                outputPath: <span class="string">&#x27;images/&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></li><li><p>使用前也要先安装<code>$ npm install url-loader -D</code>，然后运行<code>$ npm run bundle</code>，发现图片并没有被打包到dist目录下，但是却以base64格式出现在bundle.js中</p></li><li><p>url-loader带来的好处与问题：<br>图片被打包到js中，那么加载好js，图片也就加载好了，不用额外请求图片地址了，省了一次http请求，但是带来了新问题：如果这张图片特别大，那么打包生成的js文件也会特别大，那么加载js的时间就会很长，所以一开始很长时间里页面什么东西都显示不出来，所以url-loader的最佳使用方式是什么呢？<br>特别小的图片直接打包到js中，大图还是像file-loader那样打包到dist下。</p></li><li><p>以上具体怎么做呢？<br>在module-&gt;rules-&gt;use-&gt;options下添加limit，它的意思是如果图片超过limit范围（单位：字节Kb）就会被打包到dist目录下，未超出，就直接打包到js中。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">options: &#123;</span><br><span class="line">    ......</span><br><span class="line">    limit: <span class="number">20480</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="3-2-5-课后作业"><a href="#3-2-5-课后作业" class="headerlink" title="3-2-5 课后作业"></a>3-2-5 课后作业</h3><ul><li>阅读<a target="_blank" rel="noopener" href="https://webpack.js.org/loaders/file-loader/">file-loader文档</a></li><li>阅读<a target="_blank" rel="noopener" href="https://webpack.js.org/loaders/url-loader/">url-loader文档</a></li></ul><h2 id="3-3-使用loader打包静态资源-样式篇-上"><a href="#3-3-使用loader打包静态资源-样式篇-上" class="headerlink" title="3-3 使用loader打包静态资源 (样式篇-上)"></a>3-3 使用loader打包静态资源 (样式篇-上)</h2><h3 id="3-3-1-准备工作"><a href="#3-3-1-准备工作" class="headerlink" title="3-3-1 准备工作"></a>3-3-1 准备工作</h3><ul><li><p>新建src/index.css：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.avatar</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>在src/index.js中引入，并给img添加class：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Avatar <span class="keyword">from</span> <span class="string">&#x27;./timg.jpg&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./index.css&#x27;</span></span><br><span class="line"><span class="keyword">var</span> img = <span class="keyword">new</span> Image()</span><br><span class="line">img.src = Avatar</span><br><span class="line">img.classList.add(<span class="string">&#x27;avatar&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> root = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>)</span><br><span class="line">root.append(img)</span><br></pre></td></tr></table></figure></li></ul><h3 id="3-3-2-配置与安装"><a href="#3-3-2-配置与安装" class="headerlink" title="3-3-2 配置与安装"></a>3-3-2 配置与安装</h3><ul><li><p>module-&gt;rules下添加配置项：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">    use: [<span class="string">&#x27;style-loader&#x27;</span>, <span class="string">&#x27;css-loader&#x27;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>安装以上两个loader<code>$ npm install style-loader css-loader -D</code></p></li></ul><h3 id="3-3-3-两个loader的作用"><a href="#3-3-3-两个loader的作用" class="headerlink" title="3-3-3 两个loader的作用"></a>3-3-3 两个loader的作用</h3><ul><li><p>新建src/avatar.css：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.avatar</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>在src/index.css中引入avatar.css：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@import</span> <span class="string">&#x27;./avatar.css&#x27;</span></span><br></pre></td></tr></table></figure></li><li><p>css-loader会帮助分析出几个css之间的关系，最终把这些css文件合并成一个css；style-loader会把css-loader生成的css文件内容挂载到页面head中，因此二者要配合使用。</p></li></ul><h3 id="3-3-4-scss的打包和使用"><a href="#3-3-4-scss的打包和使用" class="headerlink" title="3-3-4 scss的打包和使用"></a>3-3-4 scss的打包和使用</h3><ul><li><p>修改index.css为index.scss并采用sass语法编写，然后在index.js引入：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="selector-class">.avatar</span> &#123;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &#x27;./index.scss&#x27;</span><br></pre></td></tr></table></figure></li><li><p>修改配置项：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    test: <span class="regexp">/\.scss$/</span>,</span><br><span class="line">    use: [<span class="string">&#x27;style-loader&#x27;</span>, <span class="string">&#x27;css-loader&#x27;</span>, <span class="string">&#x27;sass-loader&#x27;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>因为此处用到sass-loader，根据官网，需要安装<code>$ npm install sass-loader node-sass -D</code>，然后重新run即可</p></li><li><p>在webpack的配置中，loader是有先后顺序的，按照从下向上、从右到左的顺序执行，所以以上可以解读为：<br>当我们打包一个sass文件时，首先会执行sass-loader，对sass代码进行翻译成css代码，给到css-loader，然后都处理好后再给到style-loader，由它挂载到页面上。</p></li></ul><h3 id="3-3-5-自动添加css3厂商前缀-自己的demo中没成功"><a href="#3-3-5-自动添加css3厂商前缀-自己的demo中没成功" class="headerlink" title="3-3-5 自动添加css3厂商前缀 (自己的demo中没成功)"></a>3-3-5 自动添加css3厂商前缀 (自己的demo中没成功)</h3><ul><li>采用postcss-loader，照样是先安装<code>$ npm i postcss-loader -D</code>，再配置：<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    test: <span class="regexp">/\.scss$/</span>,</span><br><span class="line">    use: [</span><br><span class="line">        <span class="string">&#x27;style-loader&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;css-loader&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;sass-loader&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;postcss-loader&#x27;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>创建一个postcss.config.js文件，并配置相应的插件，这个插件需要先进行安装<code>$ npm install autoprefixer -D</code>：<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">         <span class="built_in">require</span>(<span class="string">&#x27;autoprefixer&#x27;</span>)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="3-4-使用loader打包静态资源-样式篇-下"><a href="#3-4-使用loader打包静态资源-样式篇-下" class="headerlink" title="3-4 使用loader打包静态资源 (样式篇-下)"></a>3-4 使用loader打包静态资源 (样式篇-下)</h2><h3 id="3-4-1-css-loader的配置项"><a href="#3-4-1-css-loader的配置项" class="headerlink" title="3-4-1 css-loader的配置项"></a>3-4-1 css-loader的配置项</h3><ul><li><p>不用字符串形式，采用对象形式：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    test: <span class="regexp">/\.scss$/</span>,</span><br><span class="line">    use: [</span><br><span class="line">        <span class="string">&#x27;style-loader&#x27;</span>,</span><br><span class="line">        &#123;</span><br><span class="line">            loader: <span class="string">&#x27;css-loader&#x27;</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">                importLoaders: <span class="number">2</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&#x27;sass-loader&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;postcss-loader&#x27;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>上面的情况主要解决index.scss文件中再引入@import其他的sass文件如avatar.scss，原本它只使用css-loader，不会从postcss到sass再到css…，采用importLoaders使得avatar.scss也要先运行前面的2个loader才到css-loader。</p></li></ul><h3 id="3-4-2-css打包的模块化"><a href="#3-4-2-css打包的模块化" class="headerlink" title="3-4-2 css打包的模块化"></a>3-4-2 css打包的模块化</h3><ul><li>CSS Modules即模块化的css，为了防止样式引入后影响全局，需要先添加配置module:true，即开启css模块化打包功能：<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    loader: <span class="string">&#x27;css-loader&#x27;</span>,</span><br><span class="line">    options: &#123;</span><br><span class="line">        importLoaders: <span class="number">2</span>,</span><br><span class="line">        <span class="built_in">module</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></li><li>然后采用以下方式在当前文件src/index.js中引入使用样式：<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> style <span class="keyword">from</span> <span class="string">&#x27;./index.scss&#x27;</span></span><br><span class="line">......</span><br><span class="line">img.classList.add(style.avatar)</span><br></pre></td></tr></table></figure></li></ul><h3 id="3-4-3-使用webpack打包第三方字体文件"><a href="#3-4-3-使用webpack打包第三方字体文件" class="headerlink" title="3-4-3 使用webpack打包第三方字体文件"></a>3-4-3 使用webpack打包第三方字体文件</h3><ul><li><p>以iconfont为例，下载字体包，并把.eot、.svg、.ttf、.woff文件复制到src/font目录下</p></li><li><p>复制iconfont.css内容到src/index.scss中，并修改路径：</p><img src="05.png" alt="05" style="zoom:67%"></li><li><p>在webpack.config.js中对以上四种格式的文件.eot、.svg、.ttf、.woff进行配置：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [&#123;</span><br><span class="line">        test: <span class="regexp">/\.(eot|woff|ttf|svg)$/</span>,</span><br><span class="line">        use: &#123;</span><br><span class="line">            loader: <span class="string">&#x27;file-loader&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure></li><li><p>在src/index.js中引入并使用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./index.scss&#x27;</span></span><br><span class="line"><span class="keyword">var</span> root = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>)</span><br><span class="line">root.innerHTML = <span class="string">&#x27;&lt;div class=&quot;iconfont icon-icon_bangzhuwendang&quot;&gt;&lt;/div&gt;&#x27;</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="3-4-4-课后作业"><a href="#3-4-4-课后作业" class="headerlink" title="3-4-4 课后作业"></a>3-4-4 课后作业</h3><ul><li>阅读<a target="_blank" rel="noopener" href="https://webpack.js.org/guides/asset-management/">Asset Management文档</a>，详细讲解了CSS、Images和Fonts文件的打包形式，还额外介绍了Data数据文件（如.csv文件）的打包方法，还讲解了Webpack打包带来的好处和使用技巧。</li><li>仔细阅读<a target="_blank" rel="noopener" href="https://webpack.js.org/loaders/">loaders文档如sass-loader、css-loader、style-loader、postcss-loader</a></li></ul><h2 id="3-5-使用plugins让打包更便捷"><a href="#3-5-使用plugins让打包更便捷" class="headerlink" title="3-5 使用plugins让打包更便捷"></a>3-5 使用plugins让打包更便捷</h2><h3 id="3-5-1-html-webpack-plugin"><a href="#3-5-1-html-webpack-plugin" class="headerlink" title="3-5-1 html-webpack-plugin"></a>3-5-1 html-webpack-plugin</h3><ul><li><p>作用：它会在打包结束后，自动生成一个html文件，并把打包生成的js自动引入到这个html文件中。</p></li><li><p>先进行安装<code>$ npm i -D html-webpack-plugin</code>，再向webpack.config.js中添加配置项：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    mode: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">    entry: &#123; ...... &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123; ...... &#125;,</span><br><span class="line">    output: &#123; ...... &#125;,</span><br><span class="line">    plugins: [<span class="keyword">new</span> HtmlWebpackPlugin()]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>重新打包后生成的html模板中只引入了相应的js，并没有对应的dom元素，这就需要创造html模板，并将其配置进来再打包。</p></li><li><p>在src下新建index.html模板：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>html模板<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>对其进行配置：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">plugins: [<span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">    template: <span class="string">&#x27;src/index.html&#x27;</span></span><br><span class="line">&#125;)]</span><br></pre></td></tr></table></figure></li></ul><h3 id="3-5-2-clean-webpack-plugin"><a href="#3-5-2-clean-webpack-plugin" class="headerlink" title="3-5-2 clean-webpack-plugin"></a>3-5-2 clean-webpack-plugin</h3><ul><li><p>它是个第三方webpack插件，适用于当重新打包时能自动把dist目录先删除，然后再去执行打包</p></li><li><p>同样是先安装<code>$ npm i -D clean-webpack-plugin</code>，再配置：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; CleanWebpackPlugin &#125; = <span class="built_in">require</span>(<span class="string">&#x27;clean-webpack-plugin&#x27;</span>)  <span class="comment">// 注：此处跟视频讲的用法发生了变 </span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    ......</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: <span class="string">&#x27;src/index.html&#x27;</span></span><br><span class="line">        &#125;), </span><br><span class="line">        <span class="keyword">new</span> CleanWebpackPlugin()  <span class="comment">// 注：此处跟视频讲的用法发生了变化</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上表示当我们在<strong>打包前</strong>会使用CleanWebpackPlugin删除dist目录下的所有内容</p></li></ul><h3 id="3-5-3-总结plugin的作用"><a href="#3-5-3-总结plugin的作用" class="headerlink" title="3-5-3 总结plugin的作用"></a>3-5-3 总结plugin的作用</h3><ul><li>plugin可以在webpack运行到某个时刻时，帮你做一些事情，它很类似vue或react的生命周期函数</li><li>以上的HtmlWebpackPlugin就是帮我们在打包过程结束后生成一个html文件，然后把打包生成的结果注入到html文件中</li></ul><h2 id="3-6-entry与output的基础配置"><a href="#3-6-entry与output的基础配置" class="headerlink" title="3-6 entry与output的基础配置"></a>3-6 entry与output的基础配置</h2><h3 id="3-6-1-实现新需求-把src下的index-js打包两次生成不同的js"><a href="#3-6-1-实现新需求-把src下的index-js打包两次生成不同的js" class="headerlink" title="3-6-1 实现新需求-把src下的index js打包两次生成不同的js"></a>3-6-1 实现新需求-把src下的index js打包两次生成不同的js</h3><ul><li><p>在output中使用占位符[name]，对应上面的main和sub，这时打包生成的index.html中会同时引入main.js和sub.js：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        main: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">        sub: <span class="string">&#x27;./src/index.js&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    ......        </span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: <span class="string">&#x27;src/index.html&#x27;</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> CleanWebpackPlugin()</span><br><span class="line">    ],</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: <span class="string">&#x27;[name].js&#x27;</span>,</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">&#x27;dist&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="3-6-2-实现新需求-后台用index-html作为入口-其他静态资源如js放到cdn上"><a href="#3-6-2-实现新需求-后台用index-html作为入口-其他静态资源如js放到cdn上" class="headerlink" title="3-6-2 实现新需求-后台用index html作为入口 其他静态资源如js放到cdn上"></a>3-6-2 实现新需求-后台用index html作为入口 其他静态资源如js放到cdn上</h3><ul><li><p>在output中配置cdn的地址：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">output: &#123;</span><br><span class="line">    publicPath: <span class="string">&#x27;http://cdn.com.cn&#x27;</span>,</span><br><span class="line">    filename: <span class="string">&#x27;[name].js&#x27;</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">&#x27;dist&#x27;</span>)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></li><li><p>这样打包生成的index.html就这样引入js：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;http://cdn.com.cn/main.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;http://cdn.com.cn/sub.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="3-6-3-课后作业"><a href="#3-6-3-课后作业" class="headerlink" title="3-6-3 课后作业"></a>3-6-3 课后作业</h3><ul><li>简单阅读<a target="_blank" rel="noopener" href="https://webpack.js.org/configuration/output/">output文档</a>，重点理解已讲过的publicPath、filename和path</li><li>阅读<a target="_blank" rel="noopener" href="https://webpack.js.org/configuration/entry-context/">Entry and Context文档</a></li><li>仔细阅读<a target="_blank" rel="noopener" href="https://webpack.js.org/guides/output-management/">Output Management文档</a>，这里重点讲解了HtmlWebpackPlugin和CleanWebpackPlugin以及plugin的概念</li><li>仔细阅读<a target="_blank" rel="noopener" href="https://webpack.js.org/plugins/html-webpack-plugin/">HtmlWebpackPlugin文档</a>，从下面的‘plugin documentation’进入查看详情</li></ul><h2 id="3-7-sourcemap的配置"><a href="#3-7-sourcemap的配置" class="headerlink" title="3-7 sourcemap的配置"></a>3-7 sourcemap的配置</h2><h3 id="3-7-1-关闭sourcemap"><a href="#3-7-1-关闭sourcemap" class="headerlink" title="3-7-1 关闭sourcemap"></a>3-7-1 关闭sourcemap</h3><p>简化项目后，由于配置中mode为’development’说明是开发者模式，默认SourceMap已经被配进去了，如何关闭呢？</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    mode: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">    devtool: <span class="string">&#x27;none&#x27;</span>,</span><br><span class="line">    ......</span><br></pre></td></tr></table></figure><h3 id="3-7-2-sourcemap的适用场景"><a href="#3-7-2-sourcemap的适用场景" class="headerlink" title="3-7-2 sourcemap的适用场景"></a>3-7-2 sourcemap的适用场景</h3><ul><li><p>比如说我们把src/index.js中故意写错一行代码，打包仍然正常进行，但是页面console中会报错，我们点开后只能追溯到被打包的文件中（如dist/main.js第96行），怎样才能追溯到原文件中呢？这就需要SourceMap的帮助了！</p></li><li><p>SourceMap本质上是一个映射关系，它知道dist/main.js文件第96行对应的是src/index.js的第一行，所以就能知道具体哪段代码出错了。</p></li><li><p>怎么使用它呢？其实很简单，只要设置<code>devtool: &#39;source-map&#39;</code> 即可。</p></li><li><p>简单解读<a target="_blank" rel="noopener" href="https://webpack.js.org/configuration/devtool/">SourceMap文档</a>：</p><img src="06.png" alt="06" style="zoom:80%"><blockquote><ul><li>当我们配置<code>devtool: &#39;source-map&#39;</code> 时，表格中build和rebuild的速度都是–，说明打包的过程都会变慢，因为它需要构建这种映射关系。这时dist目录下会多出一个main.js.map文件，这里面就是一个映射的对应关系。<br><img src="data:image/png;base64,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" alt="image.png"></li><li>带inline-前缀，那个.map文件就会变成一个base64字符串被放到dist/main.js中的底部：<br><code>//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJ......</code></li><li>带cheap-前缀，就只把报错精确到行，能提升打包性能，而不是像上面两种精确到列；<br>另外，带cheap-前缀，它就只映射我们的业务代码，而不会管如loader这样的第三方模块如何映射。</li><li>但若想让cheap-前缀的sourceMap也映射第三方模块，就需要设置成<code>devtool: &#39;cheap-module-source-map&#39;</code>。</li><li><code>devtool: eval</code> 的打包速度最快、性能最好，它不会产生.map文件也不会生成很长的base64字符串，只在main.js里多出一行代码：<br><code>eval(&quot;consoele.log(&#39;hello world&#39;)\n\n//# sourceURL=webpack:///./src/index.js?&quot;);</code><br>但是针对比较复杂的代码，它提示出来的内容可能并不全面。</li><li>最佳实践：<br>（1）开发环境mode:’development’采用<code>devtool: cheap-module-eval-source-map</code>，这种方式提示出的错误比较全，打包速度比较快。<br>（2）生产环境mode:’production’采用<code>devtool: cheap-module-source-map</code>，这样它的提示效果会更好一些。</li></ul></blockquote></li><li><p>注意：面试中常会问到SourceMap的原理，有时间看看！！！</p></li></ul><h2 id="3-8-使用webpack-dev-server提升开发效率"><a href="#3-8-使用webpack-dev-server提升开发效率" class="headerlink" title="3-8 使用webpack-dev-server提升开发效率"></a>3-8 使用webpack-dev-server提升开发效率</h2><h3 id="3-8-1-实现开发需求-边改东西边自动打包-不再手动打包了"><a href="#3-8-1-实现开发需求-边改东西边自动打包-不再手动打包了" class="headerlink" title="3-8-1 实现开发需求-边改东西边自动打包 不再手动打包了"></a>3-8-1 实现开发需求-边改东西边自动打包 不再手动打包了</h3><ul><li><p>方法1：为package.json中的打包指令添加参数–watch，意思是webpack会帮我们监听它打包的文件，只要要打包的发生变化，就会重新打包（此方法还不够好）：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;watch&quot;</span>: <span class="string">&quot;webpack --watch&quot;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></li><li><p>方法2：如果我们第一次运行时，既可以自动打包，又能帮我自动打开浏览器，还能模拟服务器上的特性，这就要借助WebpackDevServer来实现。</p><ul><li>先进行安装<code>$ npm i -D webpack-dev-server</code></li><li>在webpack.config.js中进行配置：<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    ......</span><br><span class="line">    entry: &#123; ...... &#125;,</span><br><span class="line">    devServer: &#123;</span><br><span class="line">        contentBase: <span class="string">&#x27;./dist&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123; ...... &#125;,</span><br><span class="line">    ......</span><br></pre></td></tr></table></figure>以上配置的意思是服务器要启在哪个文件夹下，此处配置成当前目录下的dist下。</li><li>再去package.json中写个运行指令：<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;start&quot;: &quot;webpack-dev-server&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>运行成功后会提示<code>Project is running at http://localhost:8080/</code>，表示项目启动在8080端口，我们直接在浏览器中访问即可。<blockquote><p>这种方法与方法1相比，不但会监听到文件发生了改变重新打包，还会自动刷新浏览器，因此用它能更方便地提升我们代码开发的效率。</p></blockquote></li><li>若想实现devServer启动时自动打开浏览器并访问服务器地址，还需要下面的配置：<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">devServer: &#123;</span><br><span class="line">    contentBase: <span class="string">&#x27;./dist&#x27;</span>,</span><br><span class="line">    open: <span class="literal">true</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></li><li>综上，我们为什么要开启这样的一个web服务器呢？<br>因为如果还是按照原来的方式打开页面（地址为file:///C:/studyFiles/lession/dist/index.html），就不能在开发时发送ajax请求，因为ajax请求要求页面必须在一个服务器上，通过http协议的方式打开。而使用devServer后，页面地址为<a target="_blank" rel="noopener" href="http://localhost:8080/%E6%98%AFhttp%E7%9A%84%E4%B8%80%E4%B8%AA%E7%BD%91%E5%9D%80%EF%BC%8C%E6%89%80%E4%BB%A5%E8%83%BD%E9%A1%BA%E5%88%A9%E5%8F%91ajax%E8%AF%B7%E6%B1%82%E3%80%82">http://localhost:8080/是http的一个网址，所以能顺利发ajax请求。</a></li><li>我们常用的vue-cli3和react新版的脚手架底层也都使用了WebpackDevServer，所以能支持如proxy配置，它是帮助我们做跨域时要使用的接口代理：<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">devServer: &#123;</span><br><span class="line">    contentBase: <span class="string">&#x27;./dist&#x27;</span>,</span><br><span class="line">    open: <span class="literal">true</span>,</span><br><span class="line">    proxy: &#123;</span><br><span class="line">        <span class="string">&#x27;/api&#x27;</span>: <span class="string">&#x27;http://localhost:3000&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>以上表示当访问<a target="_blank" rel="noopener" href="http://localhost:8080/api/%E5%BC%80%E5%A4%B4%E7%9A%84%E6%8E%A5%E5%8F%A3%E6%97%B6%E4%BC%9A%E8%87%AA%E5%8A%A8%E8%BD%AC%E5%88%B0http://localhost:3000">http://localhost:8080/api/开头的接口时会自动转到http://localhost:3000</a></li><li>devServer还有好多其他的配置项，如端口port: 8080(默认)等</li></ul></li><li><p>方法3 扩充眼界，非重点</p><ul><li><p>在package.json中创建指令<code>&quot;server&quot;: &quot;node server.js&quot;</code>，意思是当运行middleware时，我想自己写个服务器，这个服务器如果监听到src下的内容有改变，它会像webpackDevServer一样帮助我们重启服务器、更新网页上的内容，那么怎么写server.js呢？</p></li><li><p>在package.json同级创建server.js文件，因为在node环境下，我们选择使用express帮助快速搭建一个http服务器，因为这个服务器要监听webpack文件的变化，然后帮助自动重新打包，所以还要借助webpack的开发中间件webpack-dev-middleware，按照命令为<code>$ npm i -D express webpack-dev-middleware</code></p></li><li><p>去webpack.config.js中的output下修改publicPath: ‘/‘，它表示所有的打包文件的引用前面都加个根路径：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">output: &#123;</span><br><span class="line">    publicPath: <span class="string">&#x27;/&#x27;</span>,  <span class="comment">// 可以不用配置</span></span><br></pre></td></tr></table></figure></li><li><p>开始编写server.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>)</span><br><span class="line"><span class="comment">// 创建一个服务器实例</span></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line">app.listen(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;server is running&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>其实写成这样就可以启动服务器了，运行’$ npm run server’ 试试看！</p></li><li><p>继续编写server.js：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> webpackDevMiddleware = <span class="built_in">require</span>(<span class="string">&#x27;webpack-dev-middleware&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">&#x27;./webpack.config&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> complier = webpack(config) <span class="comment">// 用webpack结合配置文件可以随时进行代码的编译，让这个编译器执行一次就会重新打包一次代码</span></span><br><span class="line"><span class="comment">// 创建一个服务器实例</span></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line">app.use(webpackDevMiddleware(complier, &#123;</span><br><span class="line">    publicPath: config.output.publicPath  <span class="comment">// 可以去掉</span></span><br><span class="line">&#125;))  <span class="comment">// 只要文件改变了，complier就会重新运行，生成的文件对应的打包输出内容的publicPath就是config.output.publicPath</span></span><br><span class="line">app.listen(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;server is running&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>重新运行指令后，在<a target="_blank" rel="noopener" href="http://localhost:3000/%E5%8D%B3%E5%8F%AF%E8%AE%BF%E9%97%AE%E5%88%B0%E9%A1%B5%E9%9D%A2">http://localhost:3000/即可访问到页面</a></p></li></ul></li><li><p>综上，我们学会了两种使用webpack的方式：在node中使用和在命令行使用。</p></li></ul><h3 id="3-8-2-参考以下文档"><a href="#3-8-2-参考以下文档" class="headerlink" title="3-8-2 参考以下文档"></a>3-8-2 参考以下文档</h3><ul><li><a target="_blank" rel="noopener" href="https://webpack.js.org/api/cli/">CLI文档</a></li><li><a target="_blank" rel="noopener" href="https://webpack.js.org/api/node/">Node Api文档</a></li></ul><h3 id="3-8-3-课后作业"><a href="#3-8-3-课后作业" class="headerlink" title="3-8-3 课后作业"></a>3-8-3 课后作业</h3><ul><li>阅读<a target="_blank" rel="noopener" href="https://webpack.js.org/guides/development/">Development文档</a></li><li>阅读<a target="_blank" rel="noopener" href="https://webpack.js.org/configuration/devtool/">Devtool文档</a></li><li>阅读<a target="_blank" rel="noopener" href="https://webpack.js.org/configuration/dev-server/">DevServer文档</a></li></ul><h2 id="3-9-hot-module-replacement-hmr-热模块更新-1"><a href="#3-9-hot-module-replacement-hmr-热模块更新-1" class="headerlink" title="3-9 hot module replacement (hmr) 热模块更新 (1)"></a>3-9 hot module replacement (hmr) 热模块更新 (1)</h2><h3 id="3-9-1-针对css文件的使用"><a href="#3-9-1-针对css文件的使用" class="headerlink" title="3-9-1 针对css文件的使用"></a>3-9-1 针对css文件的使用</h3><ul><li><p>修改或添加配置：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">    use: [</span><br><span class="line">        <span class="string">&#x27;style-loader&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;css-loader&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;postcss-loader&#x27;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>在package.json中配置运行命令，然后运行<code>$ npm run start</code> 启动服务：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;start&quot;</span>: <span class="string">&quot;webpack-dev-server&quot;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>这种启动打包方式不会生成dist目录，因为webpackDevServer把打包生成的文件放到了电脑的内存中，这样可以有效提升打包的速度，让开发变得更快。</p></li><li><p>在src/index.js编写简单的功能，然后希望在偶数行添加一个背景，结合src/style.css使用如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./style.css&#x27;</span></span><br><span class="line"><span class="keyword">var</span> btn = <span class="built_in">document</span>.createElement(<span class="string">&#x27;button&#x27;</span>)</span><br><span class="line">btn.innerHTML = <span class="string">&#x27;新增&#x27;</span></span><br><span class="line"><span class="built_in">document</span>.body.appendChild(btn)</span><br><span class="line">btn.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> div = <span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">    div.innerHTML = <span class="string">&#x27;item&#x27;</span></span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(div)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span><span class="selector-pseudo">:nth-of-type</span>(odd) &#123;</span><br><span class="line">    <span class="attribute">background</span>: yellow;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>针对以上的功能，希望在改变样式代码时webpack不会自动刷新页面，只是把样式代码给替换掉，页面上之前渲染出的内容不要动，这时就可以借助HMR了，其配置如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    ......</span><br><span class="line">    devServer: &#123;</span><br><span class="line">        ......</span><br><span class="line">        hot: <span class="literal">true</span>,</span><br><span class="line">        hotOnly: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    ......</span><br><span class="line">    plugins: [</span><br><span class="line">        ......</span><br><span class="line">        <span class="keyword">new</span> webpack.HotModuleReplacementPlugin()</span><br><span class="line">    ],</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>这里的hotOnly可以理解为即便hot: true没有使热更新生效，也可以不让浏览器刷新。</p></blockquote></li><li><p>综上，使用HMR的好处之一是，它可以在我们写CSS时，方便我们调试CSS</p></li></ul><h3 id="3-9-2-针对js文件的使用"><a href="#3-9-2-针对js文件的使用" class="headerlink" title="3-9-2 针对js文件的使用"></a>3-9-2 针对js文件的使用</h3><p>​ 举例说明：</p><ul><li><p>将配置文件中的HMR相关代码先注掉，并重启服务：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hot: true,</span></span><br><span class="line"><span class="comment">// hotOnly: true</span></span><br><span class="line"><span class="comment">// new webpack.HotModuleReplacementPlugin()</span></span><br></pre></td></tr></table></figure></li><li><p>新建src/counter.js：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">counter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> div = <span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">    div.setAttribute(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;counter&#x27;</span>)</span><br><span class="line">    div.innerHTML = <span class="number">1</span></span><br><span class="line">    div.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        div.innerHTML = <span class="built_in">parseInt</span>(div.innerHTML, <span class="number">10</span>) + <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(div)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> counter</span><br></pre></td></tr></table></figure></li><li><p>在src/index.js中引入调用，在页面立即就能看到效果：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> counter <span class="keyword">from</span> <span class="string">&#x27;./counter&#x27;</span></span><br><span class="line">counter()</span><br></pre></td></tr></table></figure></li></ul><h2 id="3-10-hot-module-replacement-hmr-热模块更新-2"><a href="#3-10-hot-module-replacement-hmr-热模块更新-2" class="headerlink" title="3-10 hot module replacement (hmr) 热模块更新 (2)"></a>3-10 hot module replacement (hmr) 热模块更新 (2)</h2><p>紧接以上：</p><h3 id="3-10-1-针对js文件的使用"><a href="#3-10-1-针对js文件的使用" class="headerlink" title="3-10-1 针对js文件的使用"></a>3-10-1 针对js文件的使用</h3><ul><li><p>新建src/number.js：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">number</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> div = <span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">    div.setAttribute(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;number&#x27;</span>)</span><br><span class="line">    div.innerHTML = <span class="number">1000</span></span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(div)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> number</span><br></pre></td></tr></table></figure></li><li><p>同样在src/index.js中引入并调用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> number <span class="keyword">from</span> <span class="string">&#x27;./number&#x27;</span></span><br><span class="line">number()</span><br></pre></td></tr></table></figure></li><li><p>在以上准备完成后，进行如下操作：点击上行数字1累加到10，下面仍是1000，假如我手动将src/number.js中的<code>div.innerHTML</code>设为2000，保存后页面就会刷新，从而使上一行数字又重置为1。但是我们需要修改number.js文件，只更新下行数字，上行仍保留之前的操作，怎么实现呢？当然还是借助HMR咯~</p></li><li><p>先解开配置项中关于HMR的注释并重启，在index.js中添加如下代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="built_in">module</span>.hot) &#123;</span><br><span class="line">    <span class="built_in">module</span>.hot.accept(<span class="string">&#x27;./number&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">document</span>.body.removeChild(<span class="built_in">document</span>.getElementById(<span class="string">&#x27;number&#x27;</span>))</span><br><span class="line">        number()  <span class="comment">// 先清除再挂载</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>以上代码表示如果开启了热更新功能，如果它所依赖的模块发生了变化，就会执行第二个参数的业务逻辑。<br>在使用Vue和React时，我们都不需要写这样的代码就能实现HMR，那是因为前者使用的vue-loader和后者使用的babel-preset都内置了HMR代码。</p></blockquote></li></ul><h3 id="3-10-2-课后作业"><a href="#3-10-2-课后作业" class="headerlink" title="3-10-2 课后作业"></a>3-10-2 课后作业</h3><ul><li>阅读模块热替换<a target="_blank" rel="noopener" href="https://www.webpackjs.com/guides/hot-module-replacement/">https://www.webpackjs.com/guides/hot-module-replacement/</a></li><li>阅读模块热替换API<a target="_blank" rel="noopener" href="https://www.webpackjs.com/api/hot-module-replacement/">https://www.webpackjs.com/api/hot-module-replacement/</a></li><li>简单了解HMR底层原理<a target="_blank" rel="noopener" href="https://www.webpackjs.com/concepts/hot-module-replacement/">https://www.webpackjs.com/concepts/hot-module-replacement/</a></li></ul><h2 id="3-11-使用babel处理es6语法-1"><a href="#3-11-使用babel处理es6语法-1" class="headerlink" title="3-11 使用babel处理es6语法 (1)"></a>3-11 使用babel处理es6语法 (1)</h2><h3 id="3-11-1-在webpack中使用babel"><a href="#3-11-1-在webpack中使用babel" class="headerlink" title="3-11-1 在webpack中使用babel"></a>3-11-1 在webpack中使用babel</h3><ul><li><p>比如我们在src/index.js中编写ES6代码后，运行<code>$ npx webpack</code>后查看main.js相应的代码仍是ES6语法，在低版本或一些国产的浏览器中无法识别，所以我们需要借助babel。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [</span><br><span class="line">    <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">() =&gt;</span> &#123;&#125;),</span><br><span class="line">    <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">() =&gt;</span> &#123;&#125;)</span><br><span class="line">]</span><br><span class="line">arr.map(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(item)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>进入babel的官网的Setup模块选中Webpack<a target="_blank" rel="noopener" href="https://babeljs.io/setup#installation">https://babeljs.io/setup#installation</a>，根据文档一步步安装和使用。</p></li><li><p>安装运行指令<code>$ npm install --save-dev babel-loader @babel/core</code>，其中babel/core是babel的核心库。</p></li><li><p>在webpack.config.js配置相应的rules：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [&#123;</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span>,  <span class="comment">// 排除该文件夹的第三方模块，因为这些模块都已经打包好了，排除它能提升打包速度和编译性能</span></span><br><span class="line">        loader: <span class="string">&#x27;babel-loader&#x27;</span></span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure></li><li><p>以上只是将babel和webpack做了通信，而babel/preset-env是将ES6语法翻译成ES5，运行安装<code>$ npm install @babel/preset-env --save-dev</code>后再进行配置即可：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">rules: [&#123;</span><br><span class="line">    test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">    exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">    loader: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">    options: &#123;</span><br><span class="line">        presets: [<span class="string">&#x27;@babel/preset-env&#x27;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></li><li><p>虽然ES6被翻译成了ES5，但以下仍有些代码如Promise在低版本浏览器中难以识别，所以需要借助polyfill，运行指令<code>$ npm install --save @babel/polyfill</code>进行安装。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">eval</span>(<span class="string">&quot;var arr = [new Promise(function () &#123;&#125;), new Promise(function () &#123;&#125;)];\narr.map(function (item) &#123;\n console.log(item);\n&#125;);</span></span><br></pre></td></tr></table></figure><p>以上安装完成，只需要在相应的js文件中引入即可：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;@babel/polyfill&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> arr = []</span><br></pre></td></tr></table></figure></li><li><p>以上使用polyfill后打包出来的main.js大小由30k左右变成900k，因为要做map方法的实现然后加到main.js中，而且还把babel/polyfill一并打包到其中，导致它变得特别大。如果避免polyfill全部被打包进来，只需要进行如下配置即可：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">options: &#123;</span><br><span class="line">    presets: [</span><br><span class="line">        [<span class="string">&#x27;@babel/preset-env&#x27;</span>, &#123;</span><br><span class="line">            useBuiltIns: <span class="string">&#x27;usage&#x27;</span></span><br><span class="line">        &#125;]</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>这样就只会打包polyfill中跟业务代码中的ES6语法相关的代码，能达到精简main.js的目的。</p></blockquote></li></ul><h2 id="3-12-使用babel处理es6语法-2"><a href="#3-12-使用babel处理es6语法-2" class="headerlink" title="3-12 使用babel处理es6语法 (2)"></a>3-12 使用babel处理es6语法 (2)</h2><h3 id="3-12-1-配置项targets"><a href="#3-12-1-配置项targets" class="headerlink" title="3-12-1 配置项targets"></a>3-12-1 配置项targets</h3><ul><li><p>针对某个浏览器打包，假如该浏览器支持ES6语法，打包后的代码就不会被翻译，反之则会：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">presets: [</span><br><span class="line">    [<span class="string">&#x27;@babel/preset-env&#x27;</span>, &#123;</span><br><span class="line">        <span class="string">&#x27;targets&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;chrome&#x27;</span>: <span class="string">&#x27;58&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;ie&#x27;</span>: <span class="string">&#x27;11&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        useBuiltIns: <span class="string">&#x27;usage&#x27;</span></span><br><span class="line">    &#125;]</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li></ul><h3 id="3-12-2-babel-plugin-transform-runtime"><a href="#3-12-2-babel-plugin-transform-runtime" class="headerlink" title="3-12-2 babel plugin-transform-runtime"></a>3-12-2 babel plugin-transform-runtime</h3><p>​ 在开发组件库或类库或第三方模块时，以上引入polyfill的方法会生成全局变量，污染到全局环境，所以需要换一种配置的方式：</p><ul><li><p>在index.js中取消引入polyfill，进入transform-runtime官网<a target="_blank" rel="noopener" href="https://babeljs.io/docs/en/babel-plugin-transform-runtime">https://babeljs.io/docs/en/babel-plugin-transform-runtime</a></p></li><li><p>安装<code>$ npm install --save-dev @babel/plugin-transform-runtime</code>和<code>$ npm install --save @babel/runtime</code></p></li><li><p>修改配置：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">rules: [&#123;</span><br><span class="line">    test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">    exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">    loader: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">    options: &#123;</span><br><span class="line">        <span class="string">&#x27;plugins&#x27;</span>: [</span><br><span class="line">            [<span class="string">&#x27;@babel/plugin-transform-runtime&#x27;</span>, &#123;</span><br><span class="line">                <span class="string">&#x27;corejs&#x27;</span>: <span class="number">2</span>,  <span class="comment">// 此处跟官网不一样，值改成了2</span></span><br><span class="line">                <span class="string">&#x27;helpers&#x27;</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="string">&#x27;regenerator&#x27;</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="string">&#x27;useESModules&#x27;</span>: <span class="literal">false</span></span><br><span class="line">            &#125;]</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></li><li><p>以上配置会报错，所以需要安装<code>$ npm install --save @babel/runtime-corejs2</code></p><blockquote><p>综上，如果写的是业务代码，只需要采取引入polyfill的方式即可；如果写的库代码，就要使用transform-runtime插件方式，防止污染全局环境。</p></blockquote></li><li><p>以上配置的options可以放到.babelrc文件中，打包结果是一样的：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;plugins&quot;</span>: [</span><br><span class="line">        [<span class="string">&quot;@babel/plugin-transform-runtime&quot;</span>, &#123;</span><br><span class="line">            <span class="string">&quot;corejs&quot;</span>: <span class="number">2</span>,</span><br><span class="line">            <span class="string">&quot;helpers&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">&quot;regenerator&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">&quot;useESModules&quot;</span>: <span class="literal">false</span></span><br><span class="line">        &#125;]</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="3-13-webpack实现对react框架代码的打包"><a href="#3-13-webpack实现对react框架代码的打包" class="headerlink" title="3-13 webpack实现对react框架代码的打包"></a>3-13 webpack实现对react框架代码的打包</h2><h3 id="3-13-1-准备工作"><a href="#3-13-1-准备工作" class="headerlink" title="3-13-1 准备工作"></a>3-13-1 准备工作</h3><p>​ 由于是开发业务代码，进行如下配置即可：</p><ul><li><p>webpack.config.js配置：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [&#123;</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">        loader: <span class="string">&#x27;babel-loader&#x27;</span></span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure></li><li><p>.babelrc中的配置：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;presets&quot;</span>: [</span><br><span class="line">        [<span class="string">&quot;@babel/preset-env&quot;</span>, &#123;</span><br><span class="line">            <span class="string">&quot;targets&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;chrome&quot;</span>: <span class="string">&quot;67&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;useBuiltIns&quot;</span>: <span class="string">&quot;usage&quot;</span></span><br><span class="line">        &#125;]</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>在src/index.js引入polyfill：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;@babel/polyfill&#x27;</span>;</span><br></pre></td></tr></table></figure></li></ul><h3 id="3-13-2-安装与使用"><a href="#3-13-2-安装与使用" class="headerlink" title="3-13-2 安装与使用"></a>3-13-2 安装与使用</h3><ul><li><p>官网<a target="_blank" rel="noopener" href="https://babeljs.io/docs/en/babel-preset-react">https://babeljs.io/docs/en/babel-preset-react</a></p></li><li><p>安装运行<code>$ npm install --save-dev @babel/preset-react</code>，并在.babelrc中添加配置：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;presets&quot;</span>: [            </span><br><span class="line">        [<span class="string">&quot;@babel/preset-env&quot;</span>, &#123;</span><br><span class="line">            ......</span><br><span class="line">        &#125;],</span><br><span class="line">        <span class="string">&quot;@babel/preset-react&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注：由于自下而上执行的原则，此处一定要把preset-react写到preset-env下面。</p></blockquote></li><li><p>使用react<code>$ npm install react react-dom --save</code></p></li><li><p>react编写的页面js如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;@babel/polyfill&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> ReactDom <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello World<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">ReactDom.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>))</span><br></pre></td></tr></table></figure></li></ul><h1 id="第4章-webpack进阶-高级概念"><a href="#第4章-webpack进阶-高级概念" class="headerlink" title="第4章 webpack进阶 (高级概念)"></a>第4章 webpack进阶 (高级概念)</h1><h2 id="4-1-tree-shaking概念详解"><a href="#4-1-tree-shaking概念详解" class="headerlink" title="4-1 tree shaking概念详解"></a>4-1 tree shaking概念详解</h2><h3 id="4-1-1-tree-shaking是什么"><a href="#4-1-1-tree-shaking是什么" class="headerlink" title="4-1-1 tree shaking是什么"></a>4-1-1 tree shaking是什么</h3><ul><li><p>运行<code>$ npx webpack</code>时会报一个警告：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">When setting `useBuiltIns: &#x27;usage&#x27;`, polyfills are automatically imported when needed.</span><br><span class="line">Please remove the `import &#x27;@babel/polyfill&#x27;` call or use `useBuiltIns: &#x27;entry&#x27;` instead.</span><br></pre></td></tr></table></figure><p>以上的含义是如果使用了useBuiltIns: ‘usage’，那么polyfill会自动被引入，所以我们无需再引。</p></li><li><p>编写以下代码，然后运行<code>$ npx webpack</code>打包：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 新建src/math.js：</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> add = <span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(a + b)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> minus = <span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(a - b)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 在src/index.js中引入并调用执行：</span></span><br><span class="line"><span class="keyword">import</span> &#123; add &#125; <span class="keyword">from</span> <span class="string">&#x27;./math&#x27;</span></span><br><span class="line">add(<span class="number">1</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure><p>打包完成发现dist/main.js中<code>exports provided: add, minus</code>，即minus方法也被打包进来了，但是我们不想打包跟业务代码无关的代码，就要引入Tree Shaking概念了。</p></li><li><p>Tree Shaking翻译过来是摇树，实际上可以把一个模块里没用的东西都摇晃掉。需要注意Tree Shaking只支持ES Module方式的引入，即只支持import模块的引入。</p></li></ul><h3 id="4-1-2-使用tree-shaking"><a href="#4-1-2-使用tree-shaking" class="headerlink" title="4-1-2 使用tree shaking"></a>4-1-2 使用tree shaking</h3><ul><li><p>如果webpack.config.js中添加一个配置项：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">plugins: [ ...... ],</span><br><span class="line">optimization: &#123;</span><br><span class="line">    usedExports: <span class="literal">true</span></span><br><span class="line">&#125;,</span><br><span class="line">output: &#123; ...... &#125;,</span><br></pre></td></tr></table></figure></li><li><p>然后在package.json中添加：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;sideEffects&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>配置它的原因是在打包时Tree Shaking会看模块引入了什么和打包了什么，假如我们引入css文件<code>import &#39;./style.css&#39;</code>，它并没有导出文件，Tree Shaking就会把它当作无用的模块过滤掉，所以需要针对css文件进行设置，这样Tree Shaking就不会作用于该格式的文件了：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;sideEffects&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;*.css&quot;</span></span><br><span class="line">    ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>以上配置完成后，发现dist/main.js中minus方法依然被打包了进来，但是注释却多了一行<code>exports used: add</code>，这种情况之所以会存在，这是因为开发时我们需要对代码进行调试，如果Tree Shaking把多余的方法删除掉，那么行数就错位了。</p></li></ul><h2 id="4-2-development和production模式的区分打包"><a href="#4-2-development和production模式的区分打包" class="headerlink" title="4-2 development和production模式的区分打包"></a>4-2 development和production模式的区分打包</h2><h3 id="4-2-1-development模式"><a href="#4-2-1-development模式" class="headerlink" title="4-2-1 development模式"></a>4-2-1 development模式</h3><ul><li>开发时用</li><li>使用了devServer，可以帮我们启一个服务器，这个服务器中还集成了HMR这样的特性，只要更改了代码就会重新打包，然后代码内容会实时展示在服务器对应的网页上</li></ul><h3 id="4-2-2-production模式"><a href="#4-2-2-production模式" class="headerlink" title="4-2-2 production模式"></a>4-2-2 production模式</h3><ul><li>开发完成，上线时使用</li></ul><h3 id="4-2-3-两种模式的差异"><a href="#4-2-3-两种模式的差异" class="headerlink" title="4-2-3 两种模式的差异"></a>4-2-3 两种模式的差异</h3><ul><li><p>在dev环境中sourceMap是非常全的，可以快速定位代码的问题；在prod环境中sourceMap就没那么重要了，设为更加简洁的即可</p></li><li><p>在dev环境中代码打包生成后不需要做压缩，能比较明显地看到代码中具体的说明项内容；在prod环境中代码可以被压缩</p><blockquote><p>之前我们对两个模式进行切换，需要手动修改webpack.config.js配置文件，其实有更好的办法：</p></blockquote></li></ul><h3 id="4-2-4-两种模式下的配置文件"><a href="#4-2-4-两种模式下的配置文件" class="headerlink" title="4-2-4 两种模式下的配置文件"></a>4-2-4 两种模式下的配置文件</h3><ul><li><p>重命名配置文件为webpack.dev.js.</p></li><li><p>复制配置文件为webpack.prod.js，修改后如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123;CleanWebpackPlugin&#125; = <span class="built_in">require</span>(<span class="string">&#x27;clean-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    mode: <span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">    devtool: <span class="string">&#x27;cheap-module-source-map&#x27;</span>,</span><br><span class="line">    entry: &#123;</span><br><span class="line">        main: <span class="string">&#x27;./src/index.js&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;            </span><br><span class="line">        rules: [ ...... ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: <span class="string">&#x27;src/index.html&#x27;</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> CleanWebpackPlugin()</span><br><span class="line">    ],</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: <span class="string">&#x27;[name].js&#x27;</span>,</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">&#x27;dist&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>跟dev文件不同的是mode、devtool、去掉devServer、去掉HMR插件、去掉optimization.</p></blockquote></li><li><p>修改package.json配置：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;dev&quot;</span>: <span class="string">&quot;webpack-dev-server --config webpack.dev.js&quot;</span>, <span class="comment">// 开发环境打包开发命令</span></span><br><span class="line">        <span class="attr">&quot;build&quot;</span>: <span class="string">&quot;webpack --config webpack.prod.js&quot;</span>  <span class="comment">// 生产环境打包命令</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>运行<code>$ npm run dev</code>进行开发，运行<code>$ npm run build</code>进行打包，会生成dist目录，直接把这个文件夹放到线上给后端使用即可</p></li></ul><h3 id="4-2-5-解决多个配置文件的重复问题"><a href="#4-2-5-解决多个配置文件的重复问题" class="headerlink" title="4-2-5 解决多个配置文件的重复问题"></a>4-2-5 解决多个配置文件的重复问题</h3><ul><li><p>新建webpack.common.js文件，把webpack.dev.js和webpack.prod.js中共有的代码都拆分到其中，三个文件具体如下：</p><p><strong>webpack.common.js：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123;CleanWebpackPlugin&#125; = <span class="built_in">require</span>(<span class="string">&#x27;clean-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        main: <span class="string">&#x27;./src/index.js&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [&#123;</span><br><span class="line">            test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">            exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">            loader: <span class="string">&#x27;babel-loader&#x27;</span></span><br><span class="line">        &#125;, &#123;</span><br><span class="line">            test: <span class="regexp">/\.(jpg|png|gif)$/</span>, </span><br><span class="line">            use: &#123;</span><br><span class="line">                loader: <span class="string">&#x27;url-loader&#x27;</span>,</span><br><span class="line">                options: &#123;</span><br><span class="line">                    name: <span class="string">&#x27;[name]_[hash].[ext]&#x27;</span>,</span><br><span class="line">                    outputPath: <span class="string">&#x27;images/&#x27;</span>,</span><br><span class="line">                    limit: <span class="number">20480</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, &#123;</span><br><span class="line">            test: <span class="regexp">/\.(eot|woff|ttf|svg)$/</span>,</span><br><span class="line">            use: &#123;</span><br><span class="line">            loader: <span class="string">&#x27;file-loader&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, &#123;</span><br><span class="line">            test: <span class="regexp">/\.vue$/</span>,</span><br><span class="line">            use: &#123;</span><br><span class="line">            loader: <span class="string">&#x27;vue-loader&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, &#123;</span><br><span class="line">            test: <span class="regexp">/\.scss$/</span>,</span><br><span class="line">            use: [</span><br><span class="line">                <span class="string">&#x27;style-loader&#x27;</span>,</span><br><span class="line">                &#123;</span><br><span class="line">                    loader: <span class="string">&#x27;css-loader&#x27;</span>,</span><br><span class="line">                    options: &#123;</span><br><span class="line">                        importLoaders: <span class="number">2</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">&#x27;sass-loader&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;postcss-loader&#x27;</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;, &#123;</span><br><span class="line">            test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">            use: [</span><br><span class="line">                <span class="string">&#x27;style-loader&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;css-loader&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;postcss-loader&#x27;</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: <span class="string">&#x27;src/index.html&#x27;</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> CleanWebpackPlugin()</span><br><span class="line">    ],</span><br><span class="line">    optimization: &#123;</span><br><span class="line">        usedExports: <span class="literal">true</span></span><br><span class="line">    &#125;，</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: <span class="string">&#x27;[name].js&#x27;</span>,</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">&#x27;dist&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>webpack.dev.js：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    mode: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">    devtool: <span class="string">&#x27;cheap-module-eval-source-map&#x27;</span>,</span><br><span class="line">    devServer: &#123;</span><br><span class="line">        contentBase: <span class="string">&#x27;./dist&#x27;</span>,</span><br><span class="line">        open: <span class="literal">true</span>,</span><br><span class="line">        proxy: &#123;</span><br><span class="line">            <span class="string">&#x27;/api&#x27;</span>: <span class="string">&#x27;http://localhost:3000&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        hot: <span class="literal">true</span>,</span><br><span class="line">        hotOnly: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> webpack.HotModuleReplacementPlugin()</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>webpack.prod.js：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    mode: <span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">    devtool: <span class="string">&#x27;cheap-module-source-map&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>拆完之后需要将dev、prod分别与common做一个合并后再输出，借助一个第三方模块，先安装<code>$ npm install webpack-merge -D</code>，然后分别在dev和prod中使用，以webpack.prod.js为例：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">&#x27;webpack-merge&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> commonConfig = <span class="built_in">require</span>(<span class="string">&#x27;./webpack.common.js&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> prodConfig = &#123;</span><br><span class="line">    mode: <span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">    devtool: <span class="string">&#x27;cheap-module-source-map&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = merge(commonConfig, prodConfig)</span><br></pre></td></tr></table></figure></li></ul><h3 id="4-2-6-整理以上几个配置文件"><a href="#4-2-6-整理以上几个配置文件" class="headerlink" title="4-2-6 整理以上几个配置文件"></a>4-2-6 整理以上几个配置文件</h3><ul><li><p>在项目根目录新建build文件夹，将这三个配置文件移入其中</p></li><li><p>然后修改package.json打包命令中的文件目录：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;dev&quot;</span>: <span class="string">&quot;webpack-dev-server --config ./build/webpack.dev.js&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build&quot;</span>: <span class="string">&quot;webpack --config ./build/webpack.prod.js&quot;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></li><li><p>记得修改配置中打包后的dist文件位置，否则打包后的dist文件夹就会出现在build目录下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">output: &#123;</span><br><span class="line">    filename: <span class="string">&#x27;[name].js&#x27;</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">&#x27;../dist&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="4-3-webpack和code-splitting"><a href="#4-3-webpack和code-splitting" class="headerlink" title="4-3 webpack和code splitting"></a>4-3 webpack和code splitting</h2><h3 id="4-3-1-准备工作"><a href="#4-3-1-准备工作" class="headerlink" title="4-3-1 准备工作"></a>4-3-1 准备工作</h3><ul><li><p>在package.json中添加新的指令，为了在开发环境中看到打包生成的文件：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;start&quot;</span>: <span class="string">&quot;webpack --config ./build/webpack.dev.js&quot;</span>,</span><br></pre></td></tr></table></figure></li><li><p>安装<code>$ npm install lodash --save</code>，举个简单例子，在src/index.js中使用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">&#x27;lodash&#x27;</span></span><br><span class="line"><span class="built_in">console</span>.log(_.join([<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>], <span class="string">&#x27;***&#x27;</span>))</span><br></pre></td></tr></table></figure><blockquote><p>假如我们的业务代码为1Mb，lodash本身也有1Mb，那么打包生成的dist/main.js不被压缩情况下就有2Mb，这就带来两个问题：<br>（1）打包生成的文件会很大，加载时间会很长。<br>（2）假设此时我们修改了业务代码，就会重新打包生成2Mb的main.js，假设用户重新访问我们的页面，就又要加载那么大的文件。</p></blockquote></li><li><p>针对以上我们应该怎么做呢？<br>（1）新建src/lodash.js：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">&#x27;lodash&#x27;</span></span><br><span class="line"><span class="built_in">window</span>._ = _</span><br></pre></td></tr></table></figure><p>相当于把_暴露到全局，在其他地方就可以尽情使用了。<br>（2）新建入口：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">entry: &#123;</span><br><span class="line">    lodash: <span class="string">&#x27;./src/lodash.js&#x27;</span>,</span><br><span class="line">    main: <span class="string">&#x27;./src/index.js&#x27;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><blockquote><p>这样就会把原来的dist/main.js(2Mb)拆分成dist/main.js(1Mb)和dist/lodash.js(1Mb)，由于浏览器可以并行加载，所以加载两个小文件比加载一个大文件可能更快，而且当页面业务逻辑发生变化时，用户只要重新加载main.js(1Mb)即可。</p></blockquote></li></ul><h3 id="4-3-2-code-splitting代码分割"><a href="#4-3-2-code-splitting代码分割" class="headerlink" title="4-3-2 code splitting代码分割"></a>4-3-2 code splitting代码分割</h3><ul><li><p>综上，在实际项目中我们会对代码公用部分进行拆分来提升项目运行的速度，这种拆分代码的方式就叫做Code Splitting。</p></li><li><p>Code Splitting和Webpack其实没啥关系，但现在通常把二者进行绑定，是因为webpack中有些插件（如：SplitChunksPlugin）可以非常容易实现code splitting这种功能.</p></li><li><p>方法一：实现同步代码的分割<br>对webpack进行简单的配置，就不再需要我们手动进行代码分割了，它会自动将类库和业务代码进行分割，common中添加配置如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">optimization: &#123;</span><br><span class="line">    splitChunks: &#123;</span><br><span class="line">        chunks: <span class="string">&#x27;all&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></li><li><p>方法二：实现异步代码的分割，不需要进行以上的配置了，因为默认就是异步，后面有讲：<br>在src/index.js中编写以下异步代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getComponent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">import</span>(<span class="string">&#x27;lodash&#x27;</span>).then(<span class="function">(<span class="params">&#123; <span class="keyword">default</span>: _ &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> element = <span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">        element.innerHTML = _.join([<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>], <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> element</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">getComponent().then(<span class="function">(<span class="params">element</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(element)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>这样就打包生成一个dist/0.js文件，里面实际上就是lodash库代码。</p></li></ul><h3 id="4-3-3-总结"><a href="#4-3-3-总结" class="headerlink" title="4-3-3 总结"></a>4-3-3 总结</h3><ul><li>代码分割和webpack无关，它是一个独立的概念，来提升整个项目的性能</li><li>webpack中实现代码分割有两种方式：<br>（1）同步代码：只需要在webpack.common.js中做optimization的配置即可<br>（2）异步代码（import）：无需做任何配置，会自动做代码分割放到新的文件中</li></ul><h2 id="4-5-split-chunks-plugin配置参数详解-1"><a href="#4-5-split-chunks-plugin配置参数详解-1" class="headerlink" title="4-5 split-chunks-plugin配置参数详解 (1)"></a>4-5 split-chunks-plugin配置参数详解 (1)</h2><h3 id="4-5-1-magic-comment魔法注释"><a href="#4-5-1-magic-comment魔法注释" class="headerlink" title="4-5-1 magic-comment魔法注释"></a>4-5-1 magic-comment魔法注释</h3><ul><li><p>用来修改打包后的文件名，用法如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getComponent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">import</span>(<span class="comment">/*webpackChunkName:&quot;lodash&quot;*/</span> <span class="string">&#x27;lodash&#x27;</span>).then(<span class="function">(<span class="params">&#123; <span class="keyword">default</span>: _ &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        ......</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>这样打包生成的文件叫做vendors~lodash.js</p></blockquote></li><li><p>怎么去掉前面的vendors呢？<br>参照官网<a target="_blank" rel="noopener" href="https://www.webpackjs.com/plugins/split-chunks-plugin/">https://www.webpackjs.com/plugins/split-chunks-plugin/</a>，复制如下配置，并作出修改：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">optimization: &#123;</span><br><span class="line">    splitChunks: &#123;</span><br><span class="line">        chunks: <span class="string">&#x27;all&#x27;</span>,</span><br><span class="line">        cacheGroups: &#123;</span><br><span class="line">            vendors: <span class="literal">false</span>,</span><br><span class="line">            <span class="keyword">default</span>: <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></li><li><p>以上说明了无论做同步还是异步的代码分割，都要进行splitChunks的配置，即使用SplitChunksPlugin这个插件。</p></li></ul><h3 id="4-5-2-详解split-chunks-plugin的配置参数"><a href="#4-5-2-详解split-chunks-plugin的配置参数" class="headerlink" title="4-5-2 详解split-chunks-plugin的配置参数"></a>4-5-2 详解split-chunks-plugin的配置参数</h3><ul><li><p>起初我们可以对它先不进行配置，设为空对象，打包的过程依然能正常运行，这是因为如果不配置它，它会有个默认的配置内容：</p><div><img src="07.png" alt="07" style="zoom:80%"></div>我们先把下面这两项设为false以做如下详解：<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cacheGroups: &#123;</span><br><span class="line">    vendors: <span class="literal">false</span>,</span><br><span class="line">    <span class="keyword">default</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>chunks: &#39;async&#39;</code>指做代码分割时只对异步代码生效，对以下src/index.js中的同步代码无效：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">&#x27;lodash&#x27;</span></span><br><span class="line"><span class="keyword">let</span> element = <span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">element.innerHTML = _.join([<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>], <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(element)</span><br></pre></td></tr></table></figure><blockquote><p>但是假如想对同步异步都做分割，把chunks设为’all’或’initial’后都对同步代码依然无效，因为打包时会在splitChunks中继续向下走，走到cacheGroup这个参数（只针对同步代码），由于vendors被设为false，所以它不会被分割。</p></blockquote></li><li><p>针对以上情况，我们修改配置：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vendors: &#123;</span><br><span class="line">    test: <span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">    priority: -<span class="number">10</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><blockquote><p>这样就能分割生成vendors~main.js，里面就是lodash全部的代码，为啥叫main呢？因为是在src/index.js中引入的lodash，而index.js的入口文件名叫main，所以这里默认就叫该名称了。既然这样我们可以增加一个配置项，将其打包成vendors.js:</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vendors: &#123;</span><br><span class="line">    test: <span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">    priority: -<span class="number">10</span>,</span><br><span class="line">    name: <span class="string">&#x27;vendors&#x27;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><blockquote><p>因此chunks参数要和vendors参数配合使用。<br>以上的意思是如果要打包的库在node_modules文件夹中，就会被分割到vendors.js中<br>按照视频和官网vendors.filename: ‘vendors.js’在运行<code>$ npx webpack</code>时会报以下错误，将它改成name就解决了：<br><code>UnhandledPromiseRejectionWarning: Error: SplitChunksPlugin: You are trying to set a filename for a chunk which is (also) loaded on demand. The runtime can only handle loading of chunks which match the chunkFilename schema. Using a custom filename would fail at runtime. (cache group: vendors)</code></p></blockquote></li><li><p>minSize: 30000表示我们引入的库如果大于30000字节，才会做代码分割，小于的话就不做代码分割。</p><p>假设我们自己写个模块src/test.js并在src/index.js中使用，当大小符合minSize（先设为0做测试）时，它还是会继续走到cacheGroup中，此时由于vendors只针对node_modules中的模块，所以我们需要设置default如下，就能生成default~main.js文件，同样可以用name给它命名:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">default</span>: &#123;</span><br><span class="line">    priority: -<span class="number">20</span>,</span><br><span class="line">    reuseExistingChunk: <span class="literal">true</span>，</span><br><span class="line">    name: <span class="string">&#x27;common&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>minChunks: 1指当一个模块被用了至少多少次时才对其进行代码分割。</p></li><li><p>maxAsyncRequests: 5指同时加载的模块数是5个，假如有10个模块需要打包，webpack会在打包前5个时进行代码分割，后面的就不做了。</p></li><li><p>maxInitialRequests: 3指整个网站首页（或者说入口文件）进行加载的时候，入口文件中可能会引入其他的js文件或其他的库，最多只能对其中3个进行代码分割。</p></li><li><p>automaticNameDelimiter: ‘~’指生成文件的文件名中间会有连接符。</p></li><li><p>name: true是指在cacheGroups中取的name文件名有效。</p></li><li><p>cacheGroups与同步代码打包相关，这里之所以叫’缓存组’是因为当打包多个模块时，打包其一时判断符合所有配置，就先放到这个组里缓存着，打包其二时同样也先缓存着……最终当所有的模块都分析好之后，就可以把符合vendors这个组的所有模块都打包到一起，把符合default这个组的所有模块也打包到一起。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cacheGroups: &#123;</span><br><span class="line">    vendors: &#123;</span><br><span class="line">        test: <span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">        priority: -<span class="number">10</span>,</span><br><span class="line">        name: <span class="string">&#x27;vendors&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">default</span>: &#123;</span><br><span class="line">        priority: -<span class="number">20</span>,</span><br><span class="line">        reuseExistingChunk: <span class="literal">true</span>,</span><br><span class="line">        name: <span class="string">&#x27;common&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><ul><li>priority的作用：当我们打包某个模块时，如果它既符合vendors的规则，也适用default的规则，那么当priority的值越大(-10&gt;-20)优先级就越高，所以上面会将其打包到vendors.js中。</li><li>reuseExistingChunk: true表示假如我们同时引入模块a和b，其中b已经是打包过的了并在a中进行了引用，那么我们打包分割时就不会重新打包b了。</li></ul></blockquote></li></ul><h2 id="4-7-lazy-loading懒加载和chunk是什么"><a href="#4-7-lazy-loading懒加载和chunk是什么" class="headerlink" title="4-7 lazy loading懒加载和chunk是什么"></a>4-7 lazy loading懒加载和chunk是什么</h2><h3 id="4-7-1-懒加载"><a href="#4-7-1-懒加载" class="headerlink" title="4-7-1 懒加载"></a>4-7-1 懒加载</h3><ul><li><p>实际上就是import语法，可以让我们在页面执行时需要哪些模块再去请求哪些模块，不需要一次性把所有代码都加载到页面上：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getComponent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">import</span>(<span class="comment">/*webpackChunkName:&quot;lodash&quot;*/</span> <span class="string">&#x27;lodash&#x27;</span>).then(<span class="function">(<span class="params">&#123; <span class="keyword">default</span>: _ &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> element = <span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">        element.innerHTML = _.join([<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>], <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> element</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    getComponent().then(<span class="function">(<span class="params">element</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">document</span>.body.appendChild(element)</span><br><span class="line">    &#125;)  </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>以上可以利用ES7语法进行修改：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getComponent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">default</span>: _ &#125; = <span class="keyword">await</span> <span class="keyword">import</span>(<span class="comment">/*webpackChunkName:&quot;lodash&quot;*/</span> <span class="string">&#x27;lodash&#x27;</span>)</span><br><span class="line">    <span class="keyword">let</span> element = <span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">    element.innerHTML = _.join([<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>], <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> element</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="4-7-2-chunk的概念"><a href="#4-7-2-chunk的概念" class="headerlink" title="4-7-2 chunk的概念"></a>4-7-2 chunk的概念</h3><ul><li>打包分割成的每个js文件都是一个chunk，如前例的dist/main.js、dist/vendors.js等。</li><li>chunk的意义：先再次理解splitChunks.minChunks:2这个概念，以lodash为例，它是指在打包生成的chunk中至少有2个使用了lodash时，才对lodash进行代码分割。</li></ul><h2 id="4-8-打包分析-preloading和prefetching"><a href="#4-8-打包分析-preloading和prefetching" class="headerlink" title="4-8 打包分析-preloading和prefetching"></a>4-8 打包分析-preloading和prefetching</h2><h3 id="4-8-1-打包分析"><a href="#4-8-1-打包分析" class="headerlink" title="4-8-1 打包分析"></a>4-8-1 打包分析</h3><ul><li><p>指的是当我们使用webpack进行代码的打包之后，可以借助打包分析的一些工具对打包生成的文件进行一定的分析，然后看下它打包是否合理。</p></li><li><p>webpack官方提供的分析工具的git仓库<a target="_blank" rel="noopener" href="http://www.github.com/webpack/analyse">http://www.github.com/webpack/analyse</a>，怎么使用呢？<br>（1）先复制命令粘贴到打包命令中：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;start&quot;</span>: <span class="string">&quot;webpack --profile --json &gt; stats.json --config ./build/webpack.dev.js&quot;</span></span><br></pre></td></tr></table></figure><p>以上的含义是在打包时把打包过程的描述放置到一个叫做stats.json的文件中，运行<code>$ npm start</code>后会在根目录生成该json文件。<br>（2）需要借助工具分析该文件，进入<a target="_blank" rel="noopener" href="http://webpack.github.io/analyse/">http://webpack.github.io/analyse/</a>，并上传stats.json文件，分析结果即可出来：</p><img src="08.jpg" alt="08" style="zoom:50%"><blockquote><p>以上分析结果表示：<br>打包使用的webpack版本、耗时、哈希值、模块数量、chunk(打包生成的js文件)数量、静态文件(assets)数量、是否有警告或异常。</p></blockquote></li><li><p>在官网还介绍了其他的分析工具<a target="_blank" rel="noopener" href="https://webpack.js.org/guides/code-splitting/#bundle-analysis">https://webpack.js.org/guides/code-splitting/#bundle-analysis</a>，常用的是webpack-bundle-analyzer。</p></li></ul><h3 id="4-8-2-prefetching和preloading"><a href="#4-8-2-prefetching和preloading" class="headerlink" title="4-8-2 prefetching和preloading"></a>4-8-2 prefetching和preloading</h3><ul><li><p>在webpack.common.js中我们将splitChunks.chunks设为’all’，但webpack默认是’async’，即只对异步代码进行分割，webpack为什么要这么做呢？之前讲过通过缓存可以使jquery、lodash之类的在第二次加载时比较快，但webpack是希望能在第一次访问时就很快，怎么做呢？它真正希望我们编写代码的方式是什么样的呢？</p></li><li><p>假如我们想实现点击页面创建一个元素，并将其挂载到页面上。我们的传统做法是：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> element = <span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">    element.innerHTML = <span class="string">&#x27;aaa&#x27;</span></span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(element)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>运行<code>$ npm run build</code>后打开控制台采用快捷键ctrl+shift+p搜索打开coverage，并点击红色圆形按钮，就能看到main.js的利用率仅74.5%，进去查看详情发现以上代码并没有被利用，但加载时却被下载了下来，浪费了页面执行的性能：</p><img src="09.jpg" alt="09" style="zoom:67%"></li><li><p>所以webpack建议以上这种交互的代码放到一个异步加载的模块中：</p><p><strong>新建src/click.js：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">handleClick</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> element = <span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">    element.innerHTML = <span class="string">&#x27;aaa&#x27;</span></span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(element)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>修改src/index.js：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">import</span>(<span class="string">&#x27;./click&#x27;</span>).then(<span class="function">(<span class="params">&#123;<span class="keyword">default</span>: fn&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        fn()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>这样再查看控制台，发现main.js的利用率提升到80.5%。</p></li><li><p>为什么利用率变高了？因为以下代码变少了：</p><img src="10.jpg" alt="10" style="zoom:90%"></li><li><p>以上也间接解释了为什么webpack的配置项里的splitChunks.chunks的默认值为’async’，是因为它认为只有异步的组件才能真正地提升网页的打包性能，而同步的代码只能增加一个缓存，对性能的提升实际上很有限。</p></li><li><p>我们发现上面在页面加载完成后，只有点击后，click.js中的相关代码才加载处理，这样有可能会造成延迟，用户体验不好，所以我们希望加载完页面模块后在空闲时就偷偷地将click.js相关的代码加载下来，这就需要采用prefetch或preload了：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>(<span class="comment">/* webpackPrefetch: true */</span> <span class="string">&#x27;./click&#x27;</span>)</span><br></pre></td></tr></table></figure></li><li><p>prefetch和preload的区别：prefetch会等待核心代码加载完成后，页面带宽空闲时再去加载prefetch对应的js文件，而preload会和主业务文件一起加载。所以建议使用prefetch。</p></li></ul><h2 id="4-9-css文件的代码分割"><a href="#4-9-css文件的代码分割" class="headerlink" title="4-9 css文件的代码分割"></a>4-9 css文件的代码分割</h2><h3 id="4-9-1-css-in-js"><a href="#4-9-1-css-in-js" class="headerlink" title="4-9-1 css in js"></a>4-9-1 css in js</h3><ul><li><p>新建src/style.css</p></li><li><p>在src/index.js中引入：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./style.css&#x27;</span></span><br></pre></td></tr></table></figure></li><li><p>运行<code>$ npm start</code>后发现样式生效了，而且在dist/main.js中多引入了chunk.js文件（之前只引main.js），但是dist目录下却没有css文件，这就是我们常说的css in js：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;vendors~main.chunk.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;main.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="4-9-2-借助mini-css-extract-plugin将css打包到dist下-而不是放到js中"><a href="#4-9-2-借助mini-css-extract-plugin将css打包到dist下-而不是放到js中" class="headerlink" title="4-9-2 借助mini-css-extract-plugin将css打包到dist下 而不是放到js中"></a>4-9-2 借助mini-css-extract-plugin将css打包到dist下 而不是放到js中</h3><ul><li><p>参照官网<a target="_blank" rel="noopener" href="https://webpack.js.org/plugins/mini-css-extract-plugin/">https://webpack.js.org/plugins/mini-css-extract-plugin/</a>进行安装<code>$ npm install --save-dev mini-css-extract-plugin</code></p></li><li><p>在webpack.common.js中进行如下使用修改：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">&#x27;mini-css-extract-plugin&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;           </span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [&#123;</span><br><span class="line">            test: <span class="regexp">/\.scss$/</span>,</span><br><span class="line">            use: [</span><br><span class="line">                MiniCssExtractPlugin.loader,  <span class="comment">// 相当于替换掉style-loader</span></span><br><span class="line">                &#123;</span><br><span class="line">                    loader: <span class="string">&#x27;css-loader&#x27;</span>,</span><br><span class="line">                    options: &#123;</span><br><span class="line">                        importLoaders: <span class="number">2</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">&#x27;sass-loader&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;postcss-loader&#x27;</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;, &#123;</span><br><span class="line">            test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">            use: [</span><br><span class="line">                MiniCssExtractPlugin.loader,   <span class="comment">// 相当于替换掉style-loader</span></span><br><span class="line">                <span class="string">&#x27;css-loader&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;postcss-loader&#x27;</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        ......,</span><br><span class="line">        <span class="keyword">new</span> MiniCssExtractPlugin()</span><br><span class="line">    ],</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>以上配置完成后开发环境打包<code>$ npm start</code>会在dist下生成main.css，但生产环境却不行，所以就怀疑是TreeShaking导致的，将package.json中的”sideEffects”: <code>false</code>修改成<code>[&quot;*.css&quot;]</code>后，打包后才正常分割出main.css文件及main.css.map文件，这时候dist/index.html中重新变回只引用main.js了。</p></blockquote></li><li><p>它里面还可以进行一些配置，发现打包后的文件还叫main.css，这是因为它如果可以在dist/index.html通过link直接引用，就会走filename那个属性，如果是间接引用，才走chunkFilename属性：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">    filename: <span class="string">&#x27;[name].css&#x27;</span>,</span><br><span class="line">    chunkFilename: <span class="string">&#x27;[name].chunk.css&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>假设src/index.js中同时引入两个css文件，打包分割后依然会生成一个dist/main.css，里面把打包前的两个css样式合并在一起了。</p></li></ul><h3 id="4-9-3-压缩css代码"><a href="#4-9-3-压缩css代码" class="headerlink" title="4-9-3 压缩css代码"></a>4-9-3 压缩css代码</h3><ul><li><p>按照官网<a target="_blank" rel="noopener" href="https://github.com/NMFR/optimize-css-assets-webpack-plugin">https://github.com/NMFR/optimize-css-assets-webpack-plugin</a>，先进行安装<code>$ npm install --save-dev optimize-css-assets-webpack-plugin</code></p></li><li><p>直接引入并在plugins中使用，重新打包即可看到代码被压缩合并(以下用法与视频讲解的不一致)：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> OptimizeCssAssetsPlugin = <span class="built_in">require</span>(<span class="string">&#x27;optimize-css-assets-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">        ......,</span><br><span class="line">        <span class="keyword">new</span> OptimizeCssAssetsPlugin()</span><br><span class="line">    ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="4-9-4-将所有入口的css文件打包分割成一个css文件"><a href="#4-9-4-将所有入口的css文件打包分割成一个css文件" class="headerlink" title="4-9-4 将所有入口的css文件打包分割成一个css文件"></a>4-9-4 将所有入口的css文件打包分割成一个css文件</h3><p style="text-indent:1em">直接进入以下配置即可，打包完成后生成dist/styles.chunk.css：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">splitChunks: &#123;</span><br><span class="line">    chunks: <span class="string">&#x27;all&#x27;</span>,</span><br><span class="line">    cacheGroups: &#123;</span><br><span class="line">        styles: &#123;</span><br><span class="line">            name: <span class="string">&#x27;styles&#x27;</span>,</span><br><span class="line">            test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">            chunks: <span class="string">&#x27;all&#x27;</span>,</span><br><span class="line">            enforce: <span class="literal">true</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-9-5-根据入口不同将css文件打包到不同的css文件中"><a href="#4-9-5-根据入口不同将css文件打包到不同的css文件中" class="headerlink" title="4-9-5 根据入口不同将css文件打包到不同的css文件中"></a>4-9-5 根据入口不同将css文件打包到不同的css文件中</h3><div style="padding-left:1em"><p>配置如下：</p><img src="11.jpg" alt="11" style="zoom:80%"></div><h2 id="4-10-webpack与浏览器缓存-caching"><a href="#4-10-webpack与浏览器缓存-caching" class="headerlink" title="4-10 webpack与浏览器缓存 (caching)"></a>4-10 webpack与浏览器缓存 (caching)</h2><h3 id="4-10-1-浏览器缓存"><a href="#4-10-1-浏览器缓存" class="headerlink" title="4-10-1 浏览器缓存"></a>4-10-1 浏览器缓存</h3><p style="text-indent:2em">如果将以上代码打包，用户第一次访问页面时，在network中文件加载了进来，假如我们修改后重新打包，由于打包生成的文件名没变，用户即便刷新，也会受浏览器缓存影响，仍看到修改前的内容。</p><h3 id="4-10-2-contentHash"><a href="#4-10-2-contentHash" class="headerlink" title="4-10-2 contentHash"></a>4-10-2 contentHash</h3><ul><li><p>将webpack.common.js的output中部分代码剪切到dev并作修改，然后复制到prod，也做出相应修改：</p><p><strong>webpack.dev.js：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">output: &#123;</span><br><span class="line">    filename: <span class="string">&#x27;[name].js&#x27;</span>,</span><br><span class="line">    chunkFilename: <span class="string">&#x27;[name].js&#x27;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>webpack.prod.js：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">output: &#123;</span><br><span class="line">    filename: <span class="string">&#x27;[name].[contentHash].js&#x27;</span>,</span><br><span class="line">    chunkFilename: <span class="string">&#x27;[name].[contentHash].js&#x27;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行<code>$ npm run build</code>后打包生成的文件名称中就带有哈希值：<code>main.e29c51e41919e31b788e.js</code>和<code>vendors~main.7282cdc21edc87472cbb.js</code>。</p></li><li><p>如果我们代码内容不变，再重新打包，上面的两个哈希值永远不会变；如果我们对src/index.js中的业务代码做了修改，重新打包后，只有main.js的哈希值会变，而由于vendors~main.js中是lodash和jquery的代码，它的哈希值未发生变化。所以刷新页面后，vendors直接用本地缓存，main.js就需要重新去服务器上请求，加载新的变化了的文件。</p></li><li><p>在老版本的webpack4中不改变代码重新打包，哈希值可能也发生变化，这是由于manifest导致的，需要在optimization中配置runtimeChunk即可解决。</p></li></ul><h2 id="4-11-shimming-垫片-的作用"><a href="#4-11-shimming-垫片-的作用" class="headerlink" title="4-11 shimming (垫片) 的作用"></a>4-11 shimming (垫片) 的作用</h2><h3 id="4-11-1-全局配置jquery"><a href="#4-11-1-全局配置jquery" class="headerlink" title="4-11-1 全局配置jquery"></a>4-11-1 全局配置jquery</h3><ul><li><p>新建src/jquery.ui.js：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">ui</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $(<span class="string">&#x27;body&#x27;</span>).css(<span class="string">&#x27;background&#x27;</span>, <span class="string">&#x27;#ccc&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>在src/index.js中引入并调用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> $ <span class="keyword">from</span> <span class="string">&#x27;jquery&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; ui &#125; <span class="keyword">from</span> <span class="string">&#x27;./jquery.ui&#x27;</span></span><br><span class="line">ui()</span><br></pre></td></tr></table></figure><blockquote><p>发现会报错，这是因为webpack是基于模块打包的，而模块中的变量只能在当前模块使用，换一个文件使用是不可能的，为了解决这个问题，就需要借助垫片的形式。</p></blockquote></li><li><p>在webpack.common.js中配置如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> webpack.ProvidePlugin(&#123;</span><br><span class="line">            $: <span class="string">&#x27;jquery&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>意思是如果在一个模块里使用了$这个变量，就会自动引入jquery这个模块，然后把jquery赋值给$，相当于<code>import $ from &#39;jquery&#39;</code></p></blockquote></li><li><p>同样可以配置lodash或lodash下的某个模块方法：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.ProvidePlugin(&#123;</span><br><span class="line">    _: <span class="string">&#x27;lodash&#x27;</span>, <span class="comment">// or</span></span><br><span class="line">    _join: [<span class="string">&#x27;lodash&#x27;</span>, <span class="string">&#x27;join&#x27;</span>]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ul><h3 id="4-11-2-imports-loader"><a href="#4-11-2-imports-loader" class="headerlink" title="4-11-2 imports-loader"></a>4-11-2 imports-loader</h3><ul><li><p>一个模块里的this永远指向模块自身，但是怎样才能使它指向window呢？需要借助一个插件，先安装<code>$ npm install imports-loader -D</code>，修改webpack.common.js：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [&#123;</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">        use: [&#123;</span><br><span class="line">            loader: <span class="string">&#x27;babel-loader&#x27;</span></span><br><span class="line">        &#125;, &#123;</span><br><span class="line">            loader: <span class="string">&#x27;imports-loader?this=&gt;window&#x27;</span></span><br><span class="line">        &#125;]</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure><blockquote><p>以上将this指向window报语法错误，至今未找到解决办法，试验了jquery是ok的：<code>loader: &#39;imports-loader?$=jquery</code></p></blockquote></li><li><p>垫片的作用：用来修改webpack默认的行为或者webpack原始打包实现不了的效果</p></li></ul><h3 id="4-11-3-课后阅读"><a href="#4-11-3-课后阅读" class="headerlink" title="4-11-3 课后阅读"></a>4-11-3 课后阅读</h3><ul><li>英文<a target="_blank" rel="noopener" href="https://webpack.js.org/guides/">https://webpack.js.org/guides/</a>，中文<a target="_blank" rel="noopener" href="https://www.webpackjs.com/guides/">https://www.webpackjs.com/guides/</a></li></ul><h2 id="4-12-环境变量的使用方法"><a href="#4-12-环境变量的使用方法" class="headerlink" title="4-12 环境变量的使用方法"></a>4-12 环境变量的使用方法</h2><h3 id="4-12-1-调整配置文件"><a href="#4-12-1-调整配置文件" class="headerlink" title="4-12-1 调整配置文件"></a>4-12-1 调整配置文件</h3><ul><li><p>webpack.dev.js和webpack.prod.js去掉webpack-merge和引入的webpack.common.js，直接将自己的模块导出，以dev为例：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// const merge = require(&#x27;webpack-merge&#x27;)</span></span><br><span class="line"><span class="comment">// const commonConfig = require(&#x27;./webpack.common.js&#x27;)</span></span><br><span class="line"><span class="comment">// module.exports = merge(commonConfig, devConfig)</span></span><br><span class="line"><span class="built_in">module</span>.exports = devConfig</span><br></pre></td></tr></table></figure></li><li><p>webpack.common.js中引入merge并分别引入dev和prod的配置文件，并根据外部传递的全局变量env进行判断当前环境，并将其导出：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">&#x27;webpack-merge&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> devConfig = <span class="built_in">require</span>(<span class="string">&#x27;./webpack.dev.js&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> prodConfig = <span class="built_in">require</span>(<span class="string">&#x27;./webpack.prod.js&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> commonConfig = &#123;&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">env</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(env &amp;&amp; env.production) &#123;</span><br><span class="line">        <span class="keyword">return</span> merge(commonConfig, prodConfig)</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> merge(commonConfig, devConfig)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>将package.json指令中使用的配置文件都改成webpack.common.js，start和dev指令中不需要传全局变量env，但build指令需要传，具体如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;start&quot;</span>: <span class="string">&quot;webpack --config ./build/webpack.common.js&quot;</span>,</span><br><span class="line">    <span class="string">&quot;dev&quot;</span>: <span class="string">&quot;webpack-dev-server --config ./build/webpack.common.js&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build&quot;</span>: <span class="string">&quot;webpack --env.production --config ./build/webpack.common.js&quot;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></li><li><p>以上传递全局变量的方法只是其一，我们也可以这样做：</p><ul><li>其二： <strong>package.json:</strong><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;build&quot;</span>: <span class="string">&quot;webpack --env production --config ./build/webpack.common.js&quot;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><strong>webpack.common.js:</strong><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">production</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(production) &#123; &#125;<span class="keyword">else</span> &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>其三： <strong>package.json:</strong><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;build&quot;</span>: <span class="string">&quot;webpack --env.production=aaa --config ./build/webpack.common.js&quot;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><strong>webpack.common.js:</strong><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">env</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(env &amp;&amp; env.production === <span class="string">&#x27;aaa&#x27;</span>) &#123; &#125;<span class="keyword">else</span> &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><blockquote><p>注意：我们项目中一般不用环境变量的这种方法！</p></blockquote></li></ul><h1 id="第5章-webpack实战配置案例"><a href="#第5章-webpack实战配置案例" class="headerlink" title="第5章 webpack实战配置案例"></a>第5章 webpack实战配置案例</h1><h2 id="5-1-library的打包"><a href="#5-1-library的打包" class="headerlink" title="5-1 library的打包"></a>5-1 library的打包</h2><h3 id="5-1-1-实现打包一个函数库的准备工作"><a href="#5-1-1-实现打包一个函数库的准备工作" class="headerlink" title="5-1-1 实现打包一个函数库的准备工作"></a>5-1-1 实现打包一个函数库的准备工作</h3><ul><li><p>新建library项目，并运行<code>$ npm init -y</code>，进入修改package.json文件，去掉scripts中内容，修改作者，将license改为’MIT’：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;library&quot;</span>,</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;main&quot;</span>: <span class="string">&quot;index.js&quot;</span>,</span><br><span class="line">    <span class="string">&quot;scripts&quot;</span>: &#123;&#125;,</span><br><span class="line">    <span class="string">&quot;keywords&quot;</span>: [],</span><br><span class="line">    <span class="string">&quot;author&quot;</span>: <span class="string">&quot;Carol&quot;</span>,</span><br><span class="line">    <span class="string">&quot;license&quot;</span>: <span class="string">&quot;MIT&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>新建src文件夹，并新建src/math.js：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">minus</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a - b</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">multiply</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a * b</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">division</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a / b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>新建src/string.js：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">join</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + <span class="string">&#x27; &#x27;</span> + b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>新建src/index.js：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> math <span class="keyword">from</span> <span class="string">&#x27;./math&#x27;</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> string <span class="keyword">from</span> <span class="string">&#x27;./string&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123; math, string &#125;</span><br></pre></td></tr></table></figure></li><li><p>安装webpack<code>$ npm install webpack webpack-cli --save</code>，在package.json中添加指令：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;build&quot;</span>: <span class="string">&quot;webpack&quot;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></li><li><p>添加webpack.config.js，运行<code>$ npm run build</code>进行打包即可：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    mode: <span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">    entry: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">        filename: <span class="string">&#x27;library.js&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="5-1-2-真正实现打包一个函数库"><a href="#5-1-2-真正实现打包一个函数库" class="headerlink" title="5-1-2 真正实现打包一个函数库"></a>5-1-2 真正实现打包一个函数库</h3><ul><li><p>如果是业务代码，到上面的步骤就结束了，但我们写的是个库，需要拿给别人用，而别人可能会使用各种方法引入我们的库：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> library <span class="keyword">from</span> <span class="string">&#x27;library&#x27;</span>  <span class="comment">// ES6语法</span></span><br><span class="line"><span class="keyword">const</span> library = <span class="built_in">require</span>(<span class="string">&#x27;library&#x27;</span>)  <span class="comment">// CommonJs语法</span></span><br><span class="line"><span class="built_in">require</span>([<span class="string">&#x27;library&#x27;</span>], <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;)  <span class="comment">// AMD语法</span></span><br></pre></td></tr></table></figure></li><li><p>如果我们想让外部引用，需要在webpack.config.js中加个配置：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">    filename: <span class="string">&#x27;library.js&#x27;</span>,</span><br><span class="line">    libraryTarget: <span class="string">&#x27;umd&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>将libraryTarget配置成’umd’的意思是不管通过任何方式引入我们的库，都能引入到。</p></blockquote></li><li><p>别人也有可能不采用以上三种使用方式引入，而直接用script标签引入js，并希望通过全局变量来使用这个库，这就需要再进行配置了：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">output: &#123;</span><br><span class="line">    ......</span><br><span class="line">    library: <span class="string">&#x27;library&#x27;</span>,</span><br><span class="line">    libraryTarget: <span class="string">&#x27;umd&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="5-1-3-打包库时引入其他库"><a href="#5-1-3-打包库时引入其他库" class="headerlink" title="5-1-3 打包库时引入其他库"></a>5-1-3 打包库时引入其他库</h3><ul><li><p>以lodash为例，先安装<code>$ npm install lodash --save</code>，改写src/string.js后打包：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">&#x27;lodash&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">join</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> _.join([a, b], <span class="string">&#x27; &#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>别人在使用我们的library库时可能还会同时使用lodash，最终在用户的代码里很容易存在两份lodash，所以我们就需要进行以下配置：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    ......</span><br><span class="line">    externals: [<span class="string">&#x27;lodash&#x27;</span>],</span><br><span class="line">    output: &#123;......&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>它的意思是打包过程中如果遇到lodash这个库，就忽略，不要打包到代码里去，我们在业务代码中使用这个库之前就得先引入lodash才可以。</p></blockquote></li><li><p>根据官网<a target="_blank" rel="noopener" href="https://webpack.js.org/configuration/externals/">https://webpack.js.org/configuration/externals/</a>，externals还支持好多东西：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">externals: &#123;</span><br><span class="line">    lodash: &#123;</span><br><span class="line">        root: <span class="string">&#x27;_&#x27;</span>,</span><br><span class="line">        commonjs: <span class="string">&#x27;lodash&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><blockquote><ul><li>commonjs: ‘lodash’的意思是如果我们的库在commonjs环境（如<code>const library = require(&#39;library&#39;)</code>）下被使用，要求lodash被加载时必须叫做lodash，如<code>const lodash = require(&#39;lodash&#39;)</code></li><li>root: ‘_’的意思是lodash是通过全局的script标签引入进来，那么这个script标签</li></ul></blockquote></li></ul><h1 id="第6章-webpack底层原理及脚手架工具分析"><a href="#第6章-webpack底层原理及脚手架工具分析" class="headerlink" title="第6章 webpack底层原理及脚手架工具分析"></a>第6章 webpack底层原理及脚手架工具分析</h1><p>未完待续……</p></div><div class="article-footer"><blockquote class="mt-2x"><ul class="post-copyright list-unstyled"><li class="post-copyright-link hidden-xs"><strong>本文链接：</strong> <a href="https://scarlett9354.github.io/2021/04/28/%E4%BB%8E%E5%9F%BA%E7%A1%80%E5%88%B0%E5%AE%9E%E6%88%98-%E6%89%8B%E6%8A%8A%E6%89%8B%E5%B8%A6%E4%BD%A0%E6%8E%8C%E6%8F%A1%E6%96%B0%E7%89%88Webpack4/" title="从基础到实战-手把手带你掌握新版Webpack4" target="_blank" rel="external">https://scarlett9354.github.io/2021/04/28/%E4%BB%8E%E5%9F%BA%E7%A1%80%E5%88%B0%E5%AE%9E%E6%88%98-%E6%89%8B%E6%8A%8A%E6%89%8B%E5%B8%A6%E4%BD%A0%E6%8E%8C%E6%8F%A1%E6%96%B0%E7%89%88Webpack4/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！</li></ul></blockquote><div class="panel panel-default panel-badger"><div class="panel-body"><figure class="media"><div class="media-left"><a href="https://github.com/scarlett9354" target="_blank" class="img-burn thumb-sm visible-lg"><img src="/images/avatar.jpg" class="img-rounded w-full" alt=""></a></div><div class="media-body"><h3 class="media-heading"><a href="https://github.com/scarlett9354" target="_blank"><span class="text-dark">月亮和水蜜桃</span><small class="ml-1x"></small></a></h3><div>个人简介。</div></div></figure></div></div></div></article><section id="comments"><div id="vcomments"></div></section></div><nav class="bar bar-footer clearfix" data-stick-bottom><div class="bar-inner"><ul class="pager pull-left"><li class="prev"><a href="/2021/04/29/TypeScript%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/" title="TypeScript开发实战"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a></li><li class="next"><a href="/2021/04/28/%E7%8E%A9%E8%BD%ACwebpack/" title="玩转webpack"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a></li></ul><button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>赏</span></button><div class="bar-right"><div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div></div></div></nav><div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog"><div class="modal-dialog" role="document"><div class="modal-content donate"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><div class="modal-body"><div class="donate-box"><div class="donate-head"><p>感谢您的支持，我会继续努力的!</p></div><div class="tab-content"><div role="tabpanel" class="tab-pane fade active in" id="alipay"><div class="donate-payimg"><img src="/images/donate/alipayimg.jpg" alt="扫码支持" title="扫一扫"></div><p class="text-muted mv">扫码打赏，你说多少就多少</p><p class="text-grey">打开支付宝扫一扫，即可进行扫码打赏哦</p></div><div role="tabpanel" class="tab-pane fade" id="wechatpay"><div class="donate-payimg"><img src="/images/donate/wechatpayimg.jpg" alt="扫码支持" title="扫一扫"></div><p class="text-muted mv">扫码打赏，你说多少就多少</p><p class="text-grey">打开微信扫一扫，即可进行扫码打赏哦</p></div></div><div class="donate-footer"><ul class="nav nav-tabs nav-justified" role="tablist"><li role="presentation" class="active"><a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> 支付宝</a></li><li role="presentation"><a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> 微信支付</a></li></ul></div></div></div></div></div></div></main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter"><ul class="social-links"><li><a href="https://github.com/scarlett9354" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li></ul><div class="copyright"><div class="publishby">Theme by <a href="https://github.com/scarlett9354" target="_blank">cofess </a>base on <a href="https://github.com/scarlett9354" target="_blank">pure</a>.</div></div></footer><script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script><script>window.jQuery||document.write('<script src="js/jquery.min.js"><\/script>')</script><script src="/js/plugin.min.js"></script><script src="/js/application.js"></script><script>window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"文章",PAGES:"页面",CATEGORIES:"分类",TAGS:"标签",UNTITLED:"(未命名)"},ROOT_URL:"/",CONTENT_URL:"/content.json"}</script><script src="/js/insight.js"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/npm/valine"></script><script type="text/javascript">var GUEST=["nick","mail","link"],meta=(meta="nick,mail,link").split(",").filter(function(e){return-1<GUEST.indexOf(e)});new Valine({el:"#vcomments",verify:!1,notify:!1,appId:"",appKey:"",placeholder:"Just go go",avatar:"mm",meta:meta,pageSize:"10",visitor:!1})</script></body></html>